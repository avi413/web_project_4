!function(){"use strict";class e{constructor(e,t,i,s,n){var r,l;l=()=>{const e=this._element.querySelector(".gallery__like-btn"),t=this._element.querySelector(".gllery__like-count");e.classList.contains("gallery__like-btn_active")?(this._deleteLike(this._element.id),t.textContent--):(this._addLike(this._element.id),t.textContent++),this._element.querySelector(".gallery__like-btn").classList.toggle("gallery__like-btn_active")},(r="_handleLikeBtn")in this?Object.defineProperty(this,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):this[r]=l,this._text=e.name,this._img=e.link,this._id=e._id,this._likes=e.likes,this._Cardowner=e.owner,this._cardSelector=t,this._handleCardClick=i,this._handleTrashClick=s,this._addLike=n.addLike,this._deleteLike=n.deleteLike,this._deleteCard=n.deleteCard}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".gallery__item-img"),t=this._element.querySelector(".gallery__item-name"),i=document.querySelector(".profile__name").id;return e.src=this._img,e.alt=this._text,t.textContent=this._text,this._element.id=this._id,this._initLike(i),this._deleteIconVisibility(i),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._Cardowner._id&&(this._element.querySelector(".gallery__item-trash-btn").style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._element.querySelector(".gallery__like-btn").classList.add("gallery__like-btn_active");const t=this._element.querySelector(".gllery__like-count");void 0!==this._likes?t.textContent=this._likes.length:t.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._element.querySelector(".gallery__like-btn").addEventListener("click",this._handleLikeBtn),this._element.querySelector(".gallery__item-trash-btn").addEventListener("click",(()=>{this._handleTrashClick(this._id,this._element)})),this._element.querySelector(".gallery__item-img").addEventListener("click",this._handleCardClick)}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{constructor(e){t(this,"_handleEscClose",(e=>{"Escape"===e.key&&document.querySelector(".popup_opened")&&this.close()})),t(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class s extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t)},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return this._formElemet.querySelectorAll(".popup__input").forEach((t=>{e[t.name]=[t.value]})),e}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class n{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=document.querySelector(t)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this._hasInvalidInput(e)?(t.classList.add(this._inactiveBtnClass),t.disabled=!0):(t.classList.remove(this._inactiveBtnClass),t.disabled=!1)}_setEventListeners(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this.toggleButtonState(e,t),e.forEach((i=>{i.addEventListener("input",(()=>{this._checkInputValidity(i),this.toggleButtonState(e,t)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const r={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},l=document.forms.profileform,o=l.elements.profileName,a=l.elements.profileAboutMe,_=document.forms.placeform;function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const u=document.querySelector("button.profile__edit-btn"),p=document.querySelector("button.profile__add-btn"),h=document.querySelector(".profile__edit-avatar"),d=document.querySelector(".profile__name"),m=new Array,v=new class extends i{constructor(e,t,i){super(i),this._popupImg=this._popup.querySelector(e),this._popupTitle=this._popup.querySelector(t)}open(e,t){this._src=e,this._title=t,this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title),super.open()}}(".popup__img",".popup__img-title",".popup_type_img"),f=new class extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._cardEl),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e,t){super.open(),this._popup.id=e,this._cardEl=t}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}(".popup_type_delete",(function(e){L.deleteCard(e.id).then((()=>{e.remove(),e=null,f.close()})).catch((e=>{console.log(e)}))})),b=new s(".popup_type_avatar",(function(e){q(!0,".popup__submit-btn_place_avatar"),L.editProfileAvatar(e.avatarImageLink).then((()=>{g.setUserAvatar({avatar:e.avatarImageLink}),b.close()})).catch((e=>{C(e)})).finally((()=>{q(!1,".popup__submit-btn_place_avatar")}))})),y=new s(".popup_type_new-card",(function(e){const t=k({link:e.placeImageLink,name:e.placeName,owner:{_id:d.id}});q(!0,".popup__submit-btn_place_new-card"),L.createNewCard(e.placeImageLink,e.placeName).then((e=>{t.id=e._id,y.close(),_.reset(),w.toggleButtonState()})).catch((e=>{C(e)})).finally((()=>{q(!1,".popup__submit-btn_place_new-card")}))})),E=new s(".popup_type_profile",(function(e){g.setUserInfo({name:e.profileName,about:e.profileAboutMe}),q(!0,".popup__submit-btn_place_profile"),L.editProfile({name:e.profileName,about:e.profileAboutMe}).then((()=>{E.close()})).catch((e=>{console.log(e)})).finally((()=>{q(!1,".popup__submit-btn_place_profile")})),I.toggleButtonState()})),S=new class{constructor(e,t){let{data:i,renderer:s}=e;this._items=i,this._renderer=s,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderer(){this._items.forEach((e=>{this._renderer(e)}))}}({data:m,renderer:k},".gallery__list"),g=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i)}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._nameElement.id=e._id,this._jobElement.textContent=e.about}setUserAvatar(e){let{avatar:t,name:i=null}=e;this._avatar.src=t,i&&(this._avatar.alt=i)}}(".profile__name",".profile__about-me",".profile__avatar");h.addEventListener("click",(()=>{b.open()}));const L=new class{constructor(e){c(this,"getInitialCards",(()=>this._call("/cards","GET"))),c(this,"getUserData",(()=>this._call("/users/me","GET"))),c(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),c(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),c(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t[0],about:i[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}editProfileAvatar(e){return this._call("/users/me/avatar ","PATCH",{avatar:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function C(e){const t=document.querySelector(".profile__error");t.textContent=e,t.style.display="block"}function k(t){const i=new e(t,"#gallery-item-template",(()=>{v.open(t.link,t.name)}),(()=>{f.open(t._id,i)}),L).generateCard();return S.addItem(i),i}function q(e,t){document.querySelector(t).textContent=e?"...Saving":"Save"}L.init().then((e=>{let[t,i]=e;g.setUserInfo(t),g.setUserAvatar({avatar:t.avatar,name:t.name}),i.forEach((e=>{m.push(e)})),S.renderer()})).catch((e=>{C(e)})),p.addEventListener("click",(()=>y.open())),u.addEventListener("click",(()=>{const{name:e,about:t}=g.getUserInfo();o.value=e,a.value=t,E.open()}));const w=new n(r,".popup__form_type_new-card");w.enableValidation(),new n(r,".popup__form_type_avatar").enableValidation();const I=new n(r,".popup__form_type_profile");I.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TSxRQUFRcUMsR0FDVkEsRUEwRVQsU0FBU2hFLEVBQWNpRSxFQUFXQyxHQUNsQnpMLFNBQVMxQixjQUFjbU4sR0FFN0I3TSxZQURMNE0sRUFDbUIsWUFHQSxPQW5JeEJ0TixFQUFJOE0sT0FDSC9ELE1BQUssSUFBa0IsSUFBaEI5RixFQUFLdUssR0FBVyxFQUN0QmhFLEVBQVNjLFlBQVlySCxHQUNyQnVHLEVBQVNDLGNBQWMsQ0FBQ0MsT0FBUXpHLEVBQUt5RyxPQUFPNUksS0FBTW1DLEVBQUtuQyxPQUN2RDBNLEVBQU01SSxTQUFTa0UsSUFBVWQsRUFBVXlGLEtBQUszRSxNQUN4QzRCLEVBQVNFLGNBRVY1QixPQUFRQyxJQUNQVSxFQUFZVixNQWdFYm5CLEVBQW1CNUUsaUJBQWlCLFNBQVMsSUFBTTJHLEVBQWFoRyxTQTJDakVnRSxFQUFlM0UsaUJBQWlCLFNBQVMsS0FDdkMsTUFBTSxLQUFDcEMsRUFBRCxNQUFPeUosR0FBVWYsRUFBU2tDLGNBQ2hDdkIsRUFBQUEsTUFBNkJySixFQUM3QnFKLEVBQUFBLE1BQWdDSSxFQUNoQ0YsRUFBYXhHLFVBbUJmLE1BQU11RyxFQUFtQixJQUFJbkYsRUFBY2tGLEVBQWlCLDhCQUM1REMsRUFBaUJsRCxtQkFFVyxJQUFJakMsRUFBY2tGLEVBQWlCLDRCQUMzQ2pELG1CQUVwQixNQUFNdUQsRUFBbUIsSUFBSXhGLEVBQWNrRixFQUFpQiw2QkFDNURNLEVBQWlCdkQsbUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKCBkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlVHJhc2hDbGljaywgYXBpKSB7XHJcbiAgICAgIHRoaXMuX3RleHQgICAgICAgICAgICAgID0gZGF0YS5uYW1lO1xyXG4gICAgICB0aGlzLl9pbWcgICAgICAgICAgICAgID0gZGF0YS5saW5rO1xyXG4gICAgICB0aGlzLl9pZCAgICAgICAgICAgICAgICA9IGRhdGEuX2lkO1xyXG4gICAgICB0aGlzLl9saWtlcyAgICAgICAgICAgICA9IGRhdGEubGlrZXM7XHJcbiAgICAgIHRoaXMuX0NhcmRvd25lciAgICAgICAgID0gZGF0YS5vd25lcjtcclxuICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yICAgICAgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayAgID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgICB0aGlzLl9oYW5kbGVUcmFzaENsaWNrICA9IGhhbmRsZVRyYXNoQ2xpY2s7XHJcbiAgICAgIHRoaXMuX2FkZExpa2UgICAgICAgICAgID0gYXBpLmFkZExpa2U7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUxpa2UgICAgICAgID0gYXBpLmRlbGV0ZUxpa2U7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUNhcmQgICAgICAgID0gYXBpLmRlbGV0ZUNhcmQ7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgICAgLmNvbnRlbnRcclxuICAgICAgICAucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpXHJcbiAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICBcclxuICAgICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgY29uc3QgZ2FsbGVyeUl0ZW1JbWcgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1pbWdcIik7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlJdGVtTmFtZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLW5hbWVcIik7XHJcbiAgICAgIGNvbnN0IG15SWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIikuaWQ7XHJcblxyXG4gICAgICBnYWxsZXJ5SXRlbUltZy5zcmMgPSB0aGlzLl9pbWc7XHJcbiAgICAgIGdhbGxlcnlJdGVtSW1nLmFsdCA9IHRoaXMuX3RleHQ7XHJcbiAgICAgIGdhbGxlcnlJdGVtTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX3RleHQ7XHJcbiBcclxuICAgICAgdGhpcy5fZWxlbWVudC5pZCA9IHRoaXMuX2lkO1xyXG4gICAgICB0aGlzLl9pbml0TGlrZShteUlkKTtcclxuICAgICAgdGhpcy4gX2RlbGV0ZUljb25WaXNpYmlsaXR5KG15SWQpO1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIF9kZWxldGVJY29uVmlzaWJpbGl0eSh1c2VySWQpe1xyXG4gICAgICBpZih1c2VySWQgIT0gIHRoaXMuX0NhcmRvd25lci5faWQpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS10cmFzaC1idG5cIikuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaW5pdExpa2UodXNlcklkKXtcclxuICAgICAgaWYodGhpcy5fdXNlckV4aXN0cyh1c2VySWQpKSB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmNsYXNzTGlzdC5hZGQoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpOyBcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBnYWxsZXJ5bGlrZUNvdW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdsbGVyeV9fbGlrZS1jb3VudFwiKTtcclxuICAgICAgaWYodHlwZW9mIHRoaXMuX2xpa2VzICE9PSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgID0gMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF91c2VyRXhpc3RzKGlkKSB7XHJcbiAgICAgIGlmKHR5cGVvZiB0aGlzLl9saWtlcyAhPT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpa2VzLnNvbWUoZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgcmV0dXJuIHVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG5cclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgdGhpcy5faGFuZGxlTGlrZUJ0bik7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLXRyYXNoLWJ0blwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwoKSA9Pnt0aGlzLl9oYW5kbGVUcmFzaENsaWNrKHRoaXMuX2lkLCB0aGlzLl9lbGVtZW50KX0pO1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1pbWdcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNhcmRDbGljayk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGFuZGxlTGlrZUJ0biA9ICgpID0+IHtcclxuICAgICAgY29uc3QgbGlrZUJ0biA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKTtcclxuICAgICAgY29uc3QgZ2FsbGVyeWxpa2VDb3VudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nbGxlcnlfX2xpa2UtY291bnRcIik7XHJcbiAgICAgIGlmKGxpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdnYWxsZXJ5X19saWtlLWJ0bl9hY3RpdmUnKSl7XHJcbiAgICAgICAgdGhpcy5fZGVsZXRlTGlrZSh0aGlzLl9lbGVtZW50LmlkKTtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50IC0tO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2FkZExpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCArKztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIikuY2xhc3NMaXN0LnRvZ2dsZSgnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJyk7XHJcblxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICB9XHJcbiAgfSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciApIHtcclxuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIC8qKiBwb3B1cHMgY2xvc2UgY2xpY2sgcmVtb3ZlIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBvcGVuIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PntcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgICAgICBpZihwb3B1cCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsICB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVDbGlja0Nsb3NlUG9wdXAgPSAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKSB8fFxyXG4gICAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZVwiKSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCApIHtcclxuICAgICAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgID0gICBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0ICAgICAgICA9ICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRzQXJyID0gdGhpcy5fZm9ybUVsZW1ldC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcclxuICAgICAgICAgICAgaW5wdXRzQXJyLmZvckVhY2goaW5wdXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBbaW5wdXQudmFsdWVdO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogVGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgbWV0aG9kIG9mIHRoZSBQb3B1cFdpdGhGb3JtIGNsYXNzXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIF9oYW5kbGVTdWJtaXQgPShldnQpID0+e1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9ICB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KGlucHV0cyk7XHJcbiAgICAgICAgICAgIC8vdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKCBjb25maWcsIGZvcm1FbCApe1xyXG4gICAgICB0aGlzLl9mb3JtU2VsZWN0b3IgICAgICAgICA9IGNvbmZpZy5mb3JtU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2Zvcm1JbnB1dHNGaWVsZFNldCAgID0gY29uZmlnLmZvcm1JbnB1dHNGaWVsZFNldDtcclxuICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciAgICAgICAgPSBjb25maWcuaW5wdXRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuU2VsZWN0b3IgICAgPSBjb25maWcuc3VibWl0QnRuU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MgICAgID0gY29uZmlnLmluYWN0aXZlQnRuQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyQ2xhc3MgICAgICAgID0gY29uZmlnLmlucHV0RXJyQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MgID0gY29uZmlnLmlucHV0RXJyQWN0aXZlQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbCAgICAgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtRWwpO1xyXG4gICAgfVxyXG5cclxuICAgIF9zaG93SW5wdXRFcnIgKGlucHV0RWwpIHtcclxuICAgICAgY29uc3QgZXJyRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgICAgXHJcbiAgICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVyckNsYXNzKTtcclxuICAgICAgZXJyRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgICBlcnJFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oaWRlSW5wdXRFcnJvciAoaW5wdXRFbCkge1xyXG4gICAgICBjb25zdCBlcnJFbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG5cclxuICAgICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyQ2xhc3MpO1xyXG4gICAgICBlcnJFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MpO1xyXG4gICAgICBlcnJFbC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrSW5wdXRWYWxpZGl0eSAoaW5wdXRFbCkge1xyXG4gICAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnIoaW5wdXRFbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaGFzSW52YWxpZElucHV0IChpbnB1dExzdCkge1xyXG4gICAgICByZXR1cm4gaW5wdXRMc3Quc29tZSgoaW5wdXRFbCkgPT4gIWlucHV0RWwudmFsaWRpdHkudmFsaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlICgpIHtcclxuICAgICAgY29uc3QgaW5wdXRMc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgY29uc3QgYnRuRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoaW5wdXRMc3QpKSB7XHJcbiAgICAgICAgYnRuRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzKTtcclxuICAgICAgICBidG5FbC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnRuRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzKTtcclxuICAgICAgICBidG5FbC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzICgpIHtcclxuICAgICAgY29uc3QgaW5wdXRMc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgY29uc3QgYnRuRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMc3QsIGJ0bkVsKTtcclxuICAgICAgaW5wdXRMc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHsgICBcclxuICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKTtcclxuICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMc3QsIGJ0bkVsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IGV2dC5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgIH1cclxuXHJcbiAgfSIsImV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXHJcbiAgICBmb3JtSW5wdXRzRmllbGRTZXQ6IFwiLnBvcHVwX19mb3JtLXNldFwiLFxyXG4gICAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2lucHV0XCIsXHJcbiAgICBzdWJtaXRCdG5TZWxlY3RvcjogXCIucG9wdXBfX3N1Ym1pdC1idG5cIixcclxuICAgIGluYWN0aXZlQnRuQ2xhc3M6IFwiYnV0dG9uX2luYWN0aXZlXCIsXHJcbiAgICBpbnB1dEVyckNsYXNzOiBcInBvcHVwX19pbnB1dC10ZXh0X3R5cGVfZXJyb3JcIixcclxuICAgIGlucHV0RXJyQWN0aXZlQ2xhc3M6IFwicG9wdXBfX2lucHV0LXRleHQtZXJyb3JfYWN0aXZlXCJcclxuICB9XHJcblxyXG5cclxuLyoqIHByb2ZpbGUgcG9wdXAgZWxlbWVudHMgKi9cclxuY29uc3QgcHJvZmlsZUZvcm0gICAgICAgICAgICAgICAgICA9IGRvY3VtZW50LmZvcm1zLnByb2ZpbGVmb3JtO1xyXG5leHBvcnQgY29uc3QgaW5wdXROYW1lICAgICAgICAgICAgID0gcHJvZmlsZUZvcm0uZWxlbWVudHMucHJvZmlsZU5hbWU7XHJcbmV4cG9ydCBjb25zdCBpbnB1dEFib3V0TWUgICAgICAgICAgPSBwcm9maWxlRm9ybS5lbGVtZW50cy5wcm9maWxlQWJvdXRNZTtcclxuZXhwb3J0IGNvbnN0IHBsYWNlRm9ybSAgICAgICAgICAgICA9IGRvY3VtZW50LmZvcm1zLnBsYWNlZm9ybTtcclxuXHJcbmV4cG9ydCBjb25zdCBnYWxsZXJ5TGlzdFNlbGVjdG9yICA9IFwiLmdhbGxlcnlfX2xpc3RcIjtcclxuXHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tICBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtYXRpb24uanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcclxuXHJcbi8qKiBtYWluIGJ1dHRvbnMgKi9cclxuY29uc3QgcHJvZmlsZUVkaXRCdG4gICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5wcm9maWxlX19lZGl0LWJ0blwiKTtcclxuY29uc3Qgb3BlTmV3Q2FyZFBvcHVwQnRuICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJFZGl0QnRuICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYXZhdGFyXCIpXHJcbi8qKiBwcm9maWxlIGRhdGEgZWxlbWVudHMgKi9cclxuY29uc3QgcHJvZmlsZU5hbWUgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5cclxuXHJcbmNvbnN0IGluaXRDYXJkcyA9IG5ldyBBcnJheSgpO1xyXG5cclxuY29uc3QgcG9wdXBDYXJkSXRlbSAgICAgICA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF9faW1nXCIsIFwiLnBvcHVwX19pbWctdGl0bGVcIiwgXCIucG9wdXBfdHlwZV9pbWdcIik7XHJcbmNvbnN0IHBvcHVwQ29uZmlybSAgICAgICAgPSBuZXcgUG9wdXBXaXRoQ29uZmlybWF0aW9uKFwiLnBvcHVwX3R5cGVfZGVsZXRlXCIsIGhhbmRsZURlbGV0ZSk7XHJcbmNvbnN0IEVkaXRBdmF0YXJQb3B1cCAgICAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cF90eXBlX2F2YXRhclwiLCBoYW5kbGVFZGl0QXZhdGFyKTtcclxuY29uc3QgbmV3Q2FyZFBvcHVwICAgICAgICA9IG5ldyBQb3B1cFdpdGhGb3JtIChcIi5wb3B1cF90eXBlX25ldy1jYXJkXCIsIGhhbmRsZUNyZWF0ZU5ld0NhcmQpO1xyXG5jb25zdCBwcm9maWxlUG9wdXAgICAgICAgID0gbmV3IFBvcHVwV2l0aEZvcm0gKFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLCAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xyXG5jb25zdCBjYXJkTGlzdCAgICAgICAgICAgID0gbmV3IFNlY3Rpb24oe2RhdGE6IGluaXRDYXJkcywgcmVuZGVyZXI6IGFkZEdhbGxlcnlDYXJkSXRlbX0sIGNvbnN0YW50cy5nYWxsZXJ5TGlzdFNlbGVjdG9yKTtcclxuY29uc3QgdXNlckluZm8gICAgICAgICAgICA9IG5ldyBVc2VySW5mbyhcIi5wcm9maWxlX19uYW1lXCIsIFwiLnByb2ZpbGVfX2Fib3V0LW1lXCIsIFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuXHJcblxyXG5hdmF0YXJFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgKCkgPT4ge0VkaXRBdmF0YXJQb3B1cC5vcGVuKCl9KTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiOWI2MjFmMGYtNWRmZS00M2YxLTk1ZmQtZTljYzE4OGJjYzM1XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogaW5pdGlhYWwgdXNlciBpbmZvIGFuZCBnYWxsZXJ5IENhcmRzIGZyb21cclxuICovXHJcbmFwaS5pbml0KClcclxuLnRoZW4oKFt1c2VyLGNhcmRzXSkgPT4ge1xyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXIpO1xyXG4gIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoe2F2YXRhcjogdXNlci5hdmF0YXIsbmFtZTogdXNlci5uYW1lfSk7XHJcbiAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge2luaXRDYXJkcy5wdXNoKGNhcmQpO30pXHJcbiAgY2FyZExpc3QucmVuZGVyZXIoKTtcclxufSlcclxuLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgaGFuZGxlRXJyb3IoZXJyKTtcclxufSlcclxuXHJcbi8qKlxyXG4gKiBzZXQgRXJyb3IgZGVzY3JpcHRpb24gb24gdG9wIG9mIHRoZSBwYWdlXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIpIHtcclxuICBjb25zdCBlcnJvckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lcnJvclwiKTtcclxuICBlcnJvckVsLnRleHRDb250ZW50ID0gZXJyO1xyXG4gIGVycm9yRWwuc3R5bGUuZGlzcGxheSAgPSBcImJsb2NrXCI7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBoYW5kbGUgZWRpdCBwb2ZpbGUgYXZhdGFyIGltYWdlXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVFZGl0QXZhdGFyIChpbnB1dHMpIHtcclxuICByZW5kZXJMb2FkaW5nKHRydWUsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX2F2YXRhclwiKTtcclxuICBhcGkuZWRpdFByb2ZpbGVBdmF0YXIoaW5wdXRzLmF2YXRhckltYWdlTGluaylcclxuICAudGhlbiAoKCkgPT4ge1xyXG4gICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih7YXZhdGFyOiBpbnB1dHMuYXZhdGFySW1hZ2VMaW5rfSlcclxuICAgIEVkaXRBdmF0YXJQb3B1cC5jbG9zZSgpO1xyXG4gIH0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBoYW5kbGVFcnJvcihlcnIpO1xyXG4gIH0pXHJcbiAgLmZpbmFsbHkoKCkgPT57XHJcbiAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9hdmF0YXJcIik7XHJcbiAgfSlcclxuICBcclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZCBuZXcgY2FyZCBpdGVtIHRvIGdhbGxlcnlcclxuICovXHJcbmZ1bmN0aW9uICBhZGRHYWxsZXJ5Q2FyZEl0ZW0gKGl0ZW0pIHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICBpdGVtLCBcclxuICAgIFwiI2dhbGxlcnktaXRlbS10ZW1wbGF0ZVwiLFxyXG4gICAgKCkgPT4geyBwb3B1cENhcmRJdGVtLm9wZW4oaXRlbS5saW5rLCBpdGVtLm5hbWUpOyB9LFxyXG4gICAgKCkgPT4geyBwb3B1cENvbmZpcm0ub3BlbihpdGVtLl9pZCwgY2FyZEVsZW1lbnQpOyB9LFxyXG4gICAgYXBpKTtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgY2FyZExpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59XHJcblxyXG4vKipcclxuICogZGVsZXRlIGNhcmQgaXRlbSBmcm9tIGdhbGxlcnlcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZShjYXJkKSB7XHJcbiAgYXBpLmRlbGV0ZUNhcmQoY2FyZC5pZClcclxuICAudGhlbigoKSA9PntcclxuICAgIGNhcmQucmVtb3ZlKCk7XHJcbiAgICBjYXJkID0gbnVsbDtcclxuICAgIHBvcHVwQ29uZmlybS5jbG9zZSgpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgbmV3IGNhcmQgaXRlbSB0byBnYWxsZXJ5XHJcbiAqL1xyXG4gb3BlTmV3Q2FyZFBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBuZXdDYXJkUG9wdXAub3BlbigpKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNyZWF0ZU5ld0NhcmQgKGlucHV0cykge1xyXG4gIGNvbnN0IG5ld0NhcmQgPSBhZGRHYWxsZXJ5Q2FyZEl0ZW0oe2xpbms6IGlucHV0cy5wbGFjZUltYWdlTGluaywgbmFtZTogaW5wdXRzLnBsYWNlTmFtZSwgb3duZXI6IHtfaWQ6IHByb2ZpbGVOYW1lLmlkfX0pO1xyXG5cclxuICByZW5kZXJMb2FkaW5nKHRydWUsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX25ldy1jYXJkXCIpO1xyXG4gIGFwaS5jcmVhdGVOZXdDYXJkKGlucHV0cy5wbGFjZUltYWdlTGluayxpbnB1dHMucGxhY2VOYW1lKVxyXG4gIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgbmV3Q2FyZC5pZCA9IGRhdGEuX2lkO1xyXG4gICAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICBjb25zdGFudHMucGxhY2VGb3JtLnJlc2V0KCk7XHJcbiAgICBuZXdDYXJkVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGhhbmRsZUVycm9yKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX25ldy1jYXJkXCIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBlZGl0IHVzZXIgcHJvZmlsZSBkYXRhXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCAoaW5wdXRzKSB7XHJcbiAgdXNlckluZm8uc2V0VXNlckluZm8oe25hbWU6IGlucHV0cy5wcm9maWxlTmFtZSwgYWJvdXQ6IGlucHV0cy5wcm9maWxlQWJvdXRNZX0pXHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG4gIGFwaS5lZGl0UHJvZmlsZSh7bmFtZTogaW5wdXRzLnByb2ZpbGVOYW1lLCBhYm91dDogaW5wdXRzLnByb2ZpbGVBYm91dE1lfSlcclxuICAudGhlbiAoKCkgPT4ge1xyXG4gICAgcHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX3Byb2ZpbGVcIik7XHJcbiAgfSlcclxuICBwcm9maWxlVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgZXZlbnQgbGlzdGVuZXIgdG8gZWRpdCB1c2VyIHByb2ZpbGUgaW5mb1xyXG4gKi9cclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjb25zdCB7bmFtZSwgYWJvdXQgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgY29uc3RhbnRzLmlucHV0TmFtZS52YWx1ZSAgPSBuYW1lO1xyXG4gIGNvbnN0YW50cy5pbnB1dEFib3V0TWUudmFsdWUgID0gYWJvdXQ7XHJcbiAgcHJvZmlsZVBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG4vKipcclxuICogY2hhbmdlIGJ1dHRvbiB0ZXh0IHRvIC4uc2F2aW5nIHVudGlsIHByb2Nlc3MgZW5kc1xyXG4gKi9cclxuZnVuY3Rpb24gcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGJ0blNlbGVjdG9yKSB7XHJcbiAgY29uc3QgYnRuRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGJ0blNlbGVjdG9yKTtcclxuICBpZihpc0xvYWRpbmcpIHtcclxuICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCIuLi5TYXZpbmdcIjsgXHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgYnRuRWwudGV4dENvbnRlbnQgPSBcIlNhdmVcIjsgXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogYWRkIGZvcm0gdmFsaWRhdGlvbiBmb3IgYWxsIGZvcm1zXHJcbiAqL1xyXG5jb25zdCBuZXdDYXJkVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLmNvbmZpZyxcIi5wb3B1cF9fZm9ybV90eXBlX25ldy1jYXJkXCIpO1xyXG5uZXdDYXJkVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbmNvbnN0IGVkaXRBdmF0YXJWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25zdGFudHMuY29uZmlnLFwiLnBvcHVwX19mb3JtX3R5cGVfYXZhdGFyXCIpO1xyXG5lZGl0QXZhdGFyVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25zdGFudHMuY29uZmlnLFwiLnBvcHVwX19mb3JtX3R5cGVfcHJvZmlsZVwiKTtcclxucHJvZmlsZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXB7XHJcbiAgICBjb25zdHJ1Y3RvciAoIGltZ1NlbGVjdG9yLCB0aXRsZVNlbGVjdG9yICxwb3B1cFNlbGVjdG9yICkge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwSW1nID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihpbWdTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IodGl0bGVTZWxlY3Rvcik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oc3JjLCB0aXRsZSApIHtcclxuICAgICAgICB0aGlzLl9zcmMgICA9IHNyYztcclxuICAgICAgICB0aGlzLl90aXRsZSA9IHRpdGxlO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwSW1nLnNyYyA9ICB0aGlzLl9zcmM7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcuYWx0ID0gIHRoaXMuX3RpdGxlO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwVGl0bGUudGV4dENvbnRlbnQgPSBgUGhvdG8gb2YgJHt0aGlzLl90aXRsZX1gO1xyXG4gICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uICBleHRlbmRzIFBvcHVwIHtcclxuICAgICAgICBjb25zdHJ1Y3RvciAoIHBvcHVwU2VsZWN0b3IsIGhhbmRsZUNvbmZpcm0gKSB7XHJcbiAgICAgICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDb25maXJtICAgICA9ICAgaGFuZGxlQ29uZmlybTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldCAgICAgICAgPSAgIHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogIGhhcyB0byBhZGQgdGhlIHN1Ym1pdCBldmVudCBoYW5kbGVyIHRvIHRoZSBmb3JtIGFuZCB0aGUgY2xpY2sgXHJcbiAgICAgICAgICAgICAqIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBjbG9zZSBpY29uLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsICB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIF9oYW5kbGVTdWJtaXQgPShldnQpID0+e1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNvbmZpcm0odGhpcy5fY2FyZEVsKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3BlbihpZCwgY2FyZEVsKSB7XHJcbiAgICAgICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgICAgICAgICAgdGhpcy5fcG9wdXAuaWQgPWlkO1xyXG4gICAgICAgICAgICB0aGlzLl9jYXJkRWwgPSBjYXJkRWxcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNsb3NlKCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSXQgbW9kaWZpZXMgdGhlIGNsb3NlKCkgcGFyZW50IG1ldGhvZCBcclxuICAgICAgICAgICAgICogaW4gb3JkZXIgdG8gcmVzZXQgdGhlIGZvcm0gb25jZSB0aGUgcG9wdXAgaXMgY2xvc2VkLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZXNldCgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IoIHsgZGF0YSwgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgICAgICAgPSBkYXRhLFxyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyICAgID0gcmVuZGVyZXI7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHJlbmRlcmVyKCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIFVzZXJJbmZvIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciByZW5kZXJpbmcgXHJcbiAgICAgKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXNlciBvbiB0aGUgcGFnZS4gVGhpcyBjbGFzcyBzaG91bGQ6XHJcbiAgICAgKiAtVGFrZSBhbiBvYmplY3Qgd2l0aCB0aGUgc2VsZWN0b3JzIG9mIHR3byBlbGVtZW50cyBpbnRvIHRoZSBjb25zdHJ1Y3RvcjogXHJcbiAgICAgKiBvbmUgY29udGFpbmluZyB0aGUgdXNlcidzIG5hbWUsIGFuZCBhbm90aGVyIGNvbnRhaW5pbmcgdGhlIHVzZXIncyBqb2IuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yICggbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJJbmZvKCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHJldHVybnMgYW4gb2JqZWN0IHdpdGggaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIuIFxyXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgaGFuZHkgZm9yIFxyXG4gICAgICAgICAqIGNhc2VzIHdoZW4gaXQncyBuZWNlc3NhcnkgdG8gZGlzcGxheSB0aGUgdXNlciBkYXRhIGluIHRoZSBvcGVuIGZvcm0uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgICAgICAgIGFib3V0OiB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFVzZXJJbmZvKGRhdGEpe1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHRha2VzIG5ldyB1c2VyIGRhdGEgYW5kIGFkZHMgaXQgb24gdGhlIHBhZ2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgICA9IGRhdGEubmFtZTtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC5pZCAgICAgICAgICAgID0gZGF0YS5faWQ7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudCAgICA9IGRhdGEuYWJvdXQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHNldFVzZXJBdmF0YXIoe2F2YXRhciwgbmFtZSA9IG51bGx9KSB7XHJcbiAgICAgICAgdGhpcy5fYXZhdGFyLnNyYyA9IGF2YXRhcjtcclxuICAgICAgICBpZihuYW1lKXtcclxuICAgICAgICAgICAgdGhpcy5fYXZhdGFyLmFsdCA9IG5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgfVxyXG4gIFxyXG4gICAgX2NhbGwoYWN0aW9uLCBtZXRob2QsIGRhdGEpIHtcclxuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCArIGFjdGlvbiwge1xyXG4gICAgICAgIG1ldGhvZDogbWV0aG9kLFxyXG4gICAgICAgIGhlYWRlcnM6ICB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYocmVzLm9rKSB7XHJcbiAgICAgICAgICByZXR1cm4gIHJlcy5qc29uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRJbml0aWFsQ2FyZHMgPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL2NhcmRzXCIsJ0dFVCcpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2V0VXNlckRhdGEgPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lXCIsJ0dFVCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBlZGl0UHJvZmlsZSh7bmFtZSwgYWJvdXR9KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lXCIsJ1BBVENIJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBhYm91dDogYWJvdXRbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTmV3Q2FyZCAobGluaywgbmFtZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdQT1NUJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBsaW5rOiBsaW5rWzBdXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZExpa2UgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwnUFVUJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdERUxFVEUnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVDYXJkID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRQcm9maWxlQXZhdGFyKHVybCl7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lL2F2YXRhciBcIiwnUEFUQ0gnLHtcclxuICAgICAgICBhdmF0YXIgOiB1cmxbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJEYXRhKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIFxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZVRyYXNoQ2xpY2siLCJhcGkiLCJsaWtlQnRuIiwidGhpcyIsIl9lbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImdhbGxlcnlsaWtlQ291bnQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsIl9kZWxldGVMaWtlIiwiaWQiLCJ0ZXh0Q29udGVudCIsIl9hZGRMaWtlIiwidG9nZ2xlIiwiX3RleHQiLCJuYW1lIiwiX2ltZyIsImxpbmsiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9DYXJkb3duZXIiLCJvd25lciIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZVRyYXNoQ2xpY2siLCJhZGRMaWtlIiwiZGVsZXRlTGlrZSIsIl9kZWxldGVDYXJkIiwiZGVsZXRlQ2FyZCIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImdlbmVyYXRlQ2FyZCIsImdhbGxlcnlJdGVtSW1nIiwiZ2FsbGVyeUl0ZW1OYW1lIiwibXlJZCIsInNyYyIsImFsdCIsIl9pbml0TGlrZSIsIl9kZWxldGVJY29uVmlzaWJpbGl0eSIsIl9zZXRFdmVudExpc3RlbmVycyIsInVzZXJJZCIsInN0eWxlIiwidmlzaWJpbGl0eSIsIl91c2VyRXhpc3RzIiwiYWRkIiwibGVuZ3RoIiwic29tZSIsInVzZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2VCdG4iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJldnQiLCJrZXkiLCJjbG9zZSIsInRhcmdldCIsIl9wb3B1cCIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXJzIiwib3BlbiIsInNldEV2ZW50TGlzdGVuZXJzIiwiX2hhbmRsZUVzY0Nsb3NlIiwiX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwicHJldmVudERlZmF1bHQiLCJpbnB1dHMiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9mb3JtRWxlbWV0IiwiaW5wdXRWYWx1ZXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0IiwidmFsdWUiLCJfaGFuZGxlU3VibWl0IiwicmVzZXQiLCJGb3JtVmFsaWRhdG9yIiwiY29uZmlnIiwiZm9ybUVsIiwiX2Zvcm1TZWxlY3RvciIsImZvcm1TZWxlY3RvciIsIl9mb3JtSW5wdXRzRmllbGRTZXQiLCJmb3JtSW5wdXRzRmllbGRTZXQiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnRuU2VsZWN0b3IiLCJzdWJtaXRCdG5TZWxlY3RvciIsIl9pbmFjdGl2ZUJ0bkNsYXNzIiwiaW5hY3RpdmVCdG5DbGFzcyIsIl9pbnB1dEVyckNsYXNzIiwiaW5wdXRFcnJDbGFzcyIsIl9pbnB1dEVyckFjdGl2ZUNsYXNzIiwiaW5wdXRFcnJBY3RpdmVDbGFzcyIsIl9mb3JtRWwiLCJfc2hvd0lucHV0RXJyIiwiaW5wdXRFbCIsImVyckVsIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJpbnB1dExzdCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiQXJyYXkiLCJmcm9tIiwiYnRuRWwiLCJkaXNhYmxlZCIsImVuYWJsZVZhbGlkYXRpb24iLCJwcm9maWxlRm9ybSIsImZvcm1zIiwicHJvZmlsZWZvcm0iLCJpbnB1dE5hbWUiLCJlbGVtZW50cyIsInByb2ZpbGVOYW1lIiwiaW5wdXRBYm91dE1lIiwicHJvZmlsZUFib3V0TWUiLCJwbGFjZUZvcm0iLCJwbGFjZWZvcm0iLCJwcm9maWxlRWRpdEJ0biIsIm9wZU5ld0NhcmRQb3B1cEJ0biIsImF2YXRhckVkaXRCdG4iLCJpbml0Q2FyZHMiLCJwb3B1cENhcmRJdGVtIiwiaW1nU2VsZWN0b3IiLCJ0aXRsZVNlbGVjdG9yIiwiX3BvcHVwSW1nIiwiX3BvcHVwVGl0bGUiLCJ0aXRsZSIsIl9zcmMiLCJfdGl0bGUiLCJwb3B1cENvbmZpcm0iLCJoYW5kbGVDb25maXJtIiwiX2hhbmRsZUNvbmZpcm0iLCJfY2FyZEVsIiwiY2FyZEVsIiwiY2FyZCIsInRoZW4iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJFZGl0QXZhdGFyUG9wdXAiLCJyZW5kZXJMb2FkaW5nIiwiZWRpdFByb2ZpbGVBdmF0YXIiLCJhdmF0YXJJbWFnZUxpbmsiLCJ1c2VySW5mbyIsInNldFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJoYW5kbGVFcnJvciIsImZpbmFsbHkiLCJuZXdDYXJkUG9wdXAiLCJuZXdDYXJkIiwiYWRkR2FsbGVyeUNhcmRJdGVtIiwicGxhY2VJbWFnZUxpbmsiLCJwbGFjZU5hbWUiLCJjcmVhdGVOZXdDYXJkIiwiY29uc3RhbnRzIiwibmV3Q2FyZFZhbGlkYXRvciIsInByb2ZpbGVQb3B1cCIsInNldFVzZXJJbmZvIiwiYWJvdXQiLCJlZGl0UHJvZmlsZSIsInByb2ZpbGVWYWxpZGF0b3IiLCJjYXJkTGlzdCIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiaXRlbSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsIm9wdGlvbnMiLCJfY2FsbCIsImNhcmRJZCIsIl9vcHRpb25zIiwiYWN0aW9uIiwibWV0aG9kIiwiZmV0Y2giLCJiYXNlVXJsIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInVybCIsImluaXQiLCJhbGwiLCJnZXRVc2VyRGF0YSIsImdldEluaXRpYWxDYXJkcyIsImF1dGhvcml6YXRpb24iLCJlcnJvckVsIiwiZGlzcGxheSIsImNhcmRFbGVtZW50IiwiaXNMb2FkaW5nIiwiYnRuU2VsZWN0b3IiLCJjYXJkcyIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9