!function(){"use strict";class e{constructor(e,t,i,s,r){var n,o;o=()=>{const e=this._element.querySelector(".gallery__like-btn"),t=this._element.querySelector(".gllery__like-count");e.classList.contains("gallery__like-btn_active")?(this._deleteLike(this._element.id),t.textContent--):(this._addLike(this._element.id),t.textContent++),this._element.querySelector(".gallery__like-btn").classList.toggle("gallery__like-btn_active")},(n="_handleLikeBtn")in this?Object.defineProperty(this,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[n]=o,this._text=e.name,this._img=e.link,this._id=e._id,this._likes=e.likes,this._Cardowner=e.owner,this._cardSelector=t,this._handleCardClick=i,this._handleTrashClick=s,this._addLike=r.addLike,this._deleteLike=r.deleteLike,this._deleteCard=r.deleteCard}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".gallery__item-img"),t=this._element.querySelector(".gallery__item-name"),i=document.querySelector(".profile__name").id;return e.src=this._img,e.alt=this._text,t.textContent=this._text,this._element.id=this._id,this._initLike(i),this._deleteIconVisibility(i),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._Cardowner._id&&(this._element.querySelector(".gallery__item-trash-btn").style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._element.querySelector(".gallery__like-btn").classList.add("gallery__like-btn_active");const t=this._element.querySelector(".gllery__like-count");void 0!==this._likes?t.textContent=this._likes.length:t.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._element.querySelector(".gallery__like-btn").addEventListener("click",this._handleLikeBtn),this._element.querySelector(".gallery__item-trash-btn").addEventListener("click",this._handleTrashClick),this._element.querySelector(".gallery__item-img").addEventListener("click",this._handleCardClick)}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{constructor(e){t(this,"_handleEscClose",(e=>{"Escape"===e.key&&document.querySelector(".popup_opened")&&this.close()})),t(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class s extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return this._formElemet.querySelectorAll(".popup__input").forEach((t=>{e[t.name]=[t.value]})),e}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class r extends i{constructor(e,t){let{src:i,title:s}=e;super(t),this._src=i,this._title=s}open(){super.open(),this._popupImg=this._popup.querySelector(".popup__img"),this._popupTitle=this._popup.querySelector(".popup__img-title"),this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title)}}class n extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._popup.id),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e){super.open(),this._popup.id=e}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class o{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=document.querySelector(t)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this._hasInvalidInput(e)?(t.classList.add(this._inactiveBtnClass),t.disabled=!0):(t.classList.remove(this._inactiveBtnClass),t.disabled=!1)}_setEventListeners(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this.toggleButtonState(e,t),e.forEach((i=>{i.addEventListener("input",(()=>{this._checkInputValidity(i),this.toggleButtonState(e,t)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const l={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},a=document.forms.profileform,c=a.elements.profileName,_=a.elements.profileAboutMe,u=document.forms.placeform;function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const p=document.querySelector("button.profile__edit-btn"),d=document.querySelector("button.profile__add-btn"),m=document.querySelector(".profile__name"),f=(document.querySelector(".profile__about-me"),document.querySelector(".profile__avatar"),document.querySelector(".gallery"),new Array),v=new class{constructor(e){h(this,"getInitialCards",(()=>this._call("/cards","GET"))),h(this,"getUserData",(()=>this._call("/users/me","GET"))),h(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),h(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),h(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t[0],about:i[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function y(e){const t=document.querySelector(".profile__error");t.textContent=e,t.style.display="block"}v.init().then((e=>{let[t,i]=e;b.setUserInfo(t),b.setUserAvatar({avatar:t.avatar,name:t.name}),i.forEach((e=>{f.push(e)})),E.renderer()})).catch((e=>{y(e)}));const E=new class{constructor(e,t){let{data:i,renderer:s}=e;this._items=i,this._renderer=s,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}renderer(){this._items.forEach((e=>{this._renderer(e)}))}}({data:f,renderer:S},".gallery__list"),b=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i)}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._nameElement.id=e._id,this._jobElement.textContent=e.about}setUserAvatar(e){let{avatar:t,name:i}=e;this._avatar.src=t,this._avatar.alt=i}}(".profile__name",".profile__about-me",".profile__avatar");function S(t){const i=new e(t,"#gallery-item-template",(()=>{new r({src:t.link,title:t.name},".popup_type_img").open()}),(()=>{new n(".popup_type_delete",L).open(t._id)}),v).generateCard();E.addItem(i)}const g=new s(".popup_type_new-card",(function(e){S({link:e.placeImageLink,name:e.placeName,owner:{_id:m.id}}),v.createNewCard(e.placeImageLink,e.placeName).then((e=>{console.log(e)})).catch((e=>{y(e)})),u.reset(),g.close(),k.toggleButtonState()}));function L(e){v.deleteCard(e).then((()=>{let e=document.querySelector(".gallery__item");e.remove(),e=null})).catch((e=>{alert(e)}))}d.addEventListener("click",(()=>g.open()));const C=new s(".popup_type_profile",(function(e){b.setUserInfo({name:e.profileName,about:e.profileAboutMe}),v.editProfile({name:e.profileName,about:e.profileAboutMe}).catch((e=>{console.log(e)})),q.toggleButtonState()}));p.addEventListener("click",(()=>{const{name:e,about:t}=b.getUserInfo();c.value=e,_.value=t,C.open()}));const k=new o(l,".popup__form_type_new-card");k.enableValidation();const q=new o(l,".popup__form_type_profile");q.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RixFQUFtQixJQUFJcEgsRUFBYytHLEVBQWlCLDZCQUM1REssRUFBaUJuRixtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV0l0aENvbmZpcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKCBkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlVHJhc2hDbGljaywgYXBpKSB7XHJcbiAgICAgIHRoaXMuX3RleHQgICAgICAgICAgICAgID0gZGF0YS5uYW1lO1xyXG4gICAgICB0aGlzLl9pbWcgICAgICAgICAgICAgID0gZGF0YS5saW5rO1xyXG4gICAgICB0aGlzLl9pZCAgICAgICAgICAgICAgICA9IGRhdGEuX2lkO1xyXG4gICAgICB0aGlzLl9saWtlcyAgICAgICAgICAgICA9IGRhdGEubGlrZXM7XHJcbiAgICAgIHRoaXMuX0NhcmRvd25lciAgICAgICAgID0gZGF0YS5vd25lcjtcclxuICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yICAgICAgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayAgID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgICB0aGlzLl9oYW5kbGVUcmFzaENsaWNrICA9IGhhbmRsZVRyYXNoQ2xpY2s7XHJcbiAgICAgIHRoaXMuX2FkZExpa2UgICAgICAgICAgID0gYXBpLmFkZExpa2U7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUxpa2UgICAgICAgID0gYXBpLmRlbGV0ZUxpa2U7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUNhcmQgICAgICAgID0gYXBpLmRlbGV0ZUNhcmQ7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgICAgLmNvbnRlbnRcclxuICAgICAgICAucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpXHJcbiAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICBcclxuICAgICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgY29uc3QgZ2FsbGVyeUl0ZW1JbWcgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1pbWdcIik7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlJdGVtTmFtZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLW5hbWVcIik7XHJcbiAgICAgIGNvbnN0IG15SWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIikuaWQ7XHJcblxyXG4gICAgICBnYWxsZXJ5SXRlbUltZy5zcmMgPSB0aGlzLl9pbWc7XHJcbiAgICAgIGdhbGxlcnlJdGVtSW1nLmFsdCA9IHRoaXMuX3RleHQ7XHJcbiAgICAgIGdhbGxlcnlJdGVtTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX3RleHQ7XHJcbiBcclxuICAgICAgdGhpcy5fZWxlbWVudC5pZCA9IHRoaXMuX2lkO1xyXG4gICAgICB0aGlzLl9pbml0TGlrZShteUlkKTtcclxuICAgICAgdGhpcy4gX2RlbGV0ZUljb25WaXNpYmlsaXR5KG15SWQpO1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIF9kZWxldGVJY29uVmlzaWJpbGl0eSh1c2VySWQpe1xyXG4gICAgICBpZih1c2VySWQgIT0gIHRoaXMuX0NhcmRvd25lci5faWQpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS10cmFzaC1idG5cIikuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaW5pdExpa2UodXNlcklkKXtcclxuICAgICAgaWYodGhpcy5fdXNlckV4aXN0cyh1c2VySWQpKSB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmNsYXNzTGlzdC5hZGQoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpOyBcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBnYWxsZXJ5bGlrZUNvdW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdsbGVyeV9fbGlrZS1jb3VudFwiKTtcclxuICAgICAgaWYodHlwZW9mIHRoaXMuX2xpa2VzICE9PSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgID0gMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF91c2VyRXhpc3RzKGlkKSB7XHJcbiAgICAgIGlmKHR5cGVvZiB0aGlzLl9saWtlcyAhPT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpa2VzLnNvbWUoZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgcmV0dXJuIHVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG5cclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgdGhpcy5faGFuZGxlTGlrZUJ0bik7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLXRyYXNoLWJ0blwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIix0aGlzLl9oYW5kbGVUcmFzaENsaWNrKTtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0taW1nXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDYXJkQ2xpY2spO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2hhbmRsZUxpa2VCdG4gPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxpa2VCdG4gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIik7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlsaWtlQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2xsZXJ5X19saWtlLWNvdW50XCIpO1xyXG4gICAgICBpZihsaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucygnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJykpe1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZUxpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCAtLTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLl9hZGRMaWtlKHRoaXMuX2VsZW1lbnQuaWQpO1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgKys7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmNsYXNzTGlzdC50b2dnbGUoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpO1xyXG5cclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgfVxyXG4gICAgICAgLypcclxuICAgIF9oYW5kbGVEZWxldGVHYWxsZXJ5Q2FyZEl0ZW0gPSAoKSA9PiB7XHJcbiAgICAgXHJcblxyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkKHRoaXMuX2VsZW1lbnQuaWQpXHJcbiAgICAgIC50aGVuKCgpID0+e1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGFsZXJ0KGVycik7XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRGVsZXRlID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkKHRoaXMuX2VsZW1lbnQuaWQpXHJcbiAgICAgIC50aGVuKCgpID0+e1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGFsZXJ0KGVycik7XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICAgICAgKi9cclxuICB9IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIH1cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBjbG9zZSBjbGljayByZW1vdmUgZXZlbnRzICovXHJcbiAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICAvKiogcG9wdXBzIG9wZW4gZXZlbnRzICovXHJcbiAgICAgICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+e1xyXG4gICAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgICAgIGlmKHBvcHVwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0gICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlQ2xpY2tDbG9zZVBvcHVwKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCA9IChldnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfb3BlbmVkXCIpIHx8XHJcbiAgICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX2Nsb3NlXCIpICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuXHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSAgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0ICkge1xyXG4gICAgICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCAgPSAgIGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQgICAgICAgID0gICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dHNBcnIgPSB0aGlzLl9mb3JtRWxlbWV0LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpO1xyXG4gICAgICAgICAgICBpbnB1dHNBcnIuZm9yRWFjaChpbnB1dCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IFtpbnB1dC52YWx1ZV07XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBzZXRFdmVudExpc3RlbmVycygpIHBhcmVudCBtZXRob2QuIFxyXG4gICAgICAgICAgICAgKiBUaGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBtZXRob2Qgb2YgdGhlIFBvcHVwV2l0aEZvcm0gY2xhc3NcclxuICAgICAgICAgICAgICogIGhhcyB0byBhZGQgdGhlIHN1Ym1pdCBldmVudCBoYW5kbGVyIHRvIHRoZSBmb3JtIGFuZCB0aGUgY2xpY2sgXHJcbiAgICAgICAgICAgICAqIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBjbG9zZSBpY29uLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgX2hhbmRsZVN1Ym1pdCA9KGV2dCkgPT57XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOyBcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRzID0gIHRoaXMuX2dldElucHV0VmFsdWVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQoaW5wdXRzKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXB7XHJcbiAgICBjb25zdHJ1Y3RvciAoIHtzcmMgLHRpdGxlIH0gLHBvcHVwU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fc3JjICAgPSBzcmM7XHJcbiAgICAgICAgdGhpcy5fdGl0bGUgPSB0aXRsZTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKCkge1xyXG4gICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgICAgICB0aGlzLl9wb3B1cEltZyA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltZ1wiKTtcclxuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1nLXRpdGxlXCIpO1xyXG5cclxuICAgICAgICB0aGlzLl9wb3B1cEltZy5zcmMgPSAgdGhpcy5fc3JjO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwSW1nLmFsdCA9ICB0aGlzLl90aXRsZTtcclxuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlLnRleHRDb250ZW50ID0gYFBob3RvIG9mICR7dGhpcy5fdGl0bGV9YDtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXSXRoQ29uZmlybSAgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yLCBoYW5kbGVDb25maXJtICkge1xyXG4gICAgICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlQ29uZmlybSAgICAgPSAgIGhhbmRsZUNvbmZpcm07XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQgICAgICAgID0gICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSXQgbW9kaWZpZXMgdGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgcGFyZW50IG1ldGhvZC4gXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZW1vdmVFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBfaGFuZGxlU3VibWl0ID0oZXZ0KSA9PntcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDb25maXJtKHRoaXMuX3BvcHVwLmlkKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3BlbihpZCkge1xyXG4gICAgICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwLmlkID1pZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNsb3NlKCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSXQgbW9kaWZpZXMgdGhlIGNsb3NlKCkgcGFyZW50IG1ldGhvZCBcclxuICAgICAgICAgICAgICogaW4gb3JkZXIgdG8gcmVzZXQgdGhlIGZvcm0gb25jZSB0aGUgcG9wdXAgaXMgY2xvc2VkLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZXNldCgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoIGNvbmZpZywgZm9ybUVsICl7XHJcbiAgICAgIHRoaXMuX2Zvcm1TZWxlY3RvciAgICAgICAgID0gY29uZmlnLmZvcm1TZWxlY3RvcjtcclxuICAgICAgdGhpcy5fZm9ybUlucHV0c0ZpZWxkU2V0ICAgPSBjb25maWcuZm9ybUlucHV0c0ZpZWxkU2V0O1xyXG4gICAgICB0aGlzLl9pbnB1dFNlbGVjdG9yICAgICAgICA9IGNvbmZpZy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdG5TZWxlY3RvciAgICA9IGNvbmZpZy5zdWJtaXRCdG5TZWxlY3RvcjtcclxuICAgICAgdGhpcy5faW5hY3RpdmVCdG5DbGFzcyAgICAgPSBjb25maWcuaW5hY3RpdmVCdG5DbGFzcztcclxuICAgICAgdGhpcy5faW5wdXRFcnJDbGFzcyAgICAgICAgPSBjb25maWcuaW5wdXRFcnJDbGFzcztcclxuICAgICAgdGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyAgPSBjb25maWcuaW5wdXRFcnJBY3RpdmVDbGFzcztcclxuICAgICAgdGhpcy5fZm9ybUVsICAgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm1FbCk7XHJcbiAgICB9XHJcblxyXG4gICAgX3Nob3dJbnB1dEVyciAoaW5wdXRFbCkge1xyXG4gICAgICBjb25zdCBlcnJFbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgICBcclxuICAgICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyQ2xhc3MpO1xyXG4gICAgICBlcnJFbC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICAgIGVyckVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yIChpbnB1dEVsKSB7XHJcbiAgICAgIGNvbnN0IGVyckVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcblxyXG4gICAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJDbGFzcyk7XHJcbiAgICAgIGVyckVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyk7XHJcbiAgICAgIGVyckVsLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBfY2hlY2tJbnB1dFZhbGlkaXR5IChpbnB1dEVsKSB7XHJcbiAgICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICAgIHRoaXMuX3Nob3dJbnB1dEVycihpbnB1dEVsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9oYXNJbnZhbGlkSW5wdXQgKGlucHV0THN0KSB7XHJcbiAgICAgIHJldHVybiBpbnB1dExzdC5zb21lKChpbnB1dEVsKSA9PiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUgKCkge1xyXG4gICAgICBjb25zdCBpbnB1dExzdCA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xyXG4gICAgICBjb25zdCBidG5FbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ0blNlbGVjdG9yKTtcclxuICAgICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dChpbnB1dExzdCkpIHtcclxuICAgICAgICBidG5FbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MpO1xyXG4gICAgICAgIGJ0bkVsLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBidG5FbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MpO1xyXG4gICAgICAgIGJ0bkVsLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMgKCkge1xyXG4gICAgICBjb25zdCBpbnB1dExzdCA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xyXG4gICAgICBjb25zdCBidG5FbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ0blNlbGVjdG9yKTtcclxuICAgICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZShpbnB1dExzdCwgYnRuRWwpO1xyXG4gICAgICBpbnB1dExzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XHJcbiAgICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4geyAgIFxyXG4gICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpO1xyXG4gICAgICAgICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZShpbnB1dExzdCwgYnRuRWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlbmFibGVWYWxpZGF0aW9uICgpIHtcclxuICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgdGhpcy5fZm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4gZXZ0LnByZXZlbnREZWZhdWx0KCkpO1xyXG4gICAgfVxyXG5cclxuICB9IiwiZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm1cIixcclxuICAgIGZvcm1JbnB1dHNGaWVsZFNldDogXCIucG9wdXBfX2Zvcm0tc2V0XCIsXHJcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcclxuICAgIHN1Ym1pdEJ0blNlbGVjdG9yOiBcIi5wb3B1cF9fc3VibWl0LWJ0blwiLFxyXG4gICAgaW5hY3RpdmVCdG5DbGFzczogXCJidXR0b25faW5hY3RpdmVcIixcclxuICAgIGlucHV0RXJyQ2xhc3M6IFwicG9wdXBfX2lucHV0LXRleHRfdHlwZV9lcnJvclwiLFxyXG4gICAgaW5wdXRFcnJBY3RpdmVDbGFzczogXCJwb3B1cF9faW5wdXQtdGV4dC1lcnJvcl9hY3RpdmVcIlxyXG4gIH1cclxuXHJcblxyXG4vKiogcHJvZmlsZSBwb3B1cCBlbGVtZW50cyAqL1xyXG5jb25zdCBwcm9maWxlRm9ybSAgICAgICAgICAgICAgICAgID0gZG9jdW1lbnQuZm9ybXMucHJvZmlsZWZvcm07XHJcbmV4cG9ydCBjb25zdCBpbnB1dE5hbWUgICAgICAgICAgICAgPSBwcm9maWxlRm9ybS5lbGVtZW50cy5wcm9maWxlTmFtZTtcclxuZXhwb3J0IGNvbnN0IGlucHV0QWJvdXRNZSAgICAgICAgICA9IHByb2ZpbGVGb3JtLmVsZW1lbnRzLnByb2ZpbGVBYm91dE1lO1xyXG5leHBvcnQgY29uc3QgcGxhY2VGb3JtICAgICAgICAgICAgID0gZG9jdW1lbnQuZm9ybXMucGxhY2Vmb3JtO1xyXG5cclxuZXhwb3J0IGNvbnN0IGdhbGxlcnlMaXN0U2VsZWN0b3IgID0gXCIuZ2FsbGVyeV9fbGlzdFwiO1xyXG5cclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXSXRoQ29uZmlybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdJdGhDb25maXJtLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCJcclxuLyoqIG1haW4gYnV0dG9ucyAqL1xyXG5jb25zdCBwcm9maWxlRWRpdEJ0biAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBvcGVOZXdDYXJkUG9wdXBCdG4gICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2FkZC1idG5cIik7XHJcblxyXG4vKiogcHJvZmlsZSBkYXRhIGVsZW1lbnRzICovXHJcbmNvbnN0IHByb2ZpbGVOYW1lICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZUFib3V0TWUgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hYm91dC1tZVwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhciAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbi8qKiBnYWxsZXJ5IGNvbnRhaW5lciAqL1xyXG5jb25zdCBjb250YWluZXIgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlcIik7XHJcblxyXG5cclxuY29uc3QgaW5pdENhcmRzID0gbmV3IEFycmF5KCk7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjliNjIxZjBmLTVkZmUtNDNmMS05NWZkLWU5Y2MxODhiY2MzNVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIGluaXRpYWFsIHVzZXIgaW5mbyBhbmQgZ2FsbGVyeSBDYXJkcyBmcm9tXHJcbiAqL1xyXG5hcGkuaW5pdCgpXHJcbi50aGVuKChbdXNlcixjYXJkc10pID0+IHtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyKTtcclxuICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHthdmF0YXI6IHVzZXIuYXZhdGFyLG5hbWU6IHVzZXIubmFtZX0pO1xyXG4gIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtpbml0Q2FyZHMucHVzaChjYXJkKTt9KVxyXG4gIGNhcmRMaXN0LnJlbmRlcmVyKCk7XHJcbn0pXHJcbi5jYXRjaCAoKGVycikgPT4ge1xyXG4gIGhhbmRsZUVycm9yKGVycik7XHJcbn0pXHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIpIHtcclxuICBjb25zdCBlcnJvckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lcnJvclwiKTtcclxuICBlcnJvckVsLnRleHRDb250ZW50ID0gZXJyO1xyXG4gIGVycm9yRWwuc3R5bGUuZGlzcGxheSAgPSBcImJsb2NrXCI7XHJcbn1cclxuY29uc3QgY2FyZExpc3QgID0gbmV3IFNlY3Rpb24oe2RhdGE6IGluaXRDYXJkcywgcmVuZGVyZXI6IGFkZEdhbGxlcnlDYXJkSXRlbX0sIGNvbnN0YW50cy5nYWxsZXJ5TGlzdFNlbGVjdG9yKTtcclxuY29uc3QgdXNlckluZm8gID0gbmV3IFVzZXJJbmZvKFwiLnByb2ZpbGVfX25hbWVcIiwgXCIucHJvZmlsZV9fYWJvdXQtbWVcIiwgXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5cclxuZnVuY3Rpb24gIGFkZEdhbGxlcnlDYXJkSXRlbSAoaXRlbSkge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChpdGVtLCBcclxuICAgIFwiI2dhbGxlcnktaXRlbS10ZW1wbGF0ZVwiLFxyXG4gICAgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZSh7c3JjIDogaXRlbS5saW5rICwgdGl0bGU6IGl0ZW0ubmFtZX0sIFwiLnBvcHVwX3R5cGVfaW1nXCIpO1xyXG4gICAgICBwb3B1cC5vcGVuKCk7XHJcbiAgICB9LFxyXG4gICAgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb3B1cENvbmZpcm0gPSBuZXcgUG9wdXBXSXRoQ29uZmlybShcIi5wb3B1cF90eXBlX2RlbGV0ZVwiLCBoYW5kbGVEZWxldGUpO1xyXG4gICAgICBwb3B1cENvbmZpcm0ub3BlbihpdGVtLl9pZCk7XHJcbiAgICB9LGFwaSk7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG4gIGNhcmRMaXN0LmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xyXG59XHJcbi8qKlxyXG4gKiBhZGQgcG9wdXAgd2l0aCBmb3JtIHRvIGFkZCBuZXcgY2FyZCBpdGVtIHRvIGdhbGxlcnlcclxuICovXHJcbmNvbnN0IG5ld0NhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtIChcclxuICBcIi5wb3B1cF90eXBlX25ldy1jYXJkXCIsXHJcbiAgaGFuZGxlQ3JlYXRlTmV3Q2FyZFxyXG4pO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlKGl0ZW1JZCkge1xyXG4gIGFwaS5kZWxldGVDYXJkKGl0ZW1JZClcclxuICAudGhlbigoKSA9PntcclxuICAgIGxldCBpdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpO1xyXG4gICAgaXRlbS5yZW1vdmUoKTtcclxuICAgIGl0ZW0gPSBudWxsO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICBhbGVydChlcnIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNyZWF0ZU5ld0NhcmQgKGlucHV0cykge1xyXG4gIGFkZEdhbGxlcnlDYXJkSXRlbSh7bGluazogaW5wdXRzLnBsYWNlSW1hZ2VMaW5rLCBuYW1lOiBpbnB1dHMucGxhY2VOYW1lLCBvd25lcjoge19pZDogcHJvZmlsZU5hbWUuaWR9fSk7XHJcbiAgYXBpLmNyZWF0ZU5ld0NhcmQoaW5wdXRzLnBsYWNlSW1hZ2VMaW5rLGlucHV0cy5wbGFjZU5hbWUpXHJcbiAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhKVxyXG4gIH0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBoYW5kbGVFcnJvcihlcnIpO1xyXG4gIH0pXHJcbiAgY29uc3RhbnRzLnBsYWNlRm9ybS5yZXNldCgpO1xyXG4gIG5ld0NhcmRQb3B1cC5jbG9zZSgpO1xyXG4gIG5ld0NhcmRWYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxufVxyXG5cclxub3BlTmV3Q2FyZFBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBuZXdDYXJkUG9wdXAub3BlbigpKTtcclxuXHJcbi8qKlxyXG4gKiBhZGQgcG9wdXAgd2l0aCBmb3JtIHRvIGVkaXQgbWFpbiB1c2VyIGluZm9cclxuICovXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtIChcclxuICBcIi5wb3B1cF90eXBlX3Byb2ZpbGVcIixcclxuICAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXRcclxuKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0IChpbnB1dHMpIHtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyh7bmFtZTogaW5wdXRzLnByb2ZpbGVOYW1lLCBhYm91dDogaW5wdXRzLnByb2ZpbGVBYm91dE1lfSlcclxuICBhcGkuZWRpdFByb2ZpbGUoe25hbWU6IGlucHV0cy5wcm9maWxlTmFtZSwgYWJvdXQ6IGlucHV0cy5wcm9maWxlQWJvdXRNZX0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcblxyXG4gIHByb2ZpbGVWYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxufVxyXG5cclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjb25zdCB7bmFtZSwgYWJvdXQgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgY29uc3RhbnRzLmlucHV0TmFtZS52YWx1ZSAgPSBuYW1lO1xyXG4gIGNvbnN0YW50cy5pbnB1dEFib3V0TWUudmFsdWUgID0gYWJvdXQ7XHJcbiAgcHJvZmlsZVBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG5cclxuLyoqXHJcbiAqIGFkZCBmb3JtIHZhbGlkYXRpb24gZm9yIGFsbCBmb3Jtc1xyXG4gKi9cclxuY29uc3QgbmV3Q2FyZFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbnN0YW50cy5jb25maWcsXCIucG9wdXBfX2Zvcm1fdHlwZV9uZXctY2FyZFwiKTtcclxubmV3Q2FyZFZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5jb25zdCBwcm9maWxlVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLmNvbmZpZyxcIi5wb3B1cF9fZm9ybV90eXBlX3Byb2ZpbGVcIik7XHJcbnByb2ZpbGVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgfVxyXG4gIFxyXG4gICAgX2NhbGwoYWN0aW9uLCBtZXRob2QsIGRhdGEpIHtcclxuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCArIGFjdGlvbiwge1xyXG4gICAgICAgIG1ldGhvZDogbWV0aG9kLFxyXG4gICAgICAgIGhlYWRlcnM6ICB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYocmVzLm9rKSB7XHJcbiAgICAgICAgICByZXR1cm4gIHJlcy5qc29uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRJbml0aWFsQ2FyZHMgPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL2NhcmRzXCIsJ0dFVCcpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2V0VXNlckRhdGEgPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lXCIsJ0dFVCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBlZGl0UHJvZmlsZSh7bmFtZSwgYWJvdXR9KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lXCIsJ1BBVENIJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBhYm91dDogYWJvdXRbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTmV3Q2FyZCAobGluaywgbmFtZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdQT1NUJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBsaW5rOiBsaW5rWzBdXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZExpa2UgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwnUFVUJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdERUxFVEUnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVDYXJkID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VyRGF0YSgpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuICBcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvciggeyBkYXRhLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3RvciApIHtcclxuICAgICAgICB0aGlzLl9pdGVtcyAgICAgICA9IGRhdGEsXHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgICAgPSByZW5kZXJlcjtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmQoZWxlbWVudCk7XHJcbiAgICAgIH1cclxuICAgIFxyXG4gICAgICByZW5kZXJlcigpIHtcclxuICAgICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBVc2VySW5mbyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgcmVuZGVyaW5nIFxyXG4gICAgICogaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgb24gdGhlIHBhZ2UuIFRoaXMgY2xhc3Mgc2hvdWxkOlxyXG4gICAgICogLVRha2UgYW4gb2JqZWN0IHdpdGggdGhlIHNlbGVjdG9ycyBvZiB0d28gZWxlbWVudHMgaW50byB0aGUgY29uc3RydWN0b3I6IFxyXG4gICAgICogb25lIGNvbnRhaW5pbmcgdGhlIHVzZXIncyBuYW1lLCBhbmQgYW5vdGhlciBjb250YWluaW5nIHRoZSB1c2VyJ3Mgam9iLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvciAoIG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2pvYkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGpvYlNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9hdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogcmV0dXJucyBhbiBvYmplY3Qgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXNlci4gXHJcbiAgICAgICAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBoYW5keSBmb3IgXHJcbiAgICAgICAgICogY2FzZXMgd2hlbiBpdCdzIG5lY2Vzc2FyeSB0byBkaXNwbGF5IHRoZSB1c2VyIGRhdGEgaW4gdGhlIG9wZW4gZm9ybS5cclxuICAgICAgICAgKi9cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgICAgICAgICAgYWJvdXQ6IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnRcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VXNlckluZm8oZGF0YSl7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogdGFrZXMgbmV3IHVzZXIgZGF0YSBhbmQgYWRkcyBpdCBvbiB0aGUgcGFnZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCAgID0gZGF0YS5uYW1lO1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50LmlkICAgICAgICAgICAgPSBkYXRhLl9pZDtcclxuICAgICAgICB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ICAgID0gZGF0YS5hYm91dDtcclxuXHJcbiAgICB9XHJcbiAgICBzZXRVc2VyQXZhdGFyKHthdmF0YXIsIG5hbWV9KSB7XHJcbiAgICAgICAgdGhpcy5fYXZhdGFyLnNyYyA9IGF2YXRhcjtcclxuICAgICAgICB0aGlzLl9hdmF0YXIuYWx0ID0gbmFtZTtcclxuICAgIH1cclxufSJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlVHJhc2hDbGljayIsImFwaSIsImxpa2VCdG4iLCJ0aGlzIiwiX2VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZ2FsbGVyeWxpa2VDb3VudCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiX2RlbGV0ZUxpa2UiLCJpZCIsInRleHRDb250ZW50IiwiX2FkZExpa2UiLCJ0b2dnbGUiLCJfdGV4dCIsIm5hbWUiLCJfaW1nIiwibGluayIsIl9pZCIsIl9saWtlcyIsImxpa2VzIiwiX0NhcmRvd25lciIsIm93bmVyIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlVHJhc2hDbGljayIsImFkZExpa2UiLCJkZWxldGVMaWtlIiwiX2RlbGV0ZUNhcmQiLCJkZWxldGVDYXJkIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiZ2FsbGVyeUl0ZW1JbWciLCJnYWxsZXJ5SXRlbU5hbWUiLCJteUlkIiwic3JjIiwiYWx0IiwiX2luaXRMaWtlIiwiX2RlbGV0ZUljb25WaXNpYmlsaXR5IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwidXNlcklkIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiX3VzZXJFeGlzdHMiLCJhZGQiLCJsZW5ndGgiLCJzb21lIiwidXNlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlTGlrZUJ0biIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImV2dCIsImtleSIsImNsb3NlIiwidGFyZ2V0IiwiX3BvcHVwIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJvcGVuIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlQ2xpY2tDbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm1FbGVtZXQiLCJpbnB1dFZhbHVlcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaW5wdXQiLCJ2YWx1ZSIsIl9oYW5kbGVTdWJtaXQiLCJyZXNldCIsIlBvcHVwV2l0aEltYWdlIiwidGl0bGUiLCJfc3JjIiwiX3RpdGxlIiwiX3BvcHVwSW1nIiwiX3BvcHVwVGl0bGUiLCJQb3B1cFdJdGhDb25maXJtIiwiaGFuZGxlQ29uZmlybSIsIl9oYW5kbGVDb25maXJtIiwiRm9ybVZhbGlkYXRvciIsImNvbmZpZyIsImZvcm1FbCIsIl9mb3JtU2VsZWN0b3IiLCJmb3JtU2VsZWN0b3IiLCJfZm9ybUlucHV0c0ZpZWxkU2V0IiwiZm9ybUlucHV0c0ZpZWxkU2V0IiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ0blNlbGVjdG9yIiwic3VibWl0QnRuU2VsZWN0b3IiLCJfaW5hY3RpdmVCdG5DbGFzcyIsImluYWN0aXZlQnRuQ2xhc3MiLCJfaW5wdXRFcnJDbGFzcyIsImlucHV0RXJyQ2xhc3MiLCJfaW5wdXRFcnJBY3RpdmVDbGFzcyIsImlucHV0RXJyQWN0aXZlQ2xhc3MiLCJfZm9ybUVsIiwiX3Nob3dJbnB1dEVyciIsImlucHV0RWwiLCJlcnJFbCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0IiwiaW5wdXRMc3QiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsIkFycmF5IiwiZnJvbSIsImJ0bkVsIiwiZGlzYWJsZWQiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbGVmb3JtIiwiaW5wdXROYW1lIiwiZWxlbWVudHMiLCJwcm9maWxlTmFtZSIsImlucHV0QWJvdXRNZSIsInByb2ZpbGVBYm91dE1lIiwicGxhY2VGb3JtIiwicGxhY2Vmb3JtIiwicHJvZmlsZUVkaXRCdG4iLCJvcGVOZXdDYXJkUG9wdXBCdG4iLCJpbml0Q2FyZHMiLCJvcHRpb25zIiwiX2NhbGwiLCJjYXJkSWQiLCJfb3B0aW9ucyIsImFjdGlvbiIsIm1ldGhvZCIsImZldGNoIiwiYmFzZVVybCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZWRpdFByb2ZpbGUiLCJhYm91dCIsImNyZWF0ZU5ld0NhcmQiLCJpbml0IiwiYWxsIiwiZ2V0VXNlckRhdGEiLCJnZXRJbml0aWFsQ2FyZHMiLCJhdXRob3JpemF0aW9uIiwiaGFuZGxlRXJyb3IiLCJlcnIiLCJlcnJvckVsIiwiZGlzcGxheSIsImNhcmRzIiwidXNlckluZm8iLCJzZXRVc2VySW5mbyIsInNldFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJjYXJkIiwicHVzaCIsImNhcmRMaXN0IiwicmVuZGVyZXIiLCJjYXRjaCIsImNvbnRhaW5lclNlbGVjdG9yIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwiYXBwZW5kIiwiaXRlbSIsImFkZEdhbGxlcnlDYXJkSXRlbSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsImNhcmRFbGVtZW50IiwiaGFuZGxlRGVsZXRlIiwibmV3Q2FyZFBvcHVwIiwicGxhY2VJbWFnZUxpbmsiLCJwbGFjZU5hbWUiLCJjb25zb2xlIiwibG9nIiwiY29uc3RhbnRzIiwibmV3Q2FyZFZhbGlkYXRvciIsIml0ZW1JZCIsImFsZXJ0IiwicHJvZmlsZVBvcHVwIiwicHJvZmlsZVZhbGlkYXRvciJdLCJzb3VyY2VSb290IjoiIn0=