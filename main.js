!function(){"use strict";class e{constructor(e,t,i,s,n,r){this._text=e.name,this._img=e.link,this._id=e._id,this._likes=e.likes,this._Cardowner=e.owner,this._cardSelector=t,this._handleCardClick=i,this._handleTrashClick=s,this._addLike=r.addLike,this._deleteLike=r.deleteLike,this._deleteCard=r.deleteCard,this._handleLike=n,this._element=document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0),this._itemImgEl=this._element.querySelector(".gallery__item-img"),this._itemNameEl=this._element.querySelector(".gallery__item-name"),this.profileEl=document.querySelector(".profile__name"),this._itemTrashBtn=this._element.querySelector(".gallery__item-trash-btn"),this._itemLikeBtn=this._element.querySelector(".gallery__like-btn"),this._gallerylikeCount=this._element.querySelector(".gllery__like-count")}getId(){return this._id}generateCard(){return this._itemImgEl.src=this._img,this._itemNameEl.alt=this._text,this._itemNameEl.textContent=this._text,this._element.id=this._id,this._initLike(this.profileEl.id),this._deleteIconVisibility(this.profileEl.id),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._Cardowner._id&&(this._itemTrashBtn.style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._itemLikeBtn.classList.add("gallery__like-btn_active"),void 0!==this._likes?this._gallerylikeCount.textContent=this._likes.length:this._gallerylikeCount.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._itemLikeBtn.addEventListener("click",(()=>{this._handleLike(this)})),this._itemTrashBtn.addEventListener("click",(()=>{this._handleTrashClick(this)})),this._itemImgEl.addEventListener("click",this._handleCardClick)}updateLikes(){return this._itemLikeBtn.classList.contains("gallery__like-btn_active")?this._deleteLike(this._element.id):this._addLike(this._element.id)}setLikes(e){this._gallerylikeCount.textContent=e.likes.length,this._itemLikeBtn.classList.toggle("gallery__like-btn_active")}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{constructor(e){t(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),t(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class s extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form"),this._inputsArr=this._formElemet.querySelectorAll(".popup__input"),this._inputValues={}}_getInputValues(){return this._inputsArr.forEach((e=>{e.value,this._inputValues[e.name]=e.value})),this._inputValues}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._formElemet.removeEventListener("submit",this._handleSubmit)}renderLoading(e,t){document.querySelector(t).textContent=e?"...Saving":"Save"}close(){super.close(),this._formElemet.reset()}}class n{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=t,this._inputLst=Array.from(this._formEl.querySelectorAll(this._inputSelector)),this._btnEl=this._formEl.querySelector(this._submitBtnSelector)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._inputLst)?(this._btnEl.classList.add(this._inactiveBtnClass),this._btnEl.disabled=!0):(this._btnEl.classList.remove(this._inactiveBtnClass),this._btnEl.disabled=!1)}resetValidation(){this._toggleButtonState(),this._inputLst.forEach((e=>{this._hideInputError(e)}))}_setEventListeners(){this._toggleButtonState(this._inputLst,this._btnEl),this._inputLst.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputLst,this._btnEl)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const r=document.forms.profileform,l=r.elements.profileName,o=r.elements.profileAboutMe;function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}document.forms.placeform;const _=document.querySelector("button.profile__edit-btn"),c=document.querySelector("button.profile__add-btn"),u=document.querySelector(".profile__edit-avatar"),h=document.querySelector(".profile__error"),p=new class extends i{constructor(e,t,i){super(i),this._popupImg=this._popup.querySelector(e),this._popupTitle=this._popup.querySelector(t)}open(e,t){this._src=e,this._title=t,this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title),super.open()}}(".popup__img",".popup__img-title",".popup_type_img"),d=new class extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._cardEl)},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e){super.open(),this._cardEl=e}}(".popup_type_delete",(function(e){g.deleteCard(e._id).then((()=>{e._element.remove(),e._element=null,d.close()})).catch((e=>{console.log(e)}))})),m=new s(".popup_type_avatar",(function(e){m.renderLoading(!0,".popup__submit-btn_place_avatar"),g.editProfileAvatar(e.avatarImageLink).then((()=>{b.setUserAvatar({avatar:e.avatarImageLink}),m.close()})).catch((e=>{C(e)})).finally((()=>{m.renderLoading(!1,".popup__submit-btn_place_avatar")}))})),v=new s(".popup_type_new-card",(function(e){v.renderLoading(!0,".popup__submit-btn_place_new-card"),g.createNewCard(e.placeImageLink,e.placeName).then((e=>{y(e),v.close()})).catch((e=>{C(e)})).finally((()=>{v.renderLoading(!1,".popup__submit-btn_place_new-card")}))})),f=new s(".popup_type_profile",(function(e){f.renderLoading(!0,".popup__submit-btn_place_profile"),g.editProfile({name:e.profileName,about:e.profileAboutMe}).then((()=>{b.setUserInfo({name:e.profileName,about:e.profileAboutMe}),f.close()})).catch((e=>{console.log(e)})).finally((()=>{f.renderLoading(!1,".popup__submit-btn_place_profile")}))})),E=new class{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}rendererItems(e){e.forEach((e=>{this._renderer(e)}))}}(y,".gallery__list"),b=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i)}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){let{name:t,about:i,_id:s}=e;this._nameElement.textContent=t,this._nameElement.id=s,this._jobElement.textContent=i}setUserAvatar(e){let{avatar:t,name:i=null}=e;this._avatar.src=t,i&&(this._avatar.alt=i)}}(".profile__name",".profile__about-me",".profile__avatar"),L={};u.addEventListener("click",(()=>{m.open(L.avatarform.resetValidation())}));const g=new class{constructor(e){a(this,"getInitialCards",(()=>this._call("/cards","GET"))),a(this,"getUserData",(()=>this._call("/users/me","GET"))),a(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),a(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),a(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t,about:i})}createNewCard(e,t){return this._call("/cards","POST",{name:t,link:e})}editProfileAvatar(e){return this._call("/users/me/avatar ","PATCH",{avatar:e})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function y(t){E.addItem(function(t){const i=new e(t,"#gallery-item-template",(()=>{p.open(t.link,t.name)}),(()=>{d.open(i)}),k,g);return i.generateCard()}(t))}function k(e){e.updateLikes().then((t=>{e.setLikes(t)})).catch((e=>{console.log(e)}))}function C(e){h.textContent=e,h.style.display="block"}var S;g.init().then((e=>{let[t,i]=e;b.setUserInfo(t),b.setUserAvatar({avatar:t.avatar,name:t.name}),E.rendererItems(i)})).catch((e=>{C(e)})),c.addEventListener("click",(()=>v.open(L.placeform.resetValidation()))),_.addEventListener("click",(()=>{const{name:e,about:t}=b.getUserInfo();l.value=e,o.value=t,f.open(L.profileform.resetValidation())})),S={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},Array.from(document.querySelectorAll(S.formSelector)).forEach((e=>{const t=new n(S,e),i=e.getAttribute("name");L[i]=t,t.enableValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MkssRUFBU1EsY0FBY0MsTUFFeEIvQixPQUFRQyxJQUNQVSxFQUFZVixNQThDYm5CLEVBQW1CcEYsaUJBQWlCLFNBQVMsSUFBTW1ILEVBQWFyRyxLQUFNZ0ksRUFBYyxVQUFjdkUscUJBaUVuR1ksRUFBZW5GLGlCQUFpQixTQUFTLEtBQ3ZDLE1BQU0sS0FBQy9DLEVBQUQsTUFBT3lLLEdBQVVaLEVBQVMrQixjQUNoQ2hFLEVBQVU5QyxNQUFTOUUsRUFDbkIrSCxFQUFhakQsTUFBUzJGLEVBQ3RCRixFQUFhMUcsS0FBS2dJLEVBQWMsWUFBZ0J2RSxzQkFZeEJqQyxFRC9LWCxDQUNYRyxhQUFjLGVBQ2RFLG1CQUFvQixtQkFDcEJFLGNBQWUsZ0JBQ2ZFLGtCQUFtQixxQkFDbkJFLGlCQUFrQixrQkFDbEJFLGNBQWUsK0JBQ2ZFLG9CQUFxQixrQ0N5S05HLE1BQU1DLEtBQUtyRixTQUFTdUQsaUJBQWlCVyxFQUFPRyxlQUNwRFosU0FBUzRJLElBQ2hCLE1BQU1DLEVBQVksSUFBSXJJLEVBQWNDLEVBQU9tSSxHQUVyQ0UsRUFBV0YsRUFBWUcsYUFBYSxRQUcxQzlCLEVBQWU2QixHQUFZRCxFQUM1QkEsRUFBVWpHLHNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtYXRpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgICBjb25zdHJ1Y3RvciggZGF0YSwgY2FyZFNlbGVjdG9yLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZVRyYXNoQ2xpY2ssIGhhbmRsZUxpa2UsIGFwaSkge1xyXG4gICAgICB0aGlzLl90ZXh0ICAgICAgICAgICAgICA9IGRhdGEubmFtZTtcclxuICAgICAgdGhpcy5faW1nICAgICAgICAgICAgICA9IGRhdGEubGluaztcclxuICAgICAgdGhpcy5faWQgICAgICAgICAgICAgICAgPSBkYXRhLl9pZDtcclxuICAgICAgdGhpcy5fbGlrZXMgICAgICAgICAgICAgPSBkYXRhLmxpa2VzO1xyXG4gICAgICB0aGlzLl9DYXJkb3duZXIgICAgICAgICA9IGRhdGEub3duZXI7XHJcbiAgICAgIHRoaXMuX2NhcmRTZWxlY3RvciAgICAgID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgICA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgICAgdGhpcy5faGFuZGxlVHJhc2hDbGljayAgPSBoYW5kbGVUcmFzaENsaWNrO1xyXG4gICAgICB0aGlzLl9hZGRMaWtlICAgICAgICAgICA9IGFwaS5hZGRMaWtlO1xyXG4gICAgICB0aGlzLl9kZWxldGVMaWtlICAgICAgICA9IGFwaS5kZWxldGVMaWtlO1xyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkICAgICAgICA9IGFwaS5kZWxldGVDYXJkO1xyXG4gICAgICB0aGlzLl9oYW5kbGVMaWtlICAgICAgICA9IGhhbmRsZUxpa2U7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpLmNsb25lTm9kZSh0cnVlKTtcclxuICAgICAgdGhpcy5faXRlbUltZ0VsICAgICAgICAgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1pbWdcIik7XHJcbiAgICAgIHRoaXMuX2l0ZW1OYW1lRWwgICAgICAgID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0tbmFtZVwiKTtcclxuICAgICAgdGhpcy5wcm9maWxlRWwgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbiAgICAgIHRoaXMuX2l0ZW1UcmFzaEJ0biAgICAgID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0tdHJhc2gtYnRuXCIpO1xyXG4gICAgICB0aGlzLl9pdGVtTGlrZUJ0biAgICAgICA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKTtcclxuICAgICAgdGhpcy5fZ2FsbGVyeWxpa2VDb3VudCAgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2xsZXJ5X19saWtlLWNvdW50XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldElkKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5faWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgICB0aGlzLl9pdGVtSW1nRWwuc3JjID0gdGhpcy5faW1nO1xyXG4gICAgICB0aGlzLl9pdGVtTmFtZUVsLmFsdCA9IHRoaXMuX3RleHQ7XHJcbiAgICAgIHRoaXMuX2l0ZW1OYW1lRWwudGV4dENvbnRlbnQgPSB0aGlzLl90ZXh0O1xyXG4gXHJcbiAgICAgIHRoaXMuX2VsZW1lbnQuaWQgPSB0aGlzLl9pZDtcclxuICAgICAgdGhpcy5faW5pdExpa2UodGhpcy5wcm9maWxlRWwuaWQpO1xyXG4gICAgICB0aGlzLiBfZGVsZXRlSWNvblZpc2liaWxpdHkodGhpcy5wcm9maWxlRWwuaWQpO1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIF9kZWxldGVJY29uVmlzaWJpbGl0eSh1c2VySWQpe1xyXG4gICAgICBpZih1c2VySWQgIT0gIHRoaXMuX0NhcmRvd25lci5faWQpIHtcclxuICAgICAgICB0aGlzLl9pdGVtVHJhc2hCdG4uc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaW5pdExpa2UodXNlcklkKXtcclxuICAgICAgaWYodGhpcy5fdXNlckV4aXN0cyh1c2VySWQpKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbUxpa2VCdG4uY2xhc3NMaXN0LmFkZCgnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJyk7IFxyXG4gICAgICB9XHJcbiAgICAgIGlmKHR5cGVvZiB0aGlzLl9saWtlcyAhPT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgdGhpcy5fZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLl9nYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ICA9IDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfdXNlckV4aXN0cyhpZCkge1xyXG4gICAgICBpZih0eXBlb2YgdGhpcy5fbGlrZXMgIT09IFwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgIHJldHVybiB1c2VyLl9pZCA9PT0gaWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgdGhpcy5faXRlbUxpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCkgPT4gIHt0aGlzLl9oYW5kbGVMaWtlKHRoaXMpfSk7XHJcbiAgICAgIHRoaXMuX2l0ZW1UcmFzaEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwoKSA9Pnt0aGlzLl9oYW5kbGVUcmFzaENsaWNrKHRoaXMpfSk7XHJcbiAgICAgIHRoaXMuX2l0ZW1JbWdFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlQ2FyZENsaWNrKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogRGVjaWRlIHdoZXRoZXIgdG8gZGVsZXRlIG9yIGFkZCBhIExpa2UgZGVwZW5kaW5nIG9uIGFuIGV4aXN0aW5nIHNpdHVhdGlvblxyXG4gICAgICovXHJcbiAgICB1cGRhdGVMaWtlcygpIHtcclxuICAgICAgaWYodGhpcy5faXRlbUxpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdnYWxsZXJ5X19saWtlLWJ0bl9hY3RpdmUnKSl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlbGV0ZUxpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZExpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERlYWxpbmcgd2l0aCB0aGUgc3VjY2VzcyBvZiB1cGRhdGluZyBMaWtlIG9uIHRoZSBzZXJ2ZXIgKC50aGVuKVxyXG4gICAgICovXHJcbiAgICBzZXRMaWtlcyhkYXRhKSB7XHJcbiAgICAgIHRoaXMuX2dhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgPSBkYXRhLmxpa2VzLmxlbmd0aDtcclxuICAgICAgdGhpcy5faXRlbUxpa2VCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJyk7XHJcbiAgICB9XHJcbiAgfSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciApIHtcclxuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIC8qKiBwb3B1cHMgY2xvc2UgY2xpY2sgcmVtb3ZlIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBvcGVuIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PntcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpOyAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsICB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVDbGlja0Nsb3NlUG9wdXAgPSAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKSB8fFxyXG4gICAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZVwiKSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCApIHtcclxuICAgICAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldCAgICAgICAgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnB1dHNBcnIgICAgICAgICA9IHRoaXMuX2Zvcm1FbGVtZXQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIik7XHJcbiAgICAgICAgICAgIHRoaXMuX2lucHV0VmFsdWVzICAgICAgID0ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2lucHV0c0Fyci5mb3JFYWNoKGlucHV0ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0TmFtZSA9IGlucHV0LnZhbHVlXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy90aGlzLl9pbnB1dFZhbHVlcy52YWx1ZSA9IGlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRWYWx1ZXMgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogVGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgbWV0aG9kIG9mIHRoZSBQb3B1cFdpdGhGb3JtIGNsYXNzXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICBzdXBlci5yZW1vdmVFdmVudExpc3RlbmVycygpXHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgX2hhbmRsZVN1Ym1pdCA9KGV2dCkgPT57XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOyBcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIGNoYW5nZSBidXR0b24gdGV4dCB0byAuLnNhdmluZyB1bnRpbCBwcm9jZXNzIGVuZHNcclxuICAgICAgICAgKi9cclxuICAgICAgICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgYnRuU2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgY29uc3QgYnRuRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGJ0blNlbGVjdG9yKTtcclxuICAgICAgICAgICAgaWYoaXNMb2FkaW5nKSB7XHJcbiAgICAgICAgICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCIuLi5TYXZpbmdcIjsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCJTYXZlXCI7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICB9XHJcblxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvciggY29uZmlnLCBmb3JtRWwgKXtcclxuICAgICAgdGhpcy5fZm9ybVNlbGVjdG9yICAgICAgICAgPSBjb25maWcuZm9ybVNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9mb3JtSW5wdXRzRmllbGRTZXQgICA9IGNvbmZpZy5mb3JtSW5wdXRzRmllbGRTZXQ7XHJcbiAgICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgICAgICAgID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0blNlbGVjdG9yICAgID0gY29uZmlnLnN1Ym1pdEJ0blNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzICAgICA9IGNvbmZpZy5pbmFjdGl2ZUJ0bkNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckNsYXNzICAgICAgICA9IGNvbmZpZy5pbnB1dEVyckNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzICA9IGNvbmZpZy5pbnB1dEVyckFjdGl2ZUNsYXNzO1xyXG4gICAgICB0aGlzLl9mb3JtRWwgICAgICAgICAgICAgICA9IGZvcm1FbDtcclxuICAgICAgdGhpcy5faW5wdXRMc3QgICAgICAgICAgICAgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgdGhpcy5fYnRuRWwgICAgICAgICAgICAgICAgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgX3Nob3dJbnB1dEVyciAoaW5wdXRFbCkge1xyXG4gICAgICBjb25zdCBlcnJFbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgICBcclxuICAgICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyQ2xhc3MpO1xyXG4gICAgICBlcnJFbC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICAgIGVyckVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yIChpbnB1dEVsKSB7XHJcbiAgICAgIGNvbnN0IGVyckVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcblxyXG4gICAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJDbGFzcyk7XHJcbiAgICAgIGVyckVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyk7XHJcbiAgICAgIGVyckVsLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBfY2hlY2tJbnB1dFZhbGlkaXR5IChpbnB1dEVsKSB7XHJcbiAgICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICAgIHRoaXMuX3Nob3dJbnB1dEVycihpbnB1dEVsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9oYXNJbnZhbGlkSW5wdXQgKGlucHV0THN0KSB7XHJcbiAgICAgIHJldHVybiBpbnB1dExzdC5zb21lKChpbnB1dEVsKSA9PiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlICgpIHtcclxuICAgICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCh0aGlzLl9pbnB1dExzdCkpIHtcclxuICAgICAgICB0aGlzLl9idG5FbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MpO1xyXG4gICAgICAgIHRoaXMuX2J0bkVsLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9idG5FbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MpO1xyXG4gICAgICAgIHRoaXMuX2J0bkVsLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7IFxyXG5cclxuICAgICAgdGhpcy5faW5wdXRMc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSBcclxuICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKHRoaXMuX2lucHV0THN0LCB0aGlzLl9idG5FbCk7XHJcbiAgICAgIHRoaXMuX2lucHV0THN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7ICAgXHJcbiAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSh0aGlzLl9pbnB1dExzdCwgdGhpcy5fYnRuRWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlbmFibGVWYWxpZGF0aW9uICgpIHtcclxuICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgdGhpcy5fZm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4gZXZ0LnByZXZlbnREZWZhdWx0KCkpO1xyXG4gICAgfVxyXG5cclxuICB9IiwiY29uc3QgY29uZmlnID0ge1xyXG4gICAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxyXG4gICAgZm9ybUlucHV0c0ZpZWxkU2V0OiBcIi5wb3B1cF9fZm9ybS1zZXRcIixcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnRuU2VsZWN0b3I6IFwiLnBvcHVwX19zdWJtaXQtYnRuXCIsXHJcbiAgICBpbmFjdGl2ZUJ0bkNsYXNzOiBcImJ1dHRvbl9pbmFjdGl2ZVwiLFxyXG4gICAgaW5wdXRFcnJDbGFzczogXCJwb3B1cF9faW5wdXQtdGV4dF90eXBlX2Vycm9yXCIsXHJcbiAgICBpbnB1dEVyckFjdGl2ZUNsYXNzOiBcInBvcHVwX19pbnB1dC10ZXh0LWVycm9yX2FjdGl2ZVwiXHJcbiAgfVxyXG5cclxuXHJcbi8qKiBwcm9maWxlIHBvcHVwIGVsZW1lbnRzICovXHJcbmNvbnN0IHByb2ZpbGVGb3JtICAgICAgICAgICAgICAgICAgPSBkb2N1bWVudC5mb3Jtcy5wcm9maWxlZm9ybTtcclxuY29uc3QgaW5wdXROYW1lICAgICAgICAgICAgID0gcHJvZmlsZUZvcm0uZWxlbWVudHMucHJvZmlsZU5hbWU7XHJcbmNvbnN0IGlucHV0QWJvdXRNZSAgICAgICAgICA9IHByb2ZpbGVGb3JtLmVsZW1lbnRzLnByb2ZpbGVBYm91dE1lO1xyXG5jb25zdCBwbGFjZUZvcm0gICAgICAgICAgICAgPSBkb2N1bWVudC5mb3Jtcy5wbGFjZWZvcm07XHJcblxyXG5jb25zdCBnYWxsZXJ5TGlzdFNlbGVjdG9yICA9IFwiLmdhbGxlcnlfX2xpc3RcIjtcclxuXHJcbmV4cG9ydCB7Y29uZmlnLCBpbnB1dE5hbWUsIGlucHV0QWJvdXRNZSwgcGxhY2VGb3JtLCBnYWxsZXJ5TGlzdFNlbGVjdG9yfVxyXG5cclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQge2NvbmZpZywgaW5wdXROYW1lLCBpbnB1dEFib3V0TWUsIGdhbGxlcnlMaXN0U2VsZWN0b3J9ICBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XHJcblxyXG4vKiogbWFpbiBidXR0b25zICovXHJcbmNvbnN0IHByb2ZpbGVFZGl0QnRuICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBvcGVOZXdDYXJkUG9wdXBCdG4gID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJFZGl0QnRuICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWF2YXRhclwiKVxyXG5cclxuY29uc3QgZXJyb3JFbCAgICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZXJyb3JcIik7XHJcblxyXG5jb25zdCBwb3B1cENhcmRJdGVtICAgICAgID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLnBvcHVwX19pbWdcIiwgXCIucG9wdXBfX2ltZy10aXRsZVwiLCBcIi5wb3B1cF90eXBlX2ltZ1wiKTtcclxuY29uc3QgcG9wdXBDb25maXJtICAgICAgICA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXCIucG9wdXBfdHlwZV9kZWxldGVcIiwgaGFuZGxlRGVsZXRlKTtcclxuY29uc3QgZWRpdEF2YXRhclBvcHVwICAgICA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfYXZhdGFyXCIsIGhhbmRsZUVkaXRBdmF0YXIpO1xyXG5jb25zdCBuZXdDYXJkUG9wdXAgICAgICAgID0gbmV3IFBvcHVwV2l0aEZvcm0gKFwiLnBvcHVwX3R5cGVfbmV3LWNhcmRcIiwgaGFuZGxlQ3JlYXRlTmV3Q2FyZCk7XHJcbmNvbnN0IHByb2ZpbGVQb3B1cCAgICAgICAgPSBuZXcgUG9wdXBXaXRoRm9ybSAoXCIucG9wdXBfdHlwZV9wcm9maWxlXCIsICBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbmNvbnN0IGNhcmRMaXN0ICAgICAgICAgICAgPSBuZXcgU2VjdGlvbihhZGRHYWxsZXJ5Q2FyZEl0ZW0sIGdhbGxlcnlMaXN0U2VsZWN0b3IpO1xyXG5jb25zdCB1c2VySW5mbyAgICAgICAgICAgID0gbmV3IFVzZXJJbmZvKFwiLnByb2ZpbGVfX25hbWVcIiwgXCIucHJvZmlsZV9fYWJvdXQtbWVcIiwgXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5cclxuY29uc3QgZm9ybVZhbGlkYXRvcnMgPSB7fTtcclxuXHJcbmF2YXRhckVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICAoKSA9PiB7ZWRpdEF2YXRhclBvcHVwLm9wZW4oZm9ybVZhbGlkYXRvcnNbXCJhdmF0YXJmb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpKX0pO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCI5YjYyMWYwZi01ZGZlLTQzZjEtOTVmZC1lOWNjMTg4YmNjMzVcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBpbml0aWFhbCB1c2VyIGluZm8gYW5kIGdhbGxlcnkgQ2FyZHMgZnJvbVxyXG4gKi9cclxuYXBpLmluaXQoKVxyXG4udGhlbigoW3VzZXIsY2FyZHNdKSA9PiB7XHJcbiAgdXNlckluZm8uc2V0VXNlckluZm8odXNlcik7XHJcbiAgdXNlckluZm8uc2V0VXNlckF2YXRhcih7YXZhdGFyOiB1c2VyLmF2YXRhcixuYW1lOiB1c2VyLm5hbWV9KTtcclxuICBjYXJkTGlzdC5yZW5kZXJlckl0ZW1zKGNhcmRzKTtcclxufSlcclxuLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgaGFuZGxlRXJyb3IoZXJyKTtcclxufSlcclxuXHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBoYW5kbGUgZWRpdCBwb2ZpbGUgYXZhdGFyIGltYWdlXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVFZGl0QXZhdGFyIChpbnB1dHMpIHtcclxuICBlZGl0QXZhdGFyUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9hdmF0YXJcIik7XHJcbiAgYXBpLmVkaXRQcm9maWxlQXZhdGFyKGlucHV0cy5hdmF0YXJJbWFnZUxpbmspXHJcbiAgLnRoZW4gKCgpID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoe2F2YXRhcjogaW5wdXRzLmF2YXRhckltYWdlTGlua30pXHJcbiAgICBlZGl0QXZhdGFyUG9wdXAuY2xvc2UoKTtcclxuICB9KVxyXG4gIC5jYXRjaCAoKGVycikgPT4ge1xyXG4gICAgaGFuZGxlRXJyb3IoZXJyKTtcclxuICB9KVxyXG4gIC5maW5hbGx5KCgpID0+e1xyXG4gICAgZWRpdEF2YXRhclBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX2F2YXRhclwiKTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogZWRpdCB1c2VyIHByb2ZpbGUgZGF0YVxyXG4gKi9cclxuIGZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0IChpbnB1dHMpIHtcclxuICBwcm9maWxlUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG5cclxuICBhcGkuZWRpdFByb2ZpbGUoe25hbWU6IGlucHV0cy5wcm9maWxlTmFtZSwgYWJvdXQ6IGlucHV0cy5wcm9maWxlQWJvdXRNZX0pXHJcbiAgLnRoZW4gKCgpID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtuYW1lOiBpbnB1dHMucHJvZmlsZU5hbWUsIGFib3V0OiBpbnB1dHMucHJvZmlsZUFib3V0TWV9KVxyXG4gICAgcHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHByb2ZpbGVQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgbmV3IGNhcmQgaXRlbSB0byBnYWxsZXJ5XHJcbiAqL1xyXG4gb3BlTmV3Q2FyZFBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBuZXdDYXJkUG9wdXAub3BlbiggZm9ybVZhbGlkYXRvcnNbXCJwbGFjZWZvcm1cIl0ucmVzZXRWYWxpZGF0aW9uKCkpKTtcclxuXHJcbiBmdW5jdGlvbiBjcmVhdGVDYXJkIChpdGVtKSB7XHJcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxyXG4gICAgaXRlbSwgXHJcbiAgICBcIiNnYWxsZXJ5LWl0ZW0tdGVtcGxhdGVcIixcclxuICAgICgpID0+IHsgcG9wdXBDYXJkSXRlbS5vcGVuKGl0ZW0ubGluaywgaXRlbS5uYW1lKTsgfSxcclxuICAgICgpID0+IHsgcG9wdXBDb25maXJtLm9wZW4oY2FyZCk7IH0sXHJcbiAgICBoYW5kbGVMaWtlLFxyXG4gICAgYXBpKTtcclxuICAgIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiAgYWRkR2FsbGVyeUNhcmRJdGVtIChpdGVtKSB7XHJcbiAgY2FyZExpc3QuYWRkSXRlbShjcmVhdGVDYXJkKGl0ZW0pKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ3JlYXRlTmV3Q2FyZCAoaW5wdXRzKSB7XHJcbiAgbmV3Q2FyZFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfbmV3LWNhcmRcIik7XHJcblxyXG4gIGFwaS5jcmVhdGVOZXdDYXJkKGlucHV0cy5wbGFjZUltYWdlTGluayxpbnB1dHMucGxhY2VOYW1lKVxyXG4gIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgYWRkR2FsbGVyeUNhcmRJdGVtIChkYXRhKVxyXG4gICAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGhhbmRsZUVycm9yKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIG5ld0NhcmRQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9uZXctY2FyZFwiKTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogZGVsZXRlIGNhcmQgaXRlbSBmcm9tIGdhbGxlcnlcclxuICovXHJcbiBmdW5jdGlvbiBoYW5kbGVEZWxldGUoY2FyZCkge1xyXG4gIGFwaS5kZWxldGVDYXJkKGNhcmQuX2lkKVxyXG4gIC50aGVuKCgpID0+e1xyXG4gICAgY2FyZC5fZWxlbWVudC5yZW1vdmUoKTtcclxuICAgIGNhcmQuX2VsZW1lbnQgPSBudWxsO1xyXG4gICAgcG9wdXBDb25maXJtLmNsb3NlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2goZXJyID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIGhhbmRsZSBjYXJkIGxpa2VzIHVwZGF0ZVxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlTGlrZShjYXJkKSB7XHJcbiAgY2FyZC51cGRhdGVMaWtlcygpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBjYXJkLnNldExpa2VzKGRhdGEpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KSAgICAgXHJcbiAgIFxyXG59XHJcblxyXG4vKipcclxuICogYWRkIGV2ZW50IGxpc3RlbmVyIHRvIGVkaXQgdXNlciBwcm9maWxlIGluZm9cclxuICovXHJcbnByb2ZpbGVFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3Qge25hbWUsIGFib3V0IH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIGlucHV0TmFtZS52YWx1ZSAgPSBuYW1lO1xyXG4gIGlucHV0QWJvdXRNZS52YWx1ZSAgPSBhYm91dDtcclxuICBwcm9maWxlUG9wdXAub3Blbihmb3JtVmFsaWRhdG9yc1tcInByb2ZpbGVmb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpKTtcclxufSk7XHJcblxyXG4vKipcclxuICogc2V0IEVycm9yIGRlc2NyaXB0aW9uIG9uIHRvcCBvZiB0aGUgcGFnZVxyXG4gKi9cclxuIGZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycikge1xyXG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBlcnI7XHJcbiAgZXJyb3JFbC5zdHlsZS5kaXNwbGF5ICA9IFwiYmxvY2tcIjtcclxufVxyXG5cclxuXHJcbmNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpXHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZyxmb3JtRWxlbWVudClcclxuICAgIC8vZ2V0IHRoZSBuYW1lIG9mIHRoZSBmb3JtXHJcbiAgICBjb25zdCBmb3JtTmFtZSA9IGZvcm1FbGVtZW50LmdldEF0dHJpYnV0ZSgnbmFtZScpXHJcblxyXG4gICAvL3N0b3JlIGEgdmFsaWRhdG9yIGJ5IHRoZSBgbmFtZWAgb2YgdGhlIGZvcm1cclxuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1OYW1lXSA9IHZhbGlkYXRvcjtcclxuICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oY29uZmlnKTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cHtcclxuICAgIGNvbnN0cnVjdG9yICggaW1nU2VsZWN0b3IsIHRpdGxlU2VsZWN0b3IgLHBvcHVwU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKGltZ1NlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3Rvcih0aXRsZVNlbGVjdG9yKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgb3BlbihzcmMsIHRpdGxlICkge1xyXG4gICAgICAgIHRoaXMuX3NyYyAgID0gc3JjO1xyXG4gICAgICAgIHRoaXMuX3RpdGxlID0gdGl0bGU7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcuc3JjID0gIHRoaXMuX3NyYztcclxuICAgICAgICB0aGlzLl9wb3B1cEltZy5hbHQgPSAgdGhpcy5fdGl0bGU7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZS50ZXh0Q29udGVudCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciwgaGFuZGxlQ29uZmlybSApIHtcclxuICAgICAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNvbmZpcm0gICAgID0gICBoYW5kbGVDb25maXJtO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0ICAgICAgICA9ICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBzZXRFdmVudExpc3RlbmVycygpIHBhcmVudCBtZXRob2QuIFxyXG4gICAgICAgICAgICAgKiAgaGFzIHRvIGFkZCB0aGUgc3VibWl0IGV2ZW50IGhhbmRsZXIgdG8gdGhlIGZvcm0gYW5kIHRoZSBjbGljayBcclxuICAgICAgICAgICAgICogZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGNsb3NlIGljb24uXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIHN1cGVyLnJlbW92ZUV2ZW50TGlzdGVuZXJzKClcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZW1vdmVFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBfaGFuZGxlU3VibWl0ID0oZXZ0KSA9PntcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDb25maXJtKHRoaXMuX2NhcmRFbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvcGVuKGNhcmRFbCkge1xyXG4gICAgICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhcmRFbCA9IGNhcmRFbDtcclxuICAgICAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKCByZW5kZXJlciAsIGNvbnRhaW5lclNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyICAgID0gcmVuZGVyZXI7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHJlbmRlcmVySXRlbXMoY2FyZHMpIHtcclxuICAgICAgICBjYXJkcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBVc2VySW5mbyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgcmVuZGVyaW5nIFxyXG4gICAgICogaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgb24gdGhlIHBhZ2UuIFRoaXMgY2xhc3Mgc2hvdWxkOlxyXG4gICAgICogLVRha2UgYW4gb2JqZWN0IHdpdGggdGhlIHNlbGVjdG9ycyBvZiB0d28gZWxlbWVudHMgaW50byB0aGUgY29uc3RydWN0b3I6IFxyXG4gICAgICogb25lIGNvbnRhaW5pbmcgdGhlIHVzZXIncyBuYW1lLCBhbmQgYW5vdGhlciBjb250YWluaW5nIHRoZSB1c2VyJ3Mgam9iLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvciAoIG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50ICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudCAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhciAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyLiBcclxuICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIGhhbmR5IGZvciBcclxuICAgICAgICAgKiBjYXNlcyB3aGVuIGl0J3MgbmVjZXNzYXJ5IHRvIGRpc3BsYXkgdGhlIHVzZXIgZGF0YSBpbiB0aGUgb3BlbiBmb3JtLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICAgICAgICBhYm91dDogdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyh7IG5hbWUsIGFib3V0LCBfaWQgfSl7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogdGFrZXMgbmV3IHVzZXIgZGF0YSBhbmQgYWRkcyBpdCBvbiB0aGUgcGFnZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCAgID0gbmFtZTtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC5pZCAgICAgICAgICAgID0gX2lkO1xyXG4gICAgICAgIHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQgICAgPSBhYm91dDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VyQXZhdGFyKHthdmF0YXIsIG5hbWUgPSBudWxsfSkge1xyXG4gICAgICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgICAgICAgaWYobmFtZSl7XHJcbiAgICAgICAgICAgIHRoaXMuX2F2YXRhci5hbHQgPSBuYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XHJcbiAgICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xyXG5cclxuICAgIH1cclxuICBcclxuICAgIF9jYWxsKGFjdGlvbiwgbWV0aG9kLCBkYXRhKSB7XHJcbiAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwgKyBhY3Rpb24sIHtcclxuICAgICAgICBtZXRob2Q6IG1ldGhvZCxcclxuICAgICAgICBoZWFkZXJzOiAgdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGlmKHJlcy5vaykge1xyXG4gICAgICAgICAgcmV0dXJuICByZXMuanNvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1cyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdHRVQnKTtcclxuICAgIH1cclxuICBcclxuICAgIGdldFVzZXJEYXRhID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi91c2Vycy9tZVwiLCdHRVQnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZWRpdFByb2ZpbGUoe25hbWUsIGFib3V0fSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi91c2Vycy9tZVwiLCdQQVRDSCcse1xyXG4gICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgYWJvdXQ6IGFib3V0XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZU5ld0NhcmQgKGxpbmssIG5hbWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvY2FyZHNcIiwnUE9TVCcse1xyXG4gICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgbGluazogbGlua1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgYWRkTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdQVVQnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVMaWtlID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvJHtjYXJkSWR9YCwnREVMRVRFJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZWRpdFByb2ZpbGVBdmF0YXIodXJsKXtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWUvYXZhdGFyIFwiLCdQQVRDSCcse1xyXG4gICAgICAgIGF2YXRhciA6IHVybFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckRhdGEoKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgXHJcbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlVHJhc2hDbGljayIsImhhbmRsZUxpa2UiLCJhcGkiLCJ0aGlzIiwiX3RleHQiLCJuYW1lIiwiX2ltZyIsImxpbmsiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9DYXJkb3duZXIiLCJvd25lciIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZVRyYXNoQ2xpY2siLCJfYWRkTGlrZSIsImFkZExpa2UiLCJfZGVsZXRlTGlrZSIsImRlbGV0ZUxpa2UiLCJfZGVsZXRlQ2FyZCIsImRlbGV0ZUNhcmQiLCJfaGFuZGxlTGlrZSIsIl9lbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9pdGVtSW1nRWwiLCJfaXRlbU5hbWVFbCIsInByb2ZpbGVFbCIsIl9pdGVtVHJhc2hCdG4iLCJfaXRlbUxpa2VCdG4iLCJfZ2FsbGVyeWxpa2VDb3VudCIsImdldElkIiwiZ2VuZXJhdGVDYXJkIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJpZCIsIl9pbml0TGlrZSIsIl9kZWxldGVJY29uVmlzaWJpbGl0eSIsIl9zZXRFdmVudExpc3RlbmVycyIsInVzZXJJZCIsInN0eWxlIiwidmlzaWJpbGl0eSIsIl91c2VyRXhpc3RzIiwiY2xhc3NMaXN0IiwiYWRkIiwibGVuZ3RoIiwic29tZSIsInVzZXIiLCJhZGRFdmVudExpc3RlbmVyIiwidXBkYXRlTGlrZXMiLCJjb250YWlucyIsInNldExpa2VzIiwidG9nZ2xlIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiZXZ0Iiwia2V5IiwiY2xvc2UiLCJ0YXJnZXQiLCJfcG9wdXAiLCJyZW1vdmUiLCJyZW1vdmVFdmVudExpc3RlbmVycyIsIm9wZW4iLCJzZXRFdmVudExpc3RlbmVycyIsIl9oYW5kbGVFc2NDbG9zZSIsIl9oYW5kbGVDbGlja0Nsb3NlUG9wdXAiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsInByZXZlbnREZWZhdWx0IiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfZm9ybUVsZW1ldCIsIl9pbnB1dHNBcnIiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2lucHV0VmFsdWVzIiwiZm9yRWFjaCIsImlucHV0IiwidmFsdWUiLCJfaGFuZGxlU3VibWl0IiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ0blNlbGVjdG9yIiwicmVzZXQiLCJGb3JtVmFsaWRhdG9yIiwiY29uZmlnIiwiZm9ybUVsIiwiX2Zvcm1TZWxlY3RvciIsImZvcm1TZWxlY3RvciIsIl9mb3JtSW5wdXRzRmllbGRTZXQiLCJmb3JtSW5wdXRzRmllbGRTZXQiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnRuU2VsZWN0b3IiLCJzdWJtaXRCdG5TZWxlY3RvciIsIl9pbmFjdGl2ZUJ0bkNsYXNzIiwiaW5hY3RpdmVCdG5DbGFzcyIsIl9pbnB1dEVyckNsYXNzIiwiaW5wdXRFcnJDbGFzcyIsIl9pbnB1dEVyckFjdGl2ZUNsYXNzIiwiaW5wdXRFcnJBY3RpdmVDbGFzcyIsIl9mb3JtRWwiLCJfaW5wdXRMc3QiLCJBcnJheSIsImZyb20iLCJfYnRuRWwiLCJfc2hvd0lucHV0RXJyIiwiaW5wdXRFbCIsImVyckVsIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJpbnB1dExzdCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImRpc2FibGVkIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXRFbGVtZW50IiwiZW5hYmxlVmFsaWRhdGlvbiIsInByb2ZpbGVGb3JtIiwiZm9ybXMiLCJwcm9maWxlZm9ybSIsImlucHV0TmFtZSIsImVsZW1lbnRzIiwicHJvZmlsZU5hbWUiLCJpbnB1dEFib3V0TWUiLCJwcm9maWxlQWJvdXRNZSIsInBsYWNlZm9ybSIsInByb2ZpbGVFZGl0QnRuIiwib3BlTmV3Q2FyZFBvcHVwQnRuIiwiYXZhdGFyRWRpdEJ0biIsImVycm9yRWwiLCJwb3B1cENhcmRJdGVtIiwiaW1nU2VsZWN0b3IiLCJ0aXRsZVNlbGVjdG9yIiwiX3BvcHVwSW1nIiwiX3BvcHVwVGl0bGUiLCJ0aXRsZSIsIl9zcmMiLCJfdGl0bGUiLCJwb3B1cENvbmZpcm0iLCJoYW5kbGVDb25maXJtIiwiX2hhbmRsZUNvbmZpcm0iLCJfY2FyZEVsIiwiY2FyZEVsIiwiY2FyZCIsInRoZW4iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJlZGl0QXZhdGFyUG9wdXAiLCJpbnB1dHMiLCJlZGl0UHJvZmlsZUF2YXRhciIsImF2YXRhckltYWdlTGluayIsInVzZXJJbmZvIiwic2V0VXNlckF2YXRhciIsImF2YXRhciIsImhhbmRsZUVycm9yIiwiZmluYWxseSIsIm5ld0NhcmRQb3B1cCIsImNyZWF0ZU5ld0NhcmQiLCJwbGFjZUltYWdlTGluayIsInBsYWNlTmFtZSIsImFkZEdhbGxlcnlDYXJkSXRlbSIsInByb2ZpbGVQb3B1cCIsImVkaXRQcm9maWxlIiwiYWJvdXQiLCJzZXRVc2VySW5mbyIsImNhcmRMaXN0IiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJyZW5kZXJlckl0ZW1zIiwiY2FyZHMiLCJpdGVtIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJhdmF0YXJTZWxlY3RvciIsIl9uYW1lRWxlbWVudCIsIl9qb2JFbGVtZW50IiwiX2F2YXRhciIsImdldFVzZXJJbmZvIiwiZm9ybVZhbGlkYXRvcnMiLCJvcHRpb25zIiwiX2NhbGwiLCJjYXJkSWQiLCJfb3B0aW9ucyIsImFjdGlvbiIsIm1ldGhvZCIsImZldGNoIiwiYmFzZVVybCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJ1cmwiLCJpbml0IiwiYWxsIiwiZ2V0VXNlckRhdGEiLCJnZXRJbml0aWFsQ2FyZHMiLCJhdXRob3JpemF0aW9uIiwiY3JlYXRlQ2FyZCIsImRpc3BsYXkiLCJmb3JtRWxlbWVudCIsInZhbGlkYXRvciIsImZvcm1OYW1lIiwiZ2V0QXR0cmlidXRlIl0sInNvdXJjZVJvb3QiOiIifQ==