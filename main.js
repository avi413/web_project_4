!function(){"use strict";function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t{constructor(t,i,s,r,n){e(this,"_handleLikeBtn",(()=>{const e=this._element.querySelector(".gallery__like-btn"),t=this._element.querySelector(".gllery__like-count");e.classList.contains("gallery__like-btn_active")?(this._deleteLike(this._element.id),t.textContent--):(this._addLike(this._element.id),t.textContent++),this._element.querySelector(".gallery__like-btn").classList.toggle("gallery__like-btn_active")})),e(this,"_handleDeleteGalleryCardItem",(()=>{})),e(this,"_handleDelete",(()=>{this._deleteCard(this._element.id).then((()=>{this._element.remove(),this._element=null})).catch((e=>{alert(e)}))})),this._text=t.name,this._img=t.link,this._id=t._id,this._likes=t.likes,this._CardownerId=t.owner._id,this._cardSelector=i,this._handleCardClick=s,this._handleTrashClick=r,this._addLike=n.addLike,this._deleteLike=n.deleteLike,this._deleteCard=n.deleteCard}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".gallery__item-img"),t=this._element.querySelector(".gallery__item-name"),i=document.querySelector(".profile__name").id;return e.src=this._img,e.alt=this._text,t.textContent=this._text,this._element.id=this._id,this._initLike(i),this._deleteIconVisibility(i),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._CardownerId&&(this._element.querySelector(".gallery__item-trash-btn").style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._element.querySelector(".gallery__like-btn").classList.add("gallery__like-btn_active");const t=this._element.querySelector(".gllery__like-count");void 0!==this._likes?t.textContent=this._likes.length:t.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._element.querySelector(".gallery__like-btn").addEventListener("click",this._handleLikeBtn),this._element.querySelector(".gallery__item-trash-btn").addEventListener("click",this._handleTrashClick),this._element.querySelector(".gallery__item-img").addEventListener("click",this._handleCardClick)}}function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class s{constructor(e){i(this,"_handleEscClose",(e=>{"Escape"===e.key&&document.querySelector(".popup_opened")&&this.close()})),i(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class r extends s{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".")}_getInputValues(){const e={};return this._formElemet.querySelectorAll(".popup__input").forEach((t=>{e[t.name]=[t.value]})),e}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class n extends s{constructor(e,t){let{src:i,title:s}=e;super(t),this._src=i,this._title=s}open(){super.open(),this._popupImg=this._popup.querySelector(".popup__img"),this._popupTitle=this._popup.querySelector(".popup__img-title"),this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title)}}class l extends s{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._popup.id),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e){super.open(),this._popup.id=e}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class o{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=document.querySelector(t)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this._hasInvalidInput(e)?(t.classList.add(this._inactiveBtnClass),t.disabled=!0):(t.classList.remove(this._inactiveBtnClass),t.disabled=!1)}_setEventListeners(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this.toggleButtonState(e,t),e.forEach((i=>{i.addEventListener("input",(()=>{this._checkInputValidity(i),this.toggleButtonState(e,t)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const a={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},c=document.forms.profileform,_=c.elements.profileName,u=c.elements.profileAboutMe,h=document.forms.placeform;function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const d=document.querySelector("button.profile__edit-btn"),m=document.querySelector("button.profile__add-btn"),f=(document.querySelector(".profile__name"),document.querySelector(".profile__about-me"),document.querySelector(".profile__avatar"),document.querySelector(".gallery"),new Array),v=new class{constructor(e){p(this,"getInitialCards",(()=>this._call("/cards","GET"))),p(this,"getUserData",(()=>this._call("/users/me","GET"))),p(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),p(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),p(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t[0],about:i[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function y(e){const t=document.querySelector(".profile__error");t.textContent=e,t.style.display="block"}v.init().then((e=>{let[t,i]=e;b.setUserInfo(t),b.setUserAvatar({avatar:t.avatar,name:t.name}),i.forEach((e=>{f.push(e)})),E.renderer()})).catch((e=>{y(e)}));const E=new class{constructor(e,t){let{data:i,renderer:s}=e;this._items=i,this._renderer=s,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}renderer(){this._items.forEach((e=>{this._renderer(e)}))}}({data:f,renderer:S},".gallery__list"),b=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i)}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._nameElement.id=e._id,this._jobElement.textContent=e.about}setUserAvatar(e){let{avatar:t,name:i}=e;this._avatar.src=t,this._avatar.alt=i}}(".profile__name",".profile__about-me",".profile__avatar");function S(e){const i=new t(e,"#gallery-item-template",(()=>{new n({src:e.link,title:e.name},".popup_type_img").open()}),(()=>{new l(".popup_type_delete",C).open(e._id)}),v).generateCard();E.addItem(i)}const g=new r(".popup_type_new-card",(function(e){S({link:e.placeImageLink,name:e.placeName}),v.createNewCard(e.placeImageLink,e.placeName).then((e=>{console.log(e)})).catch((e=>{y(e)})),h.reset(),g.close(),k.toggleButtonState()}));function C(){const e=document.querySelector(".popup_type_delete").id;v.deleteCard(e).then((()=>{this._element.remove(),this._element=null})).catch((e=>{alert(e)}))}m.addEventListener("click",(()=>g.open()));const L=new r(".popup_type_profile",(function(e){b.setUserInfo({name:e.profileName,about:e.profileAboutMe}),v.editProfile({name:e.profileName,about:e.profileAboutMe}).catch((e=>{console.log(e)})),q.toggleButtonState()}));d.addEventListener("click",(()=>{const{name:e,about:t}=b.getUserInfo();_.value=e,u.value=t,L.open()}));const k=new o(a,".popup__form_type_new-card");k.enableValidation();const q=new o(a,".popup__form_type_profile");q.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFBLE1BQWdDMUMsRUFDaEM2QyxFQUFhNUksVUFPZixNQUFNMEksRUFBbUIsSUFBSTdHLEVBQWM0RyxFQUFpQiw4QkFDNURDLEVBQWlCNUUsbUJBRWpCLE1BQU0rRSxFQUFtQixJQUFJaEgsRUFBYzRHLEVBQWlCLDZCQUM1REksRUFBaUIvRSxtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV0l0aENvbmZpcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKCBkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlVHJhc2hDbGljaywgYXBpKSB7XHJcbiAgICAgIHRoaXMuX3RleHQgICAgICAgICAgICAgID0gZGF0YS5uYW1lO1xyXG4gICAgICB0aGlzLl9pbWcgICAgICAgICAgICAgID0gZGF0YS5saW5rO1xyXG4gICAgICB0aGlzLl9pZCAgICAgICAgICAgICAgICA9IGRhdGEuX2lkO1xyXG4gICAgICB0aGlzLl9saWtlcyAgICAgICAgICAgICA9IGRhdGEubGlrZXM7XHJcbiAgICAgIHRoaXMuX0NhcmRvd25lcklkICAgICAgID0gZGF0YS5vd25lci5faWQ7XHJcbiAgICAgIHRoaXMuX2NhcmRTZWxlY3RvciAgICAgID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgICA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgICAgdGhpcy5faGFuZGxlVHJhc2hDbGljayAgPSBoYW5kbGVUcmFzaENsaWNrO1xyXG4gICAgICB0aGlzLl9hZGRMaWtlICAgICAgICAgICA9IGFwaS5hZGRMaWtlO1xyXG4gICAgICB0aGlzLl9kZWxldGVMaWtlICAgICAgICA9IGFwaS5kZWxldGVMaWtlO1xyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkICAgICAgICA9IGFwaS5kZWxldGVDYXJkO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxyXG4gICAgICAgIC5jb250ZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbVwiKVxyXG4gICAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgXHJcbiAgICAgIHJldHVybiBjYXJkRWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlJdGVtSW1nID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0taW1nXCIpO1xyXG4gICAgICBjb25zdCBnYWxsZXJ5SXRlbU5hbWUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1uYW1lXCIpO1xyXG4gICAgICBjb25zdCBteUlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpLmlkO1xyXG5cclxuICAgICAgZ2FsbGVyeUl0ZW1JbWcuc3JjID0gdGhpcy5faW1nO1xyXG4gICAgICBnYWxsZXJ5SXRlbUltZy5hbHQgPSB0aGlzLl90ZXh0O1xyXG4gICAgICBnYWxsZXJ5SXRlbU5hbWUudGV4dENvbnRlbnQgPSB0aGlzLl90ZXh0O1xyXG4gXHJcbiAgICAgIHRoaXMuX2VsZW1lbnQuaWQgPSB0aGlzLl9pZDtcclxuICAgICAgdGhpcy5faW5pdExpa2UobXlJZCk7XHJcbiAgICAgIHRoaXMuIF9kZWxldGVJY29uVmlzaWJpbGl0eShteUlkKVxyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIF9kZWxldGVJY29uVmlzaWJpbGl0eSh1c2VySWQpe1xyXG4gICAgICBpZih1c2VySWQgIT0gdGhpcy5fQ2FyZG93bmVySWQpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS10cmFzaC1idG5cIikuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaW5pdExpa2UodXNlcklkKXtcclxuICAgICAgaWYodGhpcy5fdXNlckV4aXN0cyh1c2VySWQpKSB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmNsYXNzTGlzdC5hZGQoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpOyBcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBnYWxsZXJ5bGlrZUNvdW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdsbGVyeV9fbGlrZS1jb3VudFwiKTtcclxuICAgICAgaWYodHlwZW9mIHRoaXMuX2xpa2VzICE9PSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgID0gMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF91c2VyRXhpc3RzKGlkKSB7XHJcbiAgICAgIGlmKHR5cGVvZiB0aGlzLl9saWtlcyAhPT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpa2VzLnNvbWUoZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgcmV0dXJuIHVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG5cclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgdGhpcy5faGFuZGxlTGlrZUJ0bik7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLXRyYXNoLWJ0blwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIix0aGlzLl9oYW5kbGVUcmFzaENsaWNrKTtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0taW1nXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDYXJkQ2xpY2spO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2hhbmRsZUxpa2VCdG4gPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxpa2VCdG4gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIik7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlsaWtlQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2xsZXJ5X19saWtlLWNvdW50XCIpO1xyXG4gICAgICBpZihsaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucygnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJykpe1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZUxpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCAtLTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLl9hZGRMaWtlKHRoaXMuX2VsZW1lbnQuaWQpO1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgKys7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmNsYXNzTGlzdC50b2dnbGUoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpO1xyXG5cclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgfVxyXG4gIFxyXG4gICAgX2hhbmRsZURlbGV0ZUdhbGxlcnlDYXJkSXRlbSA9ICgpID0+IHtcclxuICAgICBcclxuICAgICAvKlxyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkKHRoaXMuX2VsZW1lbnQuaWQpXHJcbiAgICAgIC50aGVuKCgpID0+e1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGFsZXJ0KGVycik7XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAqL1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVEZWxldGUgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUNhcmQodGhpcy5fZWxlbWVudC5pZClcclxuICAgICAgLnRoZW4oKCkgPT57XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgYWxlcnQoZXJyKTtcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIH1cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBjbG9zZSBjbGljayByZW1vdmUgZXZlbnRzICovXHJcbiAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICAvKiogcG9wdXBzIG9wZW4gZXZlbnRzICovXHJcbiAgICAgICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+e1xyXG4gICAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgICAgIGlmKHBvcHVwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0gICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlQ2xpY2tDbG9zZVBvcHVwKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCA9IChldnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfb3BlbmVkXCIpIHx8XHJcbiAgICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX2Nsb3NlXCIpICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuXHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSAgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0ICkge1xyXG4gICAgICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCAgPSAgIGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQgICAgICAgID0gICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRzQXJyID0gdGhpcy5fZm9ybUVsZW1ldC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcclxuICAgICAgICAgICAgaW5wdXRzQXJyLmZvckVhY2goaW5wdXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBbaW5wdXQudmFsdWVdO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogVGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgbWV0aG9kIG9mIHRoZSBQb3B1cFdpdGhGb3JtIGNsYXNzXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIF9oYW5kbGVTdWJtaXQgPShldnQpID0+e1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9ICB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KGlucHV0cyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgY2xvc2UoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgY2xvc2UoKSBwYXJlbnQgbWV0aG9kIFxyXG4gICAgICAgICAgICAgKiBpbiBvcmRlciB0byByZXNldCB0aGUgZm9ybSBvbmNlIHRoZSBwb3B1cCBpcyBjbG9zZWQuXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcblxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwe1xyXG4gICAgY29uc3RydWN0b3IgKCB7c3JjICx0aXRsZSB9ICxwb3B1cFNlbGVjdG9yICkge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX3NyYyAgID0gc3JjO1xyXG4gICAgICAgIHRoaXMuX3RpdGxlID0gdGl0bGU7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWdcIik7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltZy10aXRsZVwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcuc3JjID0gIHRoaXMuX3NyYztcclxuICAgICAgICB0aGlzLl9wb3B1cEltZy5hbHQgPSAgdGhpcy5fdGl0bGU7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZS50ZXh0Q29udGVudCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV0l0aENvbmZpcm0gIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciwgaGFuZGxlQ29uZmlybSApIHtcclxuICAgICAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNvbmZpcm0gICAgID0gICBoYW5kbGVDb25maXJtO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0ICAgICAgICA9ICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBzZXRFdmVudExpc3RlbmVycygpIHBhcmVudCBtZXRob2QuIFxyXG4gICAgICAgICAgICAgKiAgaGFzIHRvIGFkZCB0aGUgc3VibWl0IGV2ZW50IGhhbmRsZXIgdG8gdGhlIGZvcm0gYW5kIHRoZSBjbGljayBcclxuICAgICAgICAgICAgICogZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGNsb3NlIGljb24uXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgX2hhbmRsZVN1Ym1pdCA9KGV2dCkgPT57XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOyBcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlQ29uZmlybSh0aGlzLl9wb3B1cC5pZCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9wZW4oaWQpIHtcclxuICAgICAgICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cC5pZCA9aWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKCBjb25maWcsIGZvcm1FbCApe1xyXG4gICAgICB0aGlzLl9mb3JtU2VsZWN0b3IgICAgICAgICA9IGNvbmZpZy5mb3JtU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2Zvcm1JbnB1dHNGaWVsZFNldCAgID0gY29uZmlnLmZvcm1JbnB1dHNGaWVsZFNldDtcclxuICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciAgICAgICAgPSBjb25maWcuaW5wdXRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuU2VsZWN0b3IgICAgPSBjb25maWcuc3VibWl0QnRuU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MgICAgID0gY29uZmlnLmluYWN0aXZlQnRuQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyQ2xhc3MgICAgICAgID0gY29uZmlnLmlucHV0RXJyQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MgID0gY29uZmlnLmlucHV0RXJyQWN0aXZlQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbCAgICAgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtRWwpO1xyXG4gICAgfVxyXG5cclxuICAgIF9zaG93SW5wdXRFcnIgKGlucHV0RWwpIHtcclxuICAgICAgY29uc3QgZXJyRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgICAgXHJcbiAgICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVyckNsYXNzKTtcclxuICAgICAgZXJyRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgICBlcnJFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oaWRlSW5wdXRFcnJvciAoaW5wdXRFbCkge1xyXG4gICAgICBjb25zdCBlcnJFbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG5cclxuICAgICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyQ2xhc3MpO1xyXG4gICAgICBlcnJFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MpO1xyXG4gICAgICBlcnJFbC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrSW5wdXRWYWxpZGl0eSAoaW5wdXRFbCkge1xyXG4gICAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnIoaW5wdXRFbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaGFzSW52YWxpZElucHV0IChpbnB1dExzdCkge1xyXG4gICAgICByZXR1cm4gaW5wdXRMc3Quc29tZSgoaW5wdXRFbCkgPT4gIWlucHV0RWwudmFsaWRpdHkudmFsaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlICgpIHtcclxuICAgICAgY29uc3QgaW5wdXRMc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgY29uc3QgYnRuRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoaW5wdXRMc3QpKSB7XHJcbiAgICAgICAgYnRuRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzKTtcclxuICAgICAgICBidG5FbC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnRuRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzKTtcclxuICAgICAgICBidG5FbC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzICgpIHtcclxuICAgICAgY29uc3QgaW5wdXRMc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgY29uc3QgYnRuRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMc3QsIGJ0bkVsKTtcclxuICAgICAgaW5wdXRMc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHsgICBcclxuICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKTtcclxuICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMc3QsIGJ0bkVsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IGV2dC5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgIH1cclxuXHJcbiAgfSIsImV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXHJcbiAgICBmb3JtSW5wdXRzRmllbGRTZXQ6IFwiLnBvcHVwX19mb3JtLXNldFwiLFxyXG4gICAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2lucHV0XCIsXHJcbiAgICBzdWJtaXRCdG5TZWxlY3RvcjogXCIucG9wdXBfX3N1Ym1pdC1idG5cIixcclxuICAgIGluYWN0aXZlQnRuQ2xhc3M6IFwiYnV0dG9uX2luYWN0aXZlXCIsXHJcbiAgICBpbnB1dEVyckNsYXNzOiBcInBvcHVwX19pbnB1dC10ZXh0X3R5cGVfZXJyb3JcIixcclxuICAgIGlucHV0RXJyQWN0aXZlQ2xhc3M6IFwicG9wdXBfX2lucHV0LXRleHQtZXJyb3JfYWN0aXZlXCJcclxuICB9XHJcblxyXG5cclxuLyoqIHByb2ZpbGUgcG9wdXAgZWxlbWVudHMgKi9cclxuY29uc3QgcHJvZmlsZUZvcm0gICAgICAgICAgICAgICAgICA9IGRvY3VtZW50LmZvcm1zLnByb2ZpbGVmb3JtO1xyXG5leHBvcnQgY29uc3QgaW5wdXROYW1lICAgICAgICAgICAgID0gcHJvZmlsZUZvcm0uZWxlbWVudHMucHJvZmlsZU5hbWU7XHJcbmV4cG9ydCBjb25zdCBpbnB1dEFib3V0TWUgICAgICAgICAgPSBwcm9maWxlRm9ybS5lbGVtZW50cy5wcm9maWxlQWJvdXRNZTtcclxuZXhwb3J0IGNvbnN0IHBsYWNlRm9ybSAgICAgICAgICAgICA9IGRvY3VtZW50LmZvcm1zLnBsYWNlZm9ybTtcclxuXHJcbmV4cG9ydCBjb25zdCBnYWxsZXJ5TGlzdFNlbGVjdG9yICA9IFwiLmdhbGxlcnlfX2xpc3RcIjtcclxuXHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tICBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFBvcHVwV0l0aENvbmZpcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXSXRoQ29uZmlybS5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgKiBhcyBjb25zdGFudHMgZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiXHJcbi8qKiBtYWluIGJ1dHRvbnMgKi9cclxuY29uc3QgcHJvZmlsZUVkaXRCdG4gICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5wcm9maWxlX19lZGl0LWJ0blwiKTtcclxuY29uc3Qgb3BlTmV3Q2FyZFBvcHVwQnRuICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG5cclxuLyoqIHByb2ZpbGUgZGF0YSBlbGVtZW50cyAqL1xyXG5jb25zdCBwcm9maWxlTmFtZSAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVBYm91dE1lICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWJvdXQtbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVBdmF0YXIgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG4vKiogZ2FsbGVyeSBjb250YWluZXIgKi9cclxuY29uc3QgY29udGFpbmVyICAgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5XCIpO1xyXG5cclxuY29uc3QgaW5pdENhcmRzID0gbmV3IEFycmF5KCk7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjliNjIxZjBmLTVkZmUtNDNmMS05NWZkLWU5Y2MxODhiY2MzNVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIGluaXRpYWFsIHVzZXIgaW5mbyBhbmQgZ2FsbGVyeSBDYXJkcyBmcm9tXHJcbiAqL1xyXG5hcGkuaW5pdCgpXHJcbi50aGVuKChbdXNlcixjYXJkc10pID0+IHtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyKTtcclxuICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHthdmF0YXI6IHVzZXIuYXZhdGFyLG5hbWU6IHVzZXIubmFtZX0pO1xyXG4gIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtpbml0Q2FyZHMucHVzaChjYXJkKTt9KVxyXG4gIGNhcmRMaXN0LnJlbmRlcmVyKCk7XHJcbn0pXHJcbi5jYXRjaCAoKGVycikgPT4ge1xyXG4gIGhhbmRsZUVycm9yKGVycik7XHJcbn0pXHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIpIHtcclxuICBjb25zdCBlcnJvckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lcnJvclwiKTtcclxuICBlcnJvckVsLnRleHRDb250ZW50ID0gZXJyO1xyXG4gIGVycm9yRWwuc3R5bGUuZGlzcGxheSAgPSBcImJsb2NrXCI7XHJcbn1cclxuY29uc3QgY2FyZExpc3QgID0gbmV3IFNlY3Rpb24oe2RhdGE6IGluaXRDYXJkcywgcmVuZGVyZXI6IGFkZEdhbGxlcnlDYXJkSXRlbX0sIGNvbnN0YW50cy5nYWxsZXJ5TGlzdFNlbGVjdG9yKTtcclxuY29uc3QgdXNlckluZm8gID0gbmV3IFVzZXJJbmZvKFwiLnByb2ZpbGVfX25hbWVcIiwgXCIucHJvZmlsZV9fYWJvdXQtbWVcIiwgXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5cclxuZnVuY3Rpb24gIGFkZEdhbGxlcnlDYXJkSXRlbSAoaXRlbSkge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChpdGVtLCBcclxuICAgIFwiI2dhbGxlcnktaXRlbS10ZW1wbGF0ZVwiLFxyXG4gICAgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZSh7c3JjIDogaXRlbS5saW5rICwgdGl0bGU6IGl0ZW0ubmFtZX0sIFwiLnBvcHVwX3R5cGVfaW1nXCIpO1xyXG4gICAgICBwb3B1cC5vcGVuKCk7XHJcbiAgICB9LFxyXG4gICAgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb3B1cENvbmZpcm0gPSBuZXcgUG9wdXBXSXRoQ29uZmlybShcIi5wb3B1cF90eXBlX2RlbGV0ZVwiLGhhbmRsZURlbGV0ZSk7XHJcbiAgICAgIHBvcHVwQ29uZmlybS5vcGVuKGl0ZW0uX2lkKTtcclxuICAgIH0sYXBpKTtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgY2FyZExpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbn1cclxuLyoqXHJcbiAqIGFkZCBwb3B1cCB3aXRoIGZvcm0gdG8gYWRkIG5ldyBjYXJkIGl0ZW0gdG8gZ2FsbGVyeVxyXG4gKi9cclxuY29uc3QgbmV3Q2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0gKFxyXG4gIFwiLnBvcHVwX3R5cGVfbmV3LWNhcmRcIixcclxuICBoYW5kbGVDcmVhdGVOZXdDYXJkXHJcbik7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGUoKSB7XHJcbiAgY29uc3QgaXRlbUlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX2RlbGV0ZVwiKS5pZDtcclxuICBhcGkuZGVsZXRlQ2FyZChpdGVtSWQpXHJcbiAgLnRoZW4oKCkgPT57XHJcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgfSlcclxuICAuY2F0Y2goZXJyID0+IHtcclxuICAgIGFsZXJ0KGVycik7XHJcbiAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ3JlYXRlTmV3Q2FyZCAoaW5wdXRzKSB7XHJcbiAgYWRkR2FsbGVyeUNhcmRJdGVtKHtsaW5rOiBpbnB1dHMucGxhY2VJbWFnZUxpbmssIG5hbWU6IGlucHV0cy5wbGFjZU5hbWV9KTtcclxuICBhcGkuY3JlYXRlTmV3Q2FyZChpbnB1dHMucGxhY2VJbWFnZUxpbmssaW5wdXRzLnBsYWNlTmFtZSlcclxuICAudGhlbihkYXRhID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGRhdGEpXHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGhhbmRsZUVycm9yKGVycik7XHJcbiAgfSlcclxuICBjb25zdGFudHMucGxhY2VGb3JtLnJlc2V0KCk7XHJcbiAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgbmV3Q2FyZFZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG59XHJcblxyXG5vcGVOZXdDYXJkUG9wdXBCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG5ld0NhcmRQb3B1cC5vcGVuKCkpO1xyXG5cclxuLyoqXHJcbiAqIGFkZCBwb3B1cCB3aXRoIGZvcm0gdG8gZWRpdCBtYWluIHVzZXIgaW5mb1xyXG4gKi9cclxuY29uc3QgcHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0gKFxyXG4gIFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLFxyXG4gICBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdFxyXG4pO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQgKGlucHV0cykge1xyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtuYW1lOiBpbnB1dHMucHJvZmlsZU5hbWUsIGFib3V0OiBpbnB1dHMucHJvZmlsZUFib3V0TWV9KVxyXG4gIGFwaS5lZGl0UHJvZmlsZSh7bmFtZTogaW5wdXRzLnByb2ZpbGVOYW1lLCBhYm91dDogaW5wdXRzLnByb2ZpbGVBYm91dE1lfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxuXHJcbiAgcHJvZmlsZVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG59XHJcblxyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IHtuYW1lLCBhYm91dCB9ID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBjb25zdGFudHMuaW5wdXROYW1lLnZhbHVlICA9IG5hbWU7XHJcbiAgY29uc3RhbnRzLmlucHV0QWJvdXRNZS52YWx1ZSAgPSBhYm91dDtcclxuICBwcm9maWxlUG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcblxyXG4vKipcclxuICogYWRkIGZvcm0gdmFsaWRhdGlvbiBmb3IgYWxsIGZvcm1zXHJcbiAqL1xyXG5jb25zdCBuZXdDYXJkVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLmNvbmZpZyxcIi5wb3B1cF9fZm9ybV90eXBlX25ldy1jYXJkXCIpO1xyXG5uZXdDYXJkVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25zdGFudHMuY29uZmlnLFwiLnBvcHVwX19mb3JtX3R5cGVfcHJvZmlsZVwiKTtcclxucHJvZmlsZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcclxuXHJcbiAgICB9XHJcbiAgXHJcbiAgICBfY2FsbChhY3Rpb24sIG1ldGhvZCwgZGF0YSkge1xyXG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsICsgYWN0aW9uLCB7XHJcbiAgICAgICAgbWV0aG9kOiBtZXRob2QsXHJcbiAgICAgICAgaGVhZGVyczogIHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBpZihyZXMub2spIHtcclxuICAgICAgICAgIHJldHVybiAgcmVzLmpzb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXMpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGdldEluaXRpYWxDYXJkcyA9ICgpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvY2FyZHNcIiwnR0VUJyk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBnZXRVc2VyRGF0YSA9ICgpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWVcIiwnR0VUJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGVkaXRQcm9maWxlKHtuYW1lLCBhYm91dH0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWVcIiwnUEFUQ0gnLHtcclxuICAgICAgICBuYW1lOiBuYW1lWzBdLFxyXG4gICAgICAgIGFib3V0OiBhYm91dFswXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVOZXdDYXJkIChsaW5rLCBuYW1lKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL2NhcmRzXCIsJ1BPU1QnLHtcclxuICAgICAgICBuYW1lOiBuYW1lWzBdLFxyXG4gICAgICAgIGxpbms6IGxpbmtbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdQVVQnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVMaWtlID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvJHtjYXJkSWR9YCwnREVMRVRFJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJEYXRhKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIFxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKCB7IGRhdGEsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zICAgICAgID0gZGF0YSxcclxuICAgICAgICB0aGlzLl9yZW5kZXJlciAgICA9IHJlbmRlcmVyO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLmFwcGVuZChlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHJlbmRlcmVyKCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIFVzZXJJbmZvIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciByZW5kZXJpbmcgXHJcbiAgICAgKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXNlciBvbiB0aGUgcGFnZS4gVGhpcyBjbGFzcyBzaG91bGQ6XHJcbiAgICAgKiAtVGFrZSBhbiBvYmplY3Qgd2l0aCB0aGUgc2VsZWN0b3JzIG9mIHR3byBlbGVtZW50cyBpbnRvIHRoZSBjb25zdHJ1Y3RvcjogXHJcbiAgICAgKiBvbmUgY29udGFpbmluZyB0aGUgdXNlcidzIG5hbWUsIGFuZCBhbm90aGVyIGNvbnRhaW5pbmcgdGhlIHVzZXIncyBqb2IuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yICggbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyLiBcclxuICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIGhhbmR5IGZvciBcclxuICAgICAgICAgKiBjYXNlcyB3aGVuIGl0J3MgbmVjZXNzYXJ5IHRvIGRpc3BsYXkgdGhlIHVzZXIgZGF0YSBpbiB0aGUgb3BlbiBmb3JtLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICAgICAgICBhYm91dDogdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyhkYXRhKXtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiB0YWtlcyBuZXcgdXNlciBkYXRhIGFuZCBhZGRzIGl0IG9uIHRoZSBwYWdlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ICAgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQuaWQgICAgICAgICAgICA9IGRhdGEuX2lkO1xyXG4gICAgICAgIHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQgICAgPSBkYXRhLmFib3V0O1xyXG5cclxuICAgIH1cclxuICAgIHNldFVzZXJBdmF0YXIoe2F2YXRhciwgbmFtZX0pIHtcclxuICAgICAgICB0aGlzLl9hdmF0YXIuc3JjID0gYXZhdGFyO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhci5hbHQgPSBuYW1lO1xyXG4gICAgfVxyXG59Il0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVUcmFzaENsaWNrIiwiYXBpIiwibGlrZUJ0biIsInRoaXMiLCJfZWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJnYWxsZXJ5bGlrZUNvdW50IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJfZGVsZXRlTGlrZSIsImlkIiwidGV4dENvbnRlbnQiLCJfYWRkTGlrZSIsInRvZ2dsZSIsIl9kZWxldGVDYXJkIiwidGhlbiIsInJlbW92ZSIsImNhdGNoIiwiZXJyIiwiYWxlcnQiLCJfdGV4dCIsIm5hbWUiLCJfaW1nIiwibGluayIsIl9pZCIsIl9saWtlcyIsImxpa2VzIiwiX0NhcmRvd25lcklkIiwib3duZXIiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVUcmFzaENsaWNrIiwiYWRkTGlrZSIsImRlbGV0ZUxpa2UiLCJkZWxldGVDYXJkIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiZ2FsbGVyeUl0ZW1JbWciLCJnYWxsZXJ5SXRlbU5hbWUiLCJteUlkIiwic3JjIiwiYWx0IiwiX2luaXRMaWtlIiwiX2RlbGV0ZUljb25WaXNpYmlsaXR5IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwidXNlcklkIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiX3VzZXJFeGlzdHMiLCJhZGQiLCJsZW5ndGgiLCJzb21lIiwidXNlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlTGlrZUJ0biIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImV2dCIsImtleSIsImNsb3NlIiwidGFyZ2V0IiwiX3BvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJvcGVuIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlQ2xpY2tDbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm1FbGVtZXQiLCJpbnB1dFZhbHVlcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaW5wdXQiLCJ2YWx1ZSIsIl9oYW5kbGVTdWJtaXQiLCJyZXNldCIsIlBvcHVwV2l0aEltYWdlIiwidGl0bGUiLCJfc3JjIiwiX3RpdGxlIiwiX3BvcHVwSW1nIiwiX3BvcHVwVGl0bGUiLCJQb3B1cFdJdGhDb25maXJtIiwiaGFuZGxlQ29uZmlybSIsIl9oYW5kbGVDb25maXJtIiwiRm9ybVZhbGlkYXRvciIsImNvbmZpZyIsImZvcm1FbCIsIl9mb3JtU2VsZWN0b3IiLCJmb3JtU2VsZWN0b3IiLCJfZm9ybUlucHV0c0ZpZWxkU2V0IiwiZm9ybUlucHV0c0ZpZWxkU2V0IiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ0blNlbGVjdG9yIiwic3VibWl0QnRuU2VsZWN0b3IiLCJfaW5hY3RpdmVCdG5DbGFzcyIsImluYWN0aXZlQnRuQ2xhc3MiLCJfaW5wdXRFcnJDbGFzcyIsImlucHV0RXJyQ2xhc3MiLCJfaW5wdXRFcnJBY3RpdmVDbGFzcyIsImlucHV0RXJyQWN0aXZlQ2xhc3MiLCJfZm9ybUVsIiwiX3Nob3dJbnB1dEVyciIsImlucHV0RWwiLCJlcnJFbCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0IiwiaW5wdXRMc3QiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsIkFycmF5IiwiZnJvbSIsImJ0bkVsIiwiZGlzYWJsZWQiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbGVmb3JtIiwiaW5wdXROYW1lIiwiZWxlbWVudHMiLCJwcm9maWxlTmFtZSIsImlucHV0QWJvdXRNZSIsInByb2ZpbGVBYm91dE1lIiwicGxhY2VGb3JtIiwicGxhY2Vmb3JtIiwicHJvZmlsZUVkaXRCdG4iLCJvcGVOZXdDYXJkUG9wdXBCdG4iLCJpbml0Q2FyZHMiLCJvcHRpb25zIiwiX2NhbGwiLCJjYXJkSWQiLCJfb3B0aW9ucyIsImFjdGlvbiIsIm1ldGhvZCIsImZldGNoIiwiYmFzZVVybCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJlZGl0UHJvZmlsZSIsImFib3V0IiwiY3JlYXRlTmV3Q2FyZCIsImluaXQiLCJhbGwiLCJnZXRVc2VyRGF0YSIsImdldEluaXRpYWxDYXJkcyIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVFcnJvciIsImVycm9yRWwiLCJkaXNwbGF5IiwiY2FyZHMiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwic2V0VXNlckF2YXRhciIsImF2YXRhciIsImNhcmQiLCJwdXNoIiwiY2FyZExpc3QiLCJyZW5kZXJlciIsImNvbnRhaW5lclNlbGVjdG9yIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwiYXBwZW5kIiwiaXRlbSIsImFkZEdhbGxlcnlDYXJkSXRlbSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsImNhcmRFbGVtZW50IiwiaGFuZGxlRGVsZXRlIiwibmV3Q2FyZFBvcHVwIiwicGxhY2VJbWFnZUxpbmsiLCJwbGFjZU5hbWUiLCJjb25zb2xlIiwibG9nIiwiY29uc3RhbnRzIiwibmV3Q2FyZFZhbGlkYXRvciIsIml0ZW1JZCIsInByb2ZpbGVQb3B1cCIsInByb2ZpbGVWYWxpZGF0b3IiXSwic291cmNlUm9vdCI6IiJ9