!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s,i,r){e(this,"_handleLikeBtn",(()=>{const e=this._element.querySelector(".gallery__like-btn"),t=this._element.querySelector(".gllery__like-count");e.classList.contains("gallery__like-btn_active")?(this._deleteLike(this._element.id),t.textContent--):(this._addLike(this._element.id),t.textContent++),this._element.querySelector(".gallery__like-btn").classList.toggle("gallery__like-btn_active")})),e(this,"_handleDeleteGalleryCardItem",(()=>{this._element.remove(),this._element=null})),this._text=t.name,this._img=t.link,this._id=t._id,this._likes=t.likes,this._cardSelector=s,this._handleCardClick=i,this._addLike=r.addLike,this._deleteLike=r.deleteLike}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".gallery__item-img"),t=this._element.querySelector(".gallery__item-name"),s=document.querySelector(".profile__name").id;return e.src=this._img,e.alt=this._text,t.textContent=this._text,this._element.id=this._id,this._initLike(s),this._setEventListeners(),this._element}_initLike(e){this._userExists(e)&&this._element.querySelector(".gallery__like-btn").classList.add("gallery__like-btn_active"),this._element.querySelector(".gllery__like-count").textContent=this._likes.length}_userExists(e){return this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._element.querySelector(".gallery__like-btn").addEventListener("click",this._handleLikeBtn),this._element.querySelector(".gallery__item-trash-btn").addEventListener("click",this._handleDeleteGalleryCardItem),this._element.querySelector(".gallery__item-img").addEventListener("click",this._handleCardClick)}}function s(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e){s(this,"_handleEscClose",(e=>{"Escape"===e.key&&document.querySelector(".popup_opened")&&this.close()})),s(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class r extends i{constructor(e,t){var s,i;super(e),i=e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this.close()},(s="_handleSubmit")in this?Object.defineProperty(this,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[s]=i,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return this._formElemet.querySelectorAll(".popup__input").forEach((t=>{e[t.name]=[t.value]})),e}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class n extends i{constructor(e,t){let{src:s,title:i}=e;super(t),this._src=s,this._title=i}open(){super.open(),this._popupImg=this._popup.querySelector(".popup__img"),this._popupTitle=this._popup.querySelector(".popup__img-title"),this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title)}}class l{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=document.querySelector(t)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this._hasInvalidInput(e)?(t.classList.add(this._inactiveBtnClass),t.disabled=!0):(t.classList.remove(this._inactiveBtnClass),t.disabled=!1)}_setEventListeners(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this.toggleButtonState(e,t),e.forEach((s=>{s.addEventListener("input",(()=>{this._checkInputValidity(s),this.toggleButtonState(e,t)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const o={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},a=document.forms.profileform,c=a.elements.profileName,_=a.elements.profileAboutMe,u=document.forms.placeform;function p(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const h=document.querySelector("button.profile__edit-btn"),m=document.querySelector("button.profile__add-btn"),d=(document.querySelector(".profile__name"),document.querySelector(".profile__about-me"),document.querySelector(".profile__avatar"),document.querySelector(".gallery"),new Array),f=new class{constructor(e){p(this,"getInitialCards",(()=>this._call("/cards","GET"))),p(this,"getUserData",(()=>this._call("/users/me","GET"))),p(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),p(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),this._options=e}_call(e,t,s){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(s)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,job:s}=e;return this._call("/users/me","PATCH",{name:t[0],about:s[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function v(e){const t=document.querySelector(".profile__error");t.textContent=e,t.style.display="block"}f.init().then((e=>{let[t,s]=e;E.setUserInfo(t),E.setUserAvatar({avatar:t.avatar,name:t.name}),s.forEach((e=>{d.push(e)})),y.renderer()})).catch((e=>{v(e)}));const y=new class{constructor(e,t){let{data:s,renderer:i}=e;this._items=s,this._renderer=i,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}renderer(){this._items.forEach((e=>{this._renderer(e)}))}}({data:d,renderer:b},".gallery__list"),E=new class{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._nameElement.id=e._id,this._jobElement.textContent=e.about}setUserAvatar(e){let{avatar:t,name:s}=e;this._avatar.src=t,this._avatar.alt=s}}(".profile__name",".profile__about-me",".profile__avatar");function b(e){const s=new t(e,"#gallery-item-template",(()=>{new n({src:e.link,title:e.name},".popup_type_img").open()}),f).generateCard();y.addItem(s)}const S=new r(".popup_type_new-card",(function(e){b({link:e.placeImageLink,name:e.placeName}),f.createNewCard(e.placeImageLink,e.placeName).then((e=>{console.log(e)})).catch((e=>{v(e)})),u.reset(),S.close(),L.toggleButtonState()}));m.addEventListener("click",(()=>S.open()));const g=new r(".popup_type_profile",(function(e){E.setUserInfo({name:e.profileName,job:e.profileAboutMe}),f.editProfile({name:e.profileName,job:e.profileAboutMe}).catch((e=>{console.log(e)})),k.toggleButtonState()}));h.addEventListener("click",(()=>{const{name:e,job:t}=E.getUserInfo();c.value=e,_.value=t,g.open()}));const L=new l(o,".popup__form_type_new-card");L.enableValidation();const k=new l(o,".popup__form_type_profile");k.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgICBjb25zdHJ1Y3RvciggZGF0YSwgY2FyZFNlbGVjdG9yLCBoYW5kbGVDYXJkQ2xpY2ssIGFwaSkge1xyXG4gICAgICB0aGlzLl90ZXh0ICAgICAgICAgICAgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHRoaXMuX2ltZyAgICAgICAgICAgICA9IGRhdGEubGluaztcclxuICAgICAgdGhpcy5faWQgICAgICAgICAgICAgID0gZGF0YS5faWQ7XHJcbiAgICAgIHRoaXMuX2xpa2VzICAgICAgICAgICA9IGRhdGEubGlrZXM7XHJcbiAgICAgIHRoaXMuX2NhcmRTZWxlY3RvciAgICA9IGNhcmRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgICB0aGlzLl9hZGRMaWtlICAgICAgICAgPSBhcGkuYWRkTGlrZTtcclxuICAgICAgdGhpcy5fZGVsZXRlTGlrZSAgICAgID0gYXBpLmRlbGV0ZUxpa2U7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcclxuICAgICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgICAgLmNvbnRlbnRcclxuICAgICAgICAucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpXHJcbiAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICBcclxuICAgICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgY29uc3QgZ2FsbGVyeUl0ZW1JbWcgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1pbWdcIik7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlJdGVtTmFtZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLW5hbWVcIik7XHJcbiAgICAgIGNvbnN0IG15SWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIikuaWQ7XHJcblxyXG4gICAgICBnYWxsZXJ5SXRlbUltZy5zcmMgPSB0aGlzLl9pbWc7XHJcbiAgICAgIGdhbGxlcnlJdGVtSW1nLmFsdCA9IHRoaXMuX3RleHQ7XHJcbiAgICAgIGdhbGxlcnlJdGVtTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX3RleHQ7XHJcbiBcclxuICAgICAgdGhpcy5fZWxlbWVudC5pZCA9IHRoaXMuX2lkO1xyXG4gICAgICB0aGlzLl9pbml0TGlrZShteUlkKTtcclxuXHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2luaXRMaWtlKHVzZXJJZCl7XHJcbiAgICAgIGlmKHRoaXMuX3VzZXJFeGlzdHModXNlcklkKSkge1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKS5jbGFzc0xpc3QuYWRkKCdnYWxsZXJ5X19saWtlLWJ0bl9hY3RpdmUnKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBnYWxsZXJ5bGlrZUNvdW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdsbGVyeV9fbGlrZS1jb3VudFwiKTtcclxuICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBfdXNlckV4aXN0cyhpZCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZShmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHVzZXIuX2lkID09PSBpZDtcclxuICAgICAgfSk7IFxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgdGhpcy5faGFuZGxlTGlrZUJ0bik7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLXRyYXNoLWJ0blwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIix0aGlzLl9oYW5kbGVEZWxldGVHYWxsZXJ5Q2FyZEl0ZW0pO1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1pbWdcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNhcmRDbGljayk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGFuZGxlTGlrZUJ0biA9ICgpID0+IHtcclxuICAgICAgY29uc3QgbGlrZUJ0biA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKTtcclxuICAgICAgY29uc3QgZ2FsbGVyeWxpa2VDb3VudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nbGxlcnlfX2xpa2UtY291bnRcIik7XHJcbiAgICAgIGlmKGxpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdnYWxsZXJ5X19saWtlLWJ0bl9hY3RpdmUnKSl7XHJcbiAgICAgICAgdGhpcy5fZGVsZXRlTGlrZSh0aGlzLl9lbGVtZW50LmlkKTtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50IC0tO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2FkZExpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCArKztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIikuY2xhc3NMaXN0LnRvZ2dsZSgnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJyk7XHJcblxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGFuZGxlRGVsZXRlR2FsbGVyeUNhcmRJdGVtID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcclxuICAgICAgXHJcbiAgICB9XHJcbiAgfSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciApIHtcclxuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIC8qKiBwb3B1cHMgY2xvc2UgY2xpY2sgcmVtb3ZlIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBvcGVuIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PntcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgICAgICBpZihwb3B1cCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsICB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVDbGlja0Nsb3NlUG9wdXAgPSAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKSB8fFxyXG4gICAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZVwiKSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtICBleHRlbmRzIFBvcHVwIHtcclxuICAgICAgICBjb25zdHJ1Y3RvciAoIHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgKSB7XHJcbiAgICAgICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ICA9ICAgaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldCAgICAgICAgPSAgIHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0c0FyciA9IHRoaXMuX2Zvcm1FbGVtZXQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIik7XHJcbiAgICAgICAgICAgIGlucHV0c0Fyci5mb3JFYWNoKGlucHV0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gW2lucHV0LnZhbHVlXTtcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dFZhbHVlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSXQgbW9kaWZpZXMgdGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgcGFyZW50IG1ldGhvZC4gXHJcbiAgICAgICAgICAgICAqIFRoZSBzZXRFdmVudExpc3RlbmVycygpIG1ldGhvZCBvZiB0aGUgUG9wdXBXaXRoRm9ybSBjbGFzc1xyXG4gICAgICAgICAgICAgKiAgaGFzIHRvIGFkZCB0aGUgc3VibWl0IGV2ZW50IGhhbmRsZXIgdG8gdGhlIGZvcm0gYW5kIHRoZSBjbGljayBcclxuICAgICAgICAgICAgICogZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGNsb3NlIGljb24uXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZW1vdmVFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBfaGFuZGxlU3VibWl0ID0oZXZ0KSA9PntcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgICAgICBjb25zdCBpbnB1dHMgPSAgdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdChpbnB1dHMpO1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIGNsb3NlKCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSXQgbW9kaWZpZXMgdGhlIGNsb3NlKCkgcGFyZW50IG1ldGhvZCBcclxuICAgICAgICAgICAgICogaW4gb3JkZXIgdG8gcmVzZXQgdGhlIGZvcm0gb25jZSB0aGUgcG9wdXAgaXMgY2xvc2VkLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZXNldCgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cHtcclxuICAgIGNvbnN0cnVjdG9yICgge3NyYyAsdGl0bGUgfSAscG9wdXBTZWxlY3RvciApIHtcclxuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9zcmMgICA9IHNyYztcclxuICAgICAgICB0aGlzLl90aXRsZSA9IHRpdGxlO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKSB7XHJcbiAgICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwSW1nID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1nXCIpO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwVGl0bGUgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWctdGl0bGVcIik7XHJcblxyXG4gICAgICAgIHRoaXMuX3BvcHVwSW1nLnNyYyA9ICB0aGlzLl9zcmM7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcuYWx0ID0gIHRoaXMuX3RpdGxlO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwVGl0bGUudGV4dENvbnRlbnQgPSBgUGhvdG8gb2YgJHt0aGlzLl90aXRsZX1gO1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvciggY29uZmlnLCBmb3JtRWwgKXtcclxuICAgICAgdGhpcy5fZm9ybVNlbGVjdG9yICAgICAgICAgPSBjb25maWcuZm9ybVNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9mb3JtSW5wdXRzRmllbGRTZXQgICA9IGNvbmZpZy5mb3JtSW5wdXRzRmllbGRTZXQ7XHJcbiAgICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgICAgICAgID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0blNlbGVjdG9yICAgID0gY29uZmlnLnN1Ym1pdEJ0blNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzICAgICA9IGNvbmZpZy5pbmFjdGl2ZUJ0bkNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckNsYXNzICAgICAgICA9IGNvbmZpZy5pbnB1dEVyckNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzICA9IGNvbmZpZy5pbnB1dEVyckFjdGl2ZUNsYXNzO1xyXG4gICAgICB0aGlzLl9mb3JtRWwgICAgICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybUVsKTtcclxuICAgIH1cclxuXHJcbiAgICBfc2hvd0lucHV0RXJyIChpbnB1dEVsKSB7XHJcbiAgICAgIGNvbnN0IGVyckVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcbiAgICAgIFxyXG4gICAgICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJDbGFzcyk7XHJcbiAgICAgIGVyckVsLnRleHRDb250ZW50ID0gaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgICAgZXJyRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGlkZUlucHV0RXJyb3IgKGlucHV0RWwpIHtcclxuICAgICAgY29uc3QgZXJyRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuXHJcbiAgICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVyckNsYXNzKTtcclxuICAgICAgZXJyRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzKTtcclxuICAgICAgZXJyRWwudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkgKGlucHV0RWwpIHtcclxuICAgICAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyKGlucHV0RWwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2hhc0ludmFsaWRJbnB1dCAoaW5wdXRMc3QpIHtcclxuICAgICAgcmV0dXJuIGlucHV0THN0LnNvbWUoKGlucHV0RWwpID0+ICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVCdXR0b25TdGF0ZSAoKSB7XHJcbiAgICAgIGNvbnN0IGlucHV0THN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSk7XHJcbiAgICAgIGNvbnN0IGJ0bkVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnRuU2VsZWN0b3IpO1xyXG4gICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0THN0KSkge1xyXG4gICAgICAgIGJ0bkVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdG5DbGFzcyk7XHJcbiAgICAgICAgYnRuRWwuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGJ0bkVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdG5DbGFzcyk7XHJcbiAgICAgICAgYnRuRWwuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICAgIGNvbnN0IGlucHV0THN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSk7XHJcbiAgICAgIGNvbnN0IGJ0bkVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnRuU2VsZWN0b3IpO1xyXG4gICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0THN0LCBidG5FbCk7XHJcbiAgICAgIGlucHV0THN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7ICAgXHJcbiAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0THN0LCBidG5FbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVuYWJsZVZhbGlkYXRpb24gKCkge1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICB0aGlzLl9mb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiBldnQucHJldmVudERlZmF1bHQoKSk7XHJcbiAgICB9XHJcblxyXG4gIH0iLCJleHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gICAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxyXG4gICAgZm9ybUlucHV0c0ZpZWxkU2V0OiBcIi5wb3B1cF9fZm9ybS1zZXRcIixcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnRuU2VsZWN0b3I6IFwiLnBvcHVwX19zdWJtaXQtYnRuXCIsXHJcbiAgICBpbmFjdGl2ZUJ0bkNsYXNzOiBcImJ1dHRvbl9pbmFjdGl2ZVwiLFxyXG4gICAgaW5wdXRFcnJDbGFzczogXCJwb3B1cF9faW5wdXQtdGV4dF90eXBlX2Vycm9yXCIsXHJcbiAgICBpbnB1dEVyckFjdGl2ZUNsYXNzOiBcInBvcHVwX19pbnB1dC10ZXh0LWVycm9yX2FjdGl2ZVwiXHJcbiAgfVxyXG5cclxuXHJcbi8qKiBwcm9maWxlIHBvcHVwIGVsZW1lbnRzICovXHJcbmNvbnN0IHByb2ZpbGVGb3JtICAgICAgICAgICAgICAgICAgPSBkb2N1bWVudC5mb3Jtcy5wcm9maWxlZm9ybTtcclxuZXhwb3J0IGNvbnN0IGlucHV0TmFtZSAgICAgICAgICAgICA9IHByb2ZpbGVGb3JtLmVsZW1lbnRzLnByb2ZpbGVOYW1lO1xyXG5leHBvcnQgY29uc3QgaW5wdXRBYm91dE1lICAgICAgICAgID0gcHJvZmlsZUZvcm0uZWxlbWVudHMucHJvZmlsZUFib3V0TWU7XHJcbmV4cG9ydCBjb25zdCBwbGFjZUZvcm0gICAgICAgICAgICAgPSBkb2N1bWVudC5mb3Jtcy5wbGFjZWZvcm07XHJcblxyXG5leHBvcnQgY29uc3QgZ2FsbGVyeUxpc3RTZWxlY3RvciAgPSBcIi5nYWxsZXJ5X19saXN0XCI7XHJcblxyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSAgXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCJcclxuLyoqIG1haW4gYnV0dG9ucyAqL1xyXG5jb25zdCBwcm9maWxlRWRpdEJ0biAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBvcGVOZXdDYXJkUG9wdXBCdG4gICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2FkZC1idG5cIik7XHJcblxyXG4vKiogcHJvZmlsZSBkYXRhIGVsZW1lbnRzICovXHJcbmNvbnN0IHByb2ZpbGVOYW1lICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZUFib3V0TWUgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hYm91dC1tZVwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhciAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbi8qKiBnYWxsZXJ5IGNvbnRhaW5lciAqL1xyXG5jb25zdCBjb250YWluZXIgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlcIik7XHJcblxyXG5jb25zdCBpbml0Q2FyZHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiOWI2MjFmMGYtNWRmZS00M2YxLTk1ZmQtZTljYzE4OGJjYzM1XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogaW5pdGlhYWwgdXNlciBpbmZvIGFuZCBnYWxsZXJ5IENhcmRzIGZyb21cclxuICovXHJcbmFwaS5pbml0KClcclxuLnRoZW4oKFt1c2VyLGNhcmRzXSkgPT4ge1xyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXIpO1xyXG4gIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoe2F2YXRhcjogdXNlci5hdmF0YXIsbmFtZTogdXNlci5uYW1lfSk7XHJcbiAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge2luaXRDYXJkcy5wdXNoKGNhcmQpO30pXHJcbiAgY2FyZExpc3QucmVuZGVyZXIoKTtcclxufSlcclxuLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgaGFuZGxlRXJyb3IoZXJyKTtcclxufSlcclxuZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyKSB7XHJcbiAgY29uc3QgZXJyb3JFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZXJyb3JcIik7XHJcbiAgZXJyb3JFbC50ZXh0Q29udGVudCA9IGVycjtcclxuICBlcnJvckVsLnN0eWxlLmRpc3BsYXkgID0gXCJibG9ja1wiO1xyXG59XHJcbmNvbnN0IGNhcmRMaXN0ICA9IG5ldyBTZWN0aW9uKHtkYXRhOiBpbml0Q2FyZHMsIHJlbmRlcmVyOiBhZGRHYWxsZXJ5Q2FyZEl0ZW19LCBjb25zdGFudHMuZ2FsbGVyeUxpc3RTZWxlY3Rvcik7XHJcbmNvbnN0IHVzZXJJbmZvICA9IG5ldyBVc2VySW5mbyhcIi5wcm9maWxlX19uYW1lXCIsIFwiLnByb2ZpbGVfX2Fib3V0LW1lXCIsIFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuXHJcbmZ1bmN0aW9uICBhZGRHYWxsZXJ5Q2FyZEl0ZW0gKGl0ZW0pIHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoaXRlbSwgXHJcbiAgICBcIiNnYWxsZXJ5LWl0ZW0tdGVtcGxhdGVcIixcclxuICAgICgpID0+IHtcclxuICAgICAgY29uc3QgcG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2Uoe3NyYyA6IGl0ZW0ubGluayAsIHRpdGxlOiBpdGVtLm5hbWV9LCBcIi5wb3B1cF90eXBlX2ltZ1wiKTtcclxuICAgICAgcG9wdXAub3BlbigpO1xyXG4gICAgfSxhcGkpO1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxuICBjYXJkTGlzdC5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxufVxyXG4vKipcclxuICogYWRkIHBvcHVwIHdpdGggZm9ybSB0byBhZGQgbmV3IGNhcmQgaXRlbSB0byBnYWxsZXJ5XHJcbiAqL1xyXG5jb25zdCBuZXdDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSAoXHJcbiAgXCIucG9wdXBfdHlwZV9uZXctY2FyZFwiLFxyXG4gIGhhbmRsZUNyZWF0ZU5ld0NhcmRcclxuKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNyZWF0ZU5ld0NhcmQgKGlucHV0cykge1xyXG4gIGFkZEdhbGxlcnlDYXJkSXRlbSh7bGluazogaW5wdXRzLnBsYWNlSW1hZ2VMaW5rLCBuYW1lOiBpbnB1dHMucGxhY2VOYW1lfSk7XHJcbiAgYXBpLmNyZWF0ZU5ld0NhcmQoaW5wdXRzLnBsYWNlSW1hZ2VMaW5rLGlucHV0cy5wbGFjZU5hbWUpXHJcbiAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhKVxyXG4gIH0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBoYW5kbGVFcnJvcihlcnIpO1xyXG4gIH0pXHJcbiAgY29uc3RhbnRzLnBsYWNlRm9ybS5yZXNldCgpO1xyXG4gIG5ld0NhcmRQb3B1cC5jbG9zZSgpO1xyXG4gIG5ld0NhcmRWYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxufVxyXG5cclxub3BlTmV3Q2FyZFBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBuZXdDYXJkUG9wdXAub3BlbigpKTtcclxuXHJcbi8qKlxyXG4gKiBhZGQgcG9wdXAgd2l0aCBmb3JtIHRvIGVkaXQgbWFpbiB1c2VyIGluZm9cclxuICovXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtIChcclxuICBcIi5wb3B1cF90eXBlX3Byb2ZpbGVcIixcclxuICAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXRcclxuKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0IChpbnB1dHMpIHtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyh7bmFtZTogaW5wdXRzLnByb2ZpbGVOYW1lLCBqb2I6IGlucHV0cy5wcm9maWxlQWJvdXRNZX0pXHJcbiAgYXBpLmVkaXRQcm9maWxlKHtuYW1lOiBpbnB1dHMucHJvZmlsZU5hbWUsIGpvYjogaW5wdXRzLnByb2ZpbGVBYm91dE1lfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxuXHJcbiAgcHJvZmlsZVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG59XHJcblxyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IHtuYW1lLCBqb2IgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgY29uc3RhbnRzLmlucHV0TmFtZS52YWx1ZSAgPSBuYW1lO1xyXG4gIGNvbnN0YW50cy5pbnB1dEFib3V0TWUudmFsdWUgID0gam9iO1xyXG4gIHByb2ZpbGVQb3B1cC5vcGVuKCk7XHJcbn0pO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBhZGQgZm9ybSB2YWxpZGF0aW9uIGZvciBhbGwgZm9ybXNcclxuICovXHJcbmNvbnN0IG5ld0NhcmRWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25zdGFudHMuY29uZmlnLFwiLnBvcHVwX19mb3JtX3R5cGVfbmV3LWNhcmRcIik7XHJcbm5ld0NhcmRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuY29uc3QgcHJvZmlsZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbnN0YW50cy5jb25maWcsXCIucG9wdXBfX2Zvcm1fdHlwZV9wcm9maWxlXCIpO1xyXG5wcm9maWxlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XHJcbiAgICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xyXG5cclxuICAgIH1cclxuICBcclxuICAgIF9jYWxsKGFjdGlvbiwgbWV0aG9kLCBkYXRhKSB7XHJcbiAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwgKyBhY3Rpb24sIHtcclxuICAgICAgICBtZXRob2Q6IG1ldGhvZCxcclxuICAgICAgICBoZWFkZXJzOiAgdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGlmKHJlcy5vaykge1xyXG4gICAgICAgICAgcmV0dXJuICByZXMuanNvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1cyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdHRVQnKTtcclxuICAgIH1cclxuICBcclxuICAgIGdldFVzZXJEYXRhID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi91c2Vycy9tZVwiLCdHRVQnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZWRpdFByb2ZpbGUoe25hbWUsIGpvYn0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWVcIiwnUEFUQ0gnLHtcclxuICAgICAgICBuYW1lOiBuYW1lWzBdLFxyXG4gICAgICAgIGFib3V0OiBqb2JbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTmV3Q2FyZCAobGluaywgbmFtZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdQT1NUJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBsaW5rOiBsaW5rWzBdXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZExpa2UgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwnUFVUJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdERUxFVEUnKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckRhdGEoKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IoIHsgZGF0YSwgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgICAgICAgPSBkYXRhLFxyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyICAgID0gcmVuZGVyZXI7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgcmVuZGVyZXIoKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgVXNlckluZm8gY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBcclxuICAgICAqIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyIG9uIHRoZSBwYWdlLiBUaGlzIGNsYXNzIHNob3VsZDpcclxuICAgICAqIC1UYWtlIGFuIG9iamVjdCB3aXRoIHRoZSBzZWxlY3RvcnMgb2YgdHdvIGVsZW1lbnRzIGludG8gdGhlIGNvbnN0cnVjdG9yOiBcclxuICAgICAqIG9uZSBjb250YWluaW5nIHRoZSB1c2VyJ3MgbmFtZSwgYW5kIGFub3RoZXIgY29udGFpbmluZyB0aGUgdXNlcidzIGpvYi5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IgKCBuYW1lU2VsZWN0b3IsIGpvYlNlbGVjdG9yLCBhdmF0YXJTZWxlY3RvciA9IG51bGwpIHtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJJbmZvKCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHJldHVybnMgYW4gb2JqZWN0IHdpdGggaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIuIFxyXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgaGFuZHkgZm9yIFxyXG4gICAgICAgICAqIGNhc2VzIHdoZW4gaXQncyBuZWNlc3NhcnkgdG8gZGlzcGxheSB0aGUgdXNlciBkYXRhIGluIHRoZSBvcGVuIGZvcm0uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgICAgICAgIGpvYjogdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyhkYXRhKXtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiB0YWtlcyBuZXcgdXNlciBkYXRhIGFuZCBhZGRzIGl0IG9uIHRoZSBwYWdlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ICAgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQuaWQgICAgICAgICAgICA9IGRhdGEuX2lkO1xyXG4gICAgICAgIHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQgICAgPSBkYXRhLmFib3V0O1xyXG5cclxuICAgIH1cclxuICAgIHNldFVzZXJBdmF0YXIoe2F2YXRhciwgbmFtZX0pIHtcclxuICAgICAgICB0aGlzLl9hdmF0YXIuc3JjID0gYXZhdGFyO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhci5hbHQgPSBuYW1lO1xyXG4gICAgfVxyXG59Il0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVDYXJkQ2xpY2siLCJhcGkiLCJsaWtlQnRuIiwidGhpcyIsIl9lbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImdhbGxlcnlsaWtlQ291bnQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsIl9kZWxldGVMaWtlIiwiaWQiLCJ0ZXh0Q29udGVudCIsIl9hZGRMaWtlIiwidG9nZ2xlIiwicmVtb3ZlIiwiX3RleHQiLCJuYW1lIiwiX2ltZyIsImxpbmsiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiYWRkTGlrZSIsImRlbGV0ZUxpa2UiLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJnZW5lcmF0ZUNhcmQiLCJnYWxsZXJ5SXRlbUltZyIsImdhbGxlcnlJdGVtTmFtZSIsIm15SWQiLCJzcmMiLCJhbHQiLCJfaW5pdExpa2UiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJ1c2VySWQiLCJfdXNlckV4aXN0cyIsImFkZCIsImxlbmd0aCIsInNvbWUiLCJ1c2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVMaWtlQnRuIiwiX2hhbmRsZURlbGV0ZUdhbGxlcnlDYXJkSXRlbSIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImV2dCIsImtleSIsImNsb3NlIiwidGFyZ2V0IiwiX3BvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJvcGVuIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlQ2xpY2tDbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm1FbGVtZXQiLCJpbnB1dFZhbHVlcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaW5wdXQiLCJ2YWx1ZSIsIl9oYW5kbGVTdWJtaXQiLCJyZXNldCIsIlBvcHVwV2l0aEltYWdlIiwidGl0bGUiLCJfc3JjIiwiX3RpdGxlIiwiX3BvcHVwSW1nIiwiX3BvcHVwVGl0bGUiLCJGb3JtVmFsaWRhdG9yIiwiY29uZmlnIiwiZm9ybUVsIiwiX2Zvcm1TZWxlY3RvciIsImZvcm1TZWxlY3RvciIsIl9mb3JtSW5wdXRzRmllbGRTZXQiLCJmb3JtSW5wdXRzRmllbGRTZXQiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnRuU2VsZWN0b3IiLCJzdWJtaXRCdG5TZWxlY3RvciIsIl9pbmFjdGl2ZUJ0bkNsYXNzIiwiaW5hY3RpdmVCdG5DbGFzcyIsIl9pbnB1dEVyckNsYXNzIiwiaW5wdXRFcnJDbGFzcyIsIl9pbnB1dEVyckFjdGl2ZUNsYXNzIiwiaW5wdXRFcnJBY3RpdmVDbGFzcyIsIl9mb3JtRWwiLCJfc2hvd0lucHV0RXJyIiwiaW5wdXRFbCIsImVyckVsIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJpbnB1dExzdCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiQXJyYXkiLCJmcm9tIiwiYnRuRWwiLCJkaXNhYmxlZCIsImVuYWJsZVZhbGlkYXRpb24iLCJwcm9maWxlRm9ybSIsImZvcm1zIiwicHJvZmlsZWZvcm0iLCJpbnB1dE5hbWUiLCJlbGVtZW50cyIsInByb2ZpbGVOYW1lIiwiaW5wdXRBYm91dE1lIiwicHJvZmlsZUFib3V0TWUiLCJwbGFjZUZvcm0iLCJwbGFjZWZvcm0iLCJwcm9maWxlRWRpdEJ0biIsIm9wZU5ld0NhcmRQb3B1cEJ0biIsImluaXRDYXJkcyIsIm9wdGlvbnMiLCJfY2FsbCIsImNhcmRJZCIsIl9vcHRpb25zIiwiYWN0aW9uIiwibWV0aG9kIiwiZmV0Y2giLCJiYXNlVXJsIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJlZGl0UHJvZmlsZSIsImpvYiIsImFib3V0IiwiY3JlYXRlTmV3Q2FyZCIsImluaXQiLCJhbGwiLCJnZXRVc2VyRGF0YSIsImdldEluaXRpYWxDYXJkcyIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVFcnJvciIsImVyciIsImVycm9yRWwiLCJzdHlsZSIsImRpc3BsYXkiLCJjYXJkcyIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJzZXRVc2VyQXZhdGFyIiwiYXZhdGFyIiwiY2FyZCIsInB1c2giLCJjYXJkTGlzdCIsInJlbmRlcmVyIiwiY2F0Y2giLCJjb250YWluZXJTZWxlY3RvciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwiZWxlbWVudCIsImFwcGVuZCIsIml0ZW0iLCJhZGRHYWxsZXJ5Q2FyZEl0ZW0iLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX25hbWVFbGVtZW50IiwiX2pvYkVsZW1lbnQiLCJfYXZhdGFyIiwiZ2V0VXNlckluZm8iLCJjYXJkRWxlbWVudCIsIm5ld0NhcmRQb3B1cCIsInBsYWNlSW1hZ2VMaW5rIiwicGxhY2VOYW1lIiwiY29uc29sZSIsImxvZyIsImNvbnN0YW50cyIsIm5ld0NhcmRWYWxpZGF0b3IiLCJwcm9maWxlUG9wdXAiLCJwcm9maWxlVmFsaWRhdG9yIl0sInNvdXJjZVJvb3QiOiIifQ==