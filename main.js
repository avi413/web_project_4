!function(){"use strict";class e{constructor(e,t,i,s,r){var n,l;l=()=>{const e=this._element.querySelector(".gallery__like-btn"),t=this._element.querySelector(".gllery__like-count");e.classList.contains("gallery__like-btn_active")?(this._deleteLike(this._element.id),t.textContent--):(this._addLike(this._element.id),t.textContent++),this._element.querySelector(".gallery__like-btn").classList.toggle("gallery__like-btn_active")},(n="_handleLikeBtn")in this?Object.defineProperty(this,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):this[n]=l,this._text=e.name,this._img=e.link,this._id=e._id,this._likes=e.likes,this._Cardowner=e.owner,this._cardSelector=t,this._handleCardClick=i,this._handleTrashClick=s,this._addLike=r.addLike,this._deleteLike=r.deleteLike,this._deleteCard=r.deleteCard}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".gallery__item-img"),t=this._element.querySelector(".gallery__item-name"),i=document.querySelector(".profile__name").id;return e.src=this._img,e.alt=this._text,t.textContent=this._text,this._element.id=this._id,this._initLike(i),this._deleteIconVisibility(i),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._Cardowner._id&&(this._element.querySelector(".gallery__item-trash-btn").style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._element.querySelector(".gallery__like-btn").classList.add("gallery__like-btn_active");const t=this._element.querySelector(".gllery__like-count");void 0!==this._likes?t.textContent=this._likes.length:t.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._element.querySelector(".gallery__like-btn").addEventListener("click",this._handleLikeBtn),this._element.querySelector(".gallery__item-trash-btn").addEventListener("click",(()=>{this._handleTrashClick(this._id,this._element)})),this._element.querySelector(".gallery__item-img").addEventListener("click",this._handleCardClick)}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{constructor(e){t(this,"_handleEscClose",(e=>{"Escape"===e.key&&document.querySelector(".popup_opened")&&this.close()})),t(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class s extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return this._formElemet.querySelectorAll(".popup__input").forEach((t=>{e[t.name]=[t.value]})),e}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class r extends i{constructor(e,t){let{src:i,title:s}=e;super(t),this._src=i,this._title=s}open(){super.open(),this._popupImg=this._popup.querySelector(".popup__img"),this._popupTitle=this._popup.querySelector(".popup__img-title"),this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title)}}class n extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._popup.id,this._cardEl),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e,t){super.open(),this._popup.id=e,this._cardEl=t}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class l{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=document.querySelector(t)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this._hasInvalidInput(e)?(t.classList.add(this._inactiveBtnClass),t.disabled=!0):(t.classList.remove(this._inactiveBtnClass),t.disabled=!1)}_setEventListeners(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this.toggleButtonState(e,t),e.forEach((i=>{i.addEventListener("input",(()=>{this._checkInputValidity(i),this.toggleButtonState(e,t)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const o={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},a=document.forms.profileform,_=a.elements.profileName,c=a.elements.profileAboutMe,u=document.forms.placeform;function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const h=document.querySelector("button.profile__edit-btn"),d=document.querySelector("button.profile__add-btn"),m=document.querySelector(".profile__name"),v=(document.querySelector(".profile__about-me"),document.querySelector(".profile__avatar"),document.querySelector(".gallery"),new Array),f=new class{constructor(e){p(this,"getInitialCards",(()=>this._call("/cards","GET"))),p(this,"getUserData",(()=>this._call("/users/me","GET"))),p(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),p(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),p(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t[0],about:i[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}editProfileAvatar(e){return this._call("/users/me/avatar ","PATCH",{avatar:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function b(e){const t=document.querySelector(".profile__error");t.textContent=e,t.style.display="block"}f.init().then((e=>{let[t,i]=e;E.setUserInfo(t),E.setUserAvatar({avatar:t.avatar,name:t.name}),i.forEach((e=>{v.push(e)})),y.renderer()})).catch((e=>{b(e)}));const y=new class{constructor(e,t){let{data:i,renderer:s}=e;this._items=i,this._renderer=s,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}renderer(){this._items.forEach((e=>{this._renderer(e)}))}}({data:v,renderer:g},".gallery__list"),E=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i),this._handleEditAvatar=s}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._nameElement.id=e._id,this._jobElement.textContent=e.about,this._setEventListeners()}setUserAvatar(e){let{avatar:t,name:i=null}=e;this._avatar.src=t,i&&(this._avatar.alt=i)}_setEventListeners(){document.querySelector(".profile__edit-avatar").addEventListener("click",this._handleEditAvatar)}}(".profile__name",".profile__about-me",".profile__avatar",(()=>{new s(".popup_type_avatar",S).open()}));function S(e){q(!1,".popup__submit-btn_place_avatar"),f.editProfileAvatar(e.avatarImageLink).catch((e=>{b(e)})).finally((()=>{q(!1,".popup__submit-btn_place_avatar")})),E.setUserAvatar({avatar:e.avatarImageLink})}function g(t){const i=new e(t,"#gallery-item-template",(()=>{new r({src:t.link,title:t.name},".popup_type_img").open()}),(()=>{new n(".popup_type_delete",C).open(t._id,i)}),f).generateCard();y.addItem(i)}const L=new s(".popup_type_new-card",(function(e){q(!0,".popup__submit-btn_place_new-card"),g({link:e.placeImageLink,name:e.placeName,owner:{_id:m.id}}),f.createNewCard(e.placeImageLink,e.placeName).then((e=>{console.log(e)})).catch((e=>{b(e)})).finally((()=>{q(!1,".popup__submit-btn_place_new-card")})),u.reset(),L.close(),w.toggleButtonState()}));function C(e,t){f.deleteCard(e).then((()=>{t.remove(),t=null})).catch((e=>{console.log(e)}))}d.addEventListener("click",(()=>L.open()));const k=new s(".popup_type_profile",(function(e){q(!0,".popup__submit-btn_place_profile"),E.setUserInfo({name:e.profileName,about:e.profileAboutMe}),f.editProfile({name:e.profileName,about:e.profileAboutMe}).catch((e=>{console.log(e)})).finally((()=>{q(!1,".popup__submit-btn_place_profile")})),I.toggleButtonState()}));function q(e,t){document.querySelector(t).textContent=e?"...Saving":"Save"}h.addEventListener("click",(()=>{const{name:e,about:t}=E.getUserInfo();_.value=e,c.value=t,k.open()}));const w=new l(o,".popup__form_type_new-card");w.enableValidation(),new l(o,".popup__form_type_avatar").enableValidation();const I=new l(o,".popup__form_type_profile");I.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixFQUFLdEgsU0FDTHNILEVBQU8sUUFFUkksT0FBTVgsSUFDTHNDLFFBQVFDLElBQUl2QyxNQXlCaEJqQyxFQUFtQnZGLGlCQUFpQixTQUFTLElBQU0ySixFQUFhaEosU0FLaEUsTUFBTXdKLEVBQWUsSUFBSW5KLEVBQ3ZCLHVCQU9GLFNBQWtDSSxHQUNoQ2tJLEdBQWMsRUFBTSxvQ0FDcEIxQixFQUFTQyxZQUFZLENBQUNqSyxLQUFNd0QsRUFBTzZELFlBQWE0QixNQUFPekYsRUFBTytELGlCQUM5RHJJLEVBQUk4SixZQUFZLENBQUNoSixLQUFNd0QsRUFBTzZELFlBQWE0QixNQUFPekYsRUFBTytELGlCQUN4RGdELE9BQVFYLElBQ1BzQyxRQUFRQyxJQUFJdkMsTUFFYmdDLFNBQVEsS0FDUEYsR0FBYyxFQUFPLHVDQUV2QmMsRUFBaUI5Rix1QkFnQm5CLFNBQVNnRixFQUFjZSxFQUFXQyxHQUNsQjFMLFNBQVMxQixjQUFjb04sR0FFN0I5TSxZQURMNk0sRUFDbUIsWUFHQSxPQWhCeEIvRSxFQUFldEYsaUJBQWlCLFNBQVMsS0FDdkMsTUFBTSxLQUFDcEMsRUFBRCxNQUFPaUosR0FBVWUsRUFBU3lCLGNBQ2hDVyxFQUFBQSxNQUE2QnBNLEVBQzdCb00sRUFBQUEsTUFBZ0NuRCxFQUNoQ3NELEVBQWF4SixVQW1CZixNQUFNc0osRUFBbUIsSUFBSXZILEVBQWNzSCxFQUFpQiw4QkFDNURDLEVBQWlCdEYsbUJBRVcsSUFBSWpDLEVBQWNzSCxFQUFpQiw0QkFDM0NyRixtQkFFcEIsTUFBTXlGLEVBQW1CLElBQUkxSCxFQUFjc0gsRUFBaUIsNkJBQzVESSxFQUFpQnpGLG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgICBjb25zdHJ1Y3RvciggZGF0YSwgY2FyZFNlbGVjdG9yLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZVRyYXNoQ2xpY2ssIGFwaSkge1xyXG4gICAgICB0aGlzLl90ZXh0ICAgICAgICAgICAgICA9IGRhdGEubmFtZTtcclxuICAgICAgdGhpcy5faW1nICAgICAgICAgICAgICA9IGRhdGEubGluaztcclxuICAgICAgdGhpcy5faWQgICAgICAgICAgICAgICAgPSBkYXRhLl9pZDtcclxuICAgICAgdGhpcy5fbGlrZXMgICAgICAgICAgICAgPSBkYXRhLmxpa2VzO1xyXG4gICAgICB0aGlzLl9DYXJkb3duZXIgICAgICAgICA9IGRhdGEub3duZXI7XHJcbiAgICAgIHRoaXMuX2NhcmRTZWxlY3RvciAgICAgID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgICA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgICAgdGhpcy5faGFuZGxlVHJhc2hDbGljayAgPSBoYW5kbGVUcmFzaENsaWNrO1xyXG4gICAgICB0aGlzLl9hZGRMaWtlICAgICAgICAgICA9IGFwaS5hZGRMaWtlO1xyXG4gICAgICB0aGlzLl9kZWxldGVMaWtlICAgICAgICA9IGFwaS5kZWxldGVMaWtlO1xyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkICAgICAgICA9IGFwaS5kZWxldGVDYXJkO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxyXG4gICAgICAgIC5jb250ZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbVwiKVxyXG4gICAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgXHJcbiAgICAgIHJldHVybiBjYXJkRWxlbWVudDtcclxuICAgIH1cclxuICBcclxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlJdGVtSW1nID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0taW1nXCIpO1xyXG4gICAgICBjb25zdCBnYWxsZXJ5SXRlbU5hbWUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS1uYW1lXCIpO1xyXG4gICAgICBjb25zdCBteUlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpLmlkO1xyXG5cclxuICAgICAgZ2FsbGVyeUl0ZW1JbWcuc3JjID0gdGhpcy5faW1nO1xyXG4gICAgICBnYWxsZXJ5SXRlbUltZy5hbHQgPSB0aGlzLl90ZXh0O1xyXG4gICAgICBnYWxsZXJ5SXRlbU5hbWUudGV4dENvbnRlbnQgPSB0aGlzLl90ZXh0O1xyXG4gXHJcbiAgICAgIHRoaXMuX2VsZW1lbnQuaWQgPSB0aGlzLl9pZDtcclxuICAgICAgdGhpcy5faW5pdExpa2UobXlJZCk7XHJcbiAgICAgIHRoaXMuIF9kZWxldGVJY29uVmlzaWJpbGl0eShteUlkKTtcclxuICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfZGVsZXRlSWNvblZpc2liaWxpdHkodXNlcklkKXtcclxuICAgICAgaWYodXNlcklkICE9ICB0aGlzLl9DYXJkb3duZXIuX2lkKSB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0tdHJhc2gtYnRuXCIpLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2luaXRMaWtlKHVzZXJJZCl7XHJcbiAgICAgIGlmKHRoaXMuX3VzZXJFeGlzdHModXNlcklkKSkge1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKS5jbGFzc0xpc3QuYWRkKCdnYWxsZXJ5X19saWtlLWJ0bl9hY3RpdmUnKTsgXHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgZ2FsbGVyeWxpa2VDb3VudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nbGxlcnlfX2xpa2UtY291bnRcIik7XHJcbiAgICAgIGlmKHR5cGVvZiB0aGlzLl9saWtlcyAhPT0gXCJ1bmRlZmluZWRcIil7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ICA9IDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfdXNlckV4aXN0cyhpZCkge1xyXG4gICAgICBpZih0eXBlb2YgdGhpcy5fbGlrZXMgIT09IFwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgIHJldHVybiB1c2VyLl9pZCA9PT0gaWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuXHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgIHRoaXMuX2hhbmRsZUxpa2VCdG4pO1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbS10cmFzaC1idG5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCkgPT57dGhpcy5faGFuZGxlVHJhc2hDbGljayh0aGlzLl9pZCwgdGhpcy5fZWxlbWVudCl9KTtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0taW1nXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDYXJkQ2xpY2spO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2hhbmRsZUxpa2VCdG4gPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxpa2VCdG4gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIik7XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlsaWtlQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2xsZXJ5X19saWtlLWNvdW50XCIpO1xyXG4gICAgICBpZihsaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucygnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJykpe1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZUxpa2UodGhpcy5fZWxlbWVudC5pZCk7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCAtLTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLl9hZGRMaWtlKHRoaXMuX2VsZW1lbnQuaWQpO1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgKys7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpLmNsYXNzTGlzdC50b2dnbGUoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpO1xyXG5cclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgfVxyXG4gICAgICAgLypcclxuICAgIF9oYW5kbGVEZWxldGVHYWxsZXJ5Q2FyZEl0ZW0gPSAoKSA9PiB7XHJcbiAgICAgXHJcblxyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkKHRoaXMuX2VsZW1lbnQuaWQpXHJcbiAgICAgIC50aGVuKCgpID0+e1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGFsZXJ0KGVycik7XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRGVsZXRlID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLl9kZWxldGVDYXJkKHRoaXMuX2VsZW1lbnQuaWQpXHJcbiAgICAgIC50aGVuKCgpID0+e1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGFsZXJ0KGVycik7XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICAgICAgKi9cclxuICB9IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIH1cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBjbG9zZSBjbGljayByZW1vdmUgZXZlbnRzICovXHJcbiAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICAvKiogcG9wdXBzIG9wZW4gZXZlbnRzICovXHJcbiAgICAgICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+e1xyXG4gICAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgICAgIGlmKHBvcHVwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0gICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlQ2xpY2tDbG9zZVBvcHVwKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCA9IChldnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfb3BlbmVkXCIpIHx8XHJcbiAgICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX2Nsb3NlXCIpICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuXHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSAgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0ICkge1xyXG4gICAgICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCAgPSAgIGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQgICAgICAgID0gICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dHNBcnIgPSB0aGlzLl9mb3JtRWxlbWV0LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpO1xyXG4gICAgICAgICAgICBpbnB1dHNBcnIuZm9yRWFjaChpbnB1dCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IFtpbnB1dC52YWx1ZV07XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBzZXRFdmVudExpc3RlbmVycygpIHBhcmVudCBtZXRob2QuIFxyXG4gICAgICAgICAgICAgKiBUaGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBtZXRob2Qgb2YgdGhlIFBvcHVwV2l0aEZvcm0gY2xhc3NcclxuICAgICAgICAgICAgICogIGhhcyB0byBhZGQgdGhlIHN1Ym1pdCBldmVudCBoYW5kbGVyIHRvIHRoZSBmb3JtIGFuZCB0aGUgY2xpY2sgXHJcbiAgICAgICAgICAgICAqIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBjbG9zZSBpY29uLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgX2hhbmRsZVN1Ym1pdCA9KGV2dCkgPT57XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOyBcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRzID0gIHRoaXMuX2dldElucHV0VmFsdWVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQoaW5wdXRzKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXB7XHJcbiAgICBjb25zdHJ1Y3RvciAoIHtzcmMgLHRpdGxlIH0gLHBvcHVwU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fc3JjICAgPSBzcmM7XHJcbiAgICAgICAgdGhpcy5fdGl0bGUgPSB0aXRsZTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKCkge1xyXG4gICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgICAgICB0aGlzLl9wb3B1cEltZyA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltZ1wiKTtcclxuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1nLXRpdGxlXCIpO1xyXG5cclxuICAgICAgICB0aGlzLl9wb3B1cEltZy5zcmMgPSAgdGhpcy5fc3JjO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwSW1nLmFsdCA9ICB0aGlzLl90aXRsZTtcclxuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlLnRleHRDb250ZW50ID0gYFBob3RvIG9mICR7dGhpcy5fdGl0bGV9YDtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uICBleHRlbmRzIFBvcHVwIHtcclxuICAgICAgICBjb25zdHJ1Y3RvciAoIHBvcHVwU2VsZWN0b3IsIGhhbmRsZUNvbmZpcm0gKSB7XHJcbiAgICAgICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDb25maXJtICAgICA9ICAgaGFuZGxlQ29uZmlybTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldCAgICAgICAgPSAgIHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogIGhhcyB0byBhZGQgdGhlIHN1Ym1pdCBldmVudCBoYW5kbGVyIHRvIHRoZSBmb3JtIGFuZCB0aGUgY2xpY2sgXHJcbiAgICAgICAgICAgICAqIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBjbG9zZSBpY29uLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsICB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIF9oYW5kbGVTdWJtaXQgPShldnQpID0+e1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNvbmZpcm0odGhpcy5fcG9wdXAuaWQsIHRoaXMuX2NhcmRFbCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9wZW4oaWQsIGNhcmRFbCkge1xyXG4gICAgICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwLmlkID1pZDtcclxuICAgICAgICAgICAgdGhpcy5fY2FyZEVsID0gY2FyZEVsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKCBjb25maWcsIGZvcm1FbCApe1xyXG4gICAgICB0aGlzLl9mb3JtU2VsZWN0b3IgICAgICAgICA9IGNvbmZpZy5mb3JtU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2Zvcm1JbnB1dHNGaWVsZFNldCAgID0gY29uZmlnLmZvcm1JbnB1dHNGaWVsZFNldDtcclxuICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciAgICAgICAgPSBjb25maWcuaW5wdXRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuU2VsZWN0b3IgICAgPSBjb25maWcuc3VibWl0QnRuU2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX2luYWN0aXZlQnRuQ2xhc3MgICAgID0gY29uZmlnLmluYWN0aXZlQnRuQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyQ2xhc3MgICAgICAgID0gY29uZmlnLmlucHV0RXJyQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MgID0gY29uZmlnLmlucHV0RXJyQWN0aXZlQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbCAgICAgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtRWwpO1xyXG4gICAgfVxyXG5cclxuICAgIF9zaG93SW5wdXRFcnIgKGlucHV0RWwpIHtcclxuICAgICAgY29uc3QgZXJyRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgICAgXHJcbiAgICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVyckNsYXNzKTtcclxuICAgICAgZXJyRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgICBlcnJFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oaWRlSW5wdXRFcnJvciAoaW5wdXRFbCkge1xyXG4gICAgICBjb25zdCBlcnJFbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG5cclxuICAgICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyQ2xhc3MpO1xyXG4gICAgICBlcnJFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyQWN0aXZlQ2xhc3MpO1xyXG4gICAgICBlcnJFbC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrSW5wdXRWYWxpZGl0eSAoaW5wdXRFbCkge1xyXG4gICAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnIoaW5wdXRFbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaGFzSW52YWxpZElucHV0IChpbnB1dExzdCkge1xyXG4gICAgICByZXR1cm4gaW5wdXRMc3Quc29tZSgoaW5wdXRFbCkgPT4gIWlucHV0RWwudmFsaWRpdHkudmFsaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlICgpIHtcclxuICAgICAgY29uc3QgaW5wdXRMc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgY29uc3QgYnRuRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoaW5wdXRMc3QpKSB7XHJcbiAgICAgICAgYnRuRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzKTtcclxuICAgICAgICBidG5FbC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnRuRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzKTtcclxuICAgICAgICBidG5FbC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzICgpIHtcclxuICAgICAgY29uc3QgaW5wdXRMc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgY29uc3QgYnRuRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMc3QsIGJ0bkVsKTtcclxuICAgICAgaW5wdXRMc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHsgICBcclxuICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKTtcclxuICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMc3QsIGJ0bkVsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IGV2dC5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgIH1cclxuXHJcbiAgfSIsImV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXHJcbiAgICBmb3JtSW5wdXRzRmllbGRTZXQ6IFwiLnBvcHVwX19mb3JtLXNldFwiLFxyXG4gICAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2lucHV0XCIsXHJcbiAgICBzdWJtaXRCdG5TZWxlY3RvcjogXCIucG9wdXBfX3N1Ym1pdC1idG5cIixcclxuICAgIGluYWN0aXZlQnRuQ2xhc3M6IFwiYnV0dG9uX2luYWN0aXZlXCIsXHJcbiAgICBpbnB1dEVyckNsYXNzOiBcInBvcHVwX19pbnB1dC10ZXh0X3R5cGVfZXJyb3JcIixcclxuICAgIGlucHV0RXJyQWN0aXZlQ2xhc3M6IFwicG9wdXBfX2lucHV0LXRleHQtZXJyb3JfYWN0aXZlXCJcclxuICB9XHJcblxyXG5cclxuLyoqIHByb2ZpbGUgcG9wdXAgZWxlbWVudHMgKi9cclxuY29uc3QgcHJvZmlsZUZvcm0gICAgICAgICAgICAgICAgICA9IGRvY3VtZW50LmZvcm1zLnByb2ZpbGVmb3JtO1xyXG5leHBvcnQgY29uc3QgaW5wdXROYW1lICAgICAgICAgICAgID0gcHJvZmlsZUZvcm0uZWxlbWVudHMucHJvZmlsZU5hbWU7XHJcbmV4cG9ydCBjb25zdCBpbnB1dEFib3V0TWUgICAgICAgICAgPSBwcm9maWxlRm9ybS5lbGVtZW50cy5wcm9maWxlQWJvdXRNZTtcclxuZXhwb3J0IGNvbnN0IHBsYWNlRm9ybSAgICAgICAgICAgICA9IGRvY3VtZW50LmZvcm1zLnBsYWNlZm9ybTtcclxuXHJcbmV4cG9ydCBjb25zdCBnYWxsZXJ5TGlzdFNlbGVjdG9yICA9IFwiLmdhbGxlcnlfX2xpc3RcIjtcclxuXHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tICBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtYXRpb24uanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIlxyXG4vKiogbWFpbiBidXR0b25zICovXHJcbmNvbnN0IHByb2ZpbGVFZGl0QnRuICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24ucHJvZmlsZV9fZWRpdC1idG5cIik7XHJcbmNvbnN0IG9wZU5ld0NhcmRQb3B1cEJ0biAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24ucHJvZmlsZV9fYWRkLWJ0blwiKTtcclxuXHJcbi8qKiBwcm9maWxlIGRhdGEgZWxlbWVudHMgKi9cclxuY29uc3QgcHJvZmlsZU5hbWUgICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlQWJvdXRNZSAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Fib3V0LW1lXCIpO1xyXG5jb25zdCBwcm9maWxlQXZhdGFyICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuLyoqIGdhbGxlcnkgY29udGFpbmVyICovXHJcbmNvbnN0IGNvbnRhaW5lciAgICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeVwiKTtcclxuXHJcblxyXG5jb25zdCBpbml0Q2FyZHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiOWI2MjFmMGYtNWRmZS00M2YxLTk1ZmQtZTljYzE4OGJjYzM1XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogaW5pdGlhYWwgdXNlciBpbmZvIGFuZCBnYWxsZXJ5IENhcmRzIGZyb21cclxuICovXHJcbmFwaS5pbml0KClcclxuLnRoZW4oKFt1c2VyLGNhcmRzXSkgPT4ge1xyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXIpO1xyXG4gIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoe2F2YXRhcjogdXNlci5hdmF0YXIsbmFtZTogdXNlci5uYW1lfSk7XHJcbiAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge2luaXRDYXJkcy5wdXNoKGNhcmQpO30pXHJcbiAgY2FyZExpc3QucmVuZGVyZXIoKTtcclxufSlcclxuLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgaGFuZGxlRXJyb3IoZXJyKTtcclxufSlcclxuXHJcbi8qKlxyXG4gKiBzZXQgRXJyb3IgZGVzY3JpcHRpb24gb24gdG9wIG9mIHRoZSBwYWdlXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIpIHtcclxuICBjb25zdCBlcnJvckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lcnJvclwiKTtcclxuICBlcnJvckVsLnRleHRDb250ZW50ID0gZXJyO1xyXG4gIGVycm9yRWwuc3R5bGUuZGlzcGxheSAgPSBcImJsb2NrXCI7XHJcbn1cclxuXHJcbmNvbnN0IGNhcmRMaXN0ICA9IG5ldyBTZWN0aW9uKHtkYXRhOiBpbml0Q2FyZHMsIHJlbmRlcmVyOiBhZGRHYWxsZXJ5Q2FyZEl0ZW19LCBjb25zdGFudHMuZ2FsbGVyeUxpc3RTZWxlY3Rvcik7XHJcbmNvbnN0IHVzZXJJbmZvICA9IG5ldyBVc2VySW5mbyhcIi5wcm9maWxlX19uYW1lXCIsIFwiLnByb2ZpbGVfX2Fib3V0LW1lXCIsIFwiLnByb2ZpbGVfX2F2YXRhclwiLCAoKSA9PiB7XHJcbiAgY29uc3QgRWRpdEF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9hdmF0YXJcIiwgaGFuZGxlRWRpdEF2YXRhcik7XHJcbiAgRWRpdEF2YXRhclBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG4vKipcclxuICogaGFuZGxlIGVkaXQgcG9maWxlIGF2YXRhciBpbWFnZVxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEF2YXRhciAoaW5wdXRzKSB7XHJcbiAgcmVuZGVyTG9hZGluZyhmYWxzZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfYXZhdGFyXCIpO1xyXG4gIGFwaS5lZGl0UHJvZmlsZUF2YXRhcihpbnB1dHMuYXZhdGFySW1hZ2VMaW5rKVxyXG4gIC5jYXRjaCAoKGVycikgPT4ge1xyXG4gICAgaGFuZGxlRXJyb3IoZXJyKTtcclxuICB9KVxyXG4gIC5maW5hbGx5KCgpID0+e1xyXG4gICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfYXZhdGFyXCIpO1xyXG4gIH0pXHJcbiAgdXNlckluZm8uc2V0VXNlckF2YXRhcih7YXZhdGFyOiBpbnB1dHMuYXZhdGFySW1hZ2VMaW5rfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZCBuZXcgY2FyZCBpdGVtIHRvIGdhbGxlcnlcclxuICovXHJcbmZ1bmN0aW9uICBhZGRHYWxsZXJ5Q2FyZEl0ZW0gKGl0ZW0pIHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoaXRlbSwgXHJcbiAgICBcIiNnYWxsZXJ5LWl0ZW0tdGVtcGxhdGVcIixcclxuICAgICgpID0+IHtcclxuICAgICAgY29uc3QgcG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2Uoe3NyYyA6IGl0ZW0ubGluayAsIHRpdGxlOiBpdGVtLm5hbWV9LCBcIi5wb3B1cF90eXBlX2ltZ1wiKTtcclxuICAgICAgcG9wdXAub3BlbigpO1xyXG4gICAgfSxcclxuICAgICgpID0+IHtcclxuICAgICAgY29uc3QgcG9wdXBDb25maXJtID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihcIi5wb3B1cF90eXBlX2RlbGV0ZVwiLCBoYW5kbGVEZWxldGUpO1xyXG4gICAgICBwb3B1cENvbmZpcm0ub3BlbihpdGVtLl9pZCwgY2FyZEVsZW1lbnQpO1xyXG4gICAgfSxhcGkpO1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxuICBjYXJkTGlzdC5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZCBwb3B1cCB3aXRoIGZvcm0gdG8gYWRkIG5ldyBjYXJkIGl0ZW0gdG8gZ2FsbGVyeVxyXG4gKi9cclxuY29uc3QgbmV3Q2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0gKFxyXG4gIFwiLnBvcHVwX3R5cGVfbmV3LWNhcmRcIixcclxuICBoYW5kbGVDcmVhdGVOZXdDYXJkXHJcbik7XHJcblxyXG4vKipcclxuICogZGVsZXRlIGNhcmQgaXRlbSBmcm9tIGdhbGxlcnlcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZShpdGVtSWQsIGNhcmQpIHtcclxuICBhcGkuZGVsZXRlQ2FyZChpdGVtSWQpXHJcbiAgLnRoZW4oKCkgPT57XHJcbiAgICBjYXJkLnJlbW92ZSgpO1xyXG4gICAgY2FyZCA9IG51bGw7XHJcbiAgfSlcclxuICAuY2F0Y2goZXJyID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZCBuZXcgY2FyZCBpdGVtIHRvIGdhbGxlcnlcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZUNyZWF0ZU5ld0NhcmQgKGlucHV0cykge1xyXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfbmV3LWNhcmRcIik7XHJcbiAgYWRkR2FsbGVyeUNhcmRJdGVtKHtsaW5rOiBpbnB1dHMucGxhY2VJbWFnZUxpbmssIG5hbWU6IGlucHV0cy5wbGFjZU5hbWUsIG93bmVyOiB7X2lkOiBwcm9maWxlTmFtZS5pZH19KTtcclxuICBhcGkuY3JlYXRlTmV3Q2FyZChpbnB1dHMucGxhY2VJbWFnZUxpbmssaW5wdXRzLnBsYWNlTmFtZSlcclxuICAudGhlbihkYXRhID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGRhdGEpXHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGhhbmRsZUVycm9yKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX25ldy1jYXJkXCIpO1xyXG4gIH0pXHJcbiAgY29uc3RhbnRzLnBsYWNlRm9ybS5yZXNldCgpO1xyXG4gIG5ld0NhcmRQb3B1cC5jbG9zZSgpO1xyXG4gIG5ld0NhcmRWYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxufVxyXG5cclxub3BlTmV3Q2FyZFBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBuZXdDYXJkUG9wdXAub3BlbigpKTtcclxuXHJcbi8qKlxyXG4gKiBhZGQgcG9wdXAgd2l0aCBmb3JtIHRvIGVkaXQgbWFpbiB1c2VyIGluZm9cclxuICovXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtIChcclxuICBcIi5wb3B1cF90eXBlX3Byb2ZpbGVcIixcclxuICAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXRcclxuKTtcclxuXHJcbi8qKlxyXG4gKiBlZGl0IHVzZXIgcHJvZmlsZSBkYXRhXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCAoaW5wdXRzKSB7XHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtuYW1lOiBpbnB1dHMucHJvZmlsZU5hbWUsIGFib3V0OiBpbnB1dHMucHJvZmlsZUFib3V0TWV9KVxyXG4gIGFwaS5lZGl0UHJvZmlsZSh7bmFtZTogaW5wdXRzLnByb2ZpbGVOYW1lLCBhYm91dDogaW5wdXRzLnByb2ZpbGVBYm91dE1lfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX3Byb2ZpbGVcIik7XHJcbiAgfSlcclxuICBwcm9maWxlVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgZXZlbnQgbGlzdGVuZXIgdG8gZWRpdCB1c2VyIHByb2ZpbGUgaW5mb1xyXG4gKi9cclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjb25zdCB7bmFtZSwgYWJvdXQgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgY29uc3RhbnRzLmlucHV0TmFtZS52YWx1ZSAgPSBuYW1lO1xyXG4gIGNvbnN0YW50cy5pbnB1dEFib3V0TWUudmFsdWUgID0gYWJvdXQ7XHJcbiAgcHJvZmlsZVBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG4vKipcclxuICogY2hhbmdlIGJ1dHRvbiB0ZXh0IHRvIC4uc2F2aW5nIHVudGlsIHByb2Nlc3MgZW5kc1xyXG4gKi9cclxuZnVuY3Rpb24gcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGJ0blNlbGVjdG9yKSB7XHJcbiAgY29uc3QgYnRuRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGJ0blNlbGVjdG9yKTtcclxuICBpZihpc0xvYWRpbmcpIHtcclxuICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCIuLi5TYXZpbmdcIjsgXHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgYnRuRWwudGV4dENvbnRlbnQgPSBcIlNhdmVcIjsgXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogYWRkIGZvcm0gdmFsaWRhdGlvbiBmb3IgYWxsIGZvcm1zXHJcbiAqL1xyXG5jb25zdCBuZXdDYXJkVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLmNvbmZpZyxcIi5wb3B1cF9fZm9ybV90eXBlX25ldy1jYXJkXCIpO1xyXG5uZXdDYXJkVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbmNvbnN0IGVkaXRBdmF0YXJWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25zdGFudHMuY29uZmlnLFwiLnBvcHVwX19mb3JtX3R5cGVfYXZhdGFyXCIpO1xyXG5lZGl0QXZhdGFyVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25zdGFudHMuY29uZmlnLFwiLnBvcHVwX19mb3JtX3R5cGVfcHJvZmlsZVwiKTtcclxucHJvZmlsZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcclxuXHJcbiAgICB9XHJcbiAgXHJcbiAgICBfY2FsbChhY3Rpb24sIG1ldGhvZCwgZGF0YSkge1xyXG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsICsgYWN0aW9uLCB7XHJcbiAgICAgICAgbWV0aG9kOiBtZXRob2QsXHJcbiAgICAgICAgaGVhZGVyczogIHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBpZihyZXMub2spIHtcclxuICAgICAgICAgIHJldHVybiAgcmVzLmpzb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXMpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGdldEluaXRpYWxDYXJkcyA9ICgpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvY2FyZHNcIiwnR0VUJyk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBnZXRVc2VyRGF0YSA9ICgpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWVcIiwnR0VUJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGVkaXRQcm9maWxlKHtuYW1lLCBhYm91dH0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWVcIiwnUEFUQ0gnLHtcclxuICAgICAgICBuYW1lOiBuYW1lWzBdLFxyXG4gICAgICAgIGFib3V0OiBhYm91dFswXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVOZXdDYXJkIChsaW5rLCBuYW1lKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL2NhcmRzXCIsJ1BPU1QnLHtcclxuICAgICAgICBuYW1lOiBuYW1lWzBdLFxyXG4gICAgICAgIGxpbms6IGxpbmtbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdQVVQnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVMaWtlID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvJHtjYXJkSWR9YCwnREVMRVRFJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZWRpdFByb2ZpbGVBdmF0YXIodXJsKXtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWUvYXZhdGFyIFwiLCdQQVRDSCcse1xyXG4gICAgICAgIGF2YXRhciA6IHVybFswXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckRhdGEoKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgXHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IoIHsgZGF0YSwgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgICAgICAgPSBkYXRhLFxyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyICAgID0gcmVuZGVyZXI7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgcmVuZGVyZXIoKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgVXNlckluZm8gY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBcclxuICAgICAqIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyIG9uIHRoZSBwYWdlLiBUaGlzIGNsYXNzIHNob3VsZDpcclxuICAgICAqIC1UYWtlIGFuIG9iamVjdCB3aXRoIHRoZSBzZWxlY3RvcnMgb2YgdHdvIGVsZW1lbnRzIGludG8gdGhlIGNvbnN0cnVjdG9yOiBcclxuICAgICAqIG9uZSBjb250YWluaW5nIHRoZSB1c2VyJ3MgbmFtZSwgYW5kIGFub3RoZXIgY29udGFpbmluZyB0aGUgdXNlcidzIGpvYi5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IgKCBuYW1lU2VsZWN0b3IsIGpvYlNlbGVjdG9yLCBhdmF0YXJTZWxlY3RvciA9IG51bGwsIGhhbmRsZUVkaXRBdmF0YXIpIHtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRWRpdEF2YXRhciA9IGhhbmRsZUVkaXRBdmF0YXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogcmV0dXJucyBhbiBvYmplY3Qgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXNlci4gXHJcbiAgICAgICAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBoYW5keSBmb3IgXHJcbiAgICAgICAgICogY2FzZXMgd2hlbiBpdCdzIG5lY2Vzc2FyeSB0byBkaXNwbGF5IHRoZSB1c2VyIGRhdGEgaW4gdGhlIG9wZW4gZm9ybS5cclxuICAgICAgICAgKi9cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgICAgICAgICAgYWJvdXQ6IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnRcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VXNlckluZm8oZGF0YSl7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogdGFrZXMgbmV3IHVzZXIgZGF0YSBhbmQgYWRkcyBpdCBvbiB0aGUgcGFnZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCAgID0gZGF0YS5uYW1lO1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50LmlkICAgICAgICAgICAgPSBkYXRhLl9pZDtcclxuICAgICAgICB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ICAgID0gZGF0YS5hYm91dDtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIH1cclxuICAgIHNldFVzZXJBdmF0YXIoe2F2YXRhciwgbmFtZSA9IG51bGx9KSB7XHJcbiAgICAgICAgdGhpcy5fYXZhdGFyLnNyYyA9IGF2YXRhcjtcclxuICAgICAgICBpZihuYW1lKXtcclxuICAgICAgICAgICAgdGhpcy5fYXZhdGFyLmFsdCA9IG5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYXZhdGFyXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgdGhpcy5faGFuZGxlRWRpdEF2YXRhcik7XHJcbiAgICAgIH1cclxufSJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlVHJhc2hDbGljayIsImFwaSIsImxpa2VCdG4iLCJ0aGlzIiwiX2VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZ2FsbGVyeWxpa2VDb3VudCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiX2RlbGV0ZUxpa2UiLCJpZCIsInRleHRDb250ZW50IiwiX2FkZExpa2UiLCJ0b2dnbGUiLCJfdGV4dCIsIm5hbWUiLCJfaW1nIiwibGluayIsIl9pZCIsIl9saWtlcyIsImxpa2VzIiwiX0NhcmRvd25lciIsIm93bmVyIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlVHJhc2hDbGljayIsImFkZExpa2UiLCJkZWxldGVMaWtlIiwiX2RlbGV0ZUNhcmQiLCJkZWxldGVDYXJkIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiZ2FsbGVyeUl0ZW1JbWciLCJnYWxsZXJ5SXRlbU5hbWUiLCJteUlkIiwic3JjIiwiYWx0IiwiX2luaXRMaWtlIiwiX2RlbGV0ZUljb25WaXNpYmlsaXR5IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwidXNlcklkIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiX3VzZXJFeGlzdHMiLCJhZGQiLCJsZW5ndGgiLCJzb21lIiwidXNlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlTGlrZUJ0biIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImV2dCIsImtleSIsImNsb3NlIiwidGFyZ2V0IiwiX3BvcHVwIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJvcGVuIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlQ2xpY2tDbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm1FbGVtZXQiLCJpbnB1dFZhbHVlcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaW5wdXQiLCJ2YWx1ZSIsIl9oYW5kbGVTdWJtaXQiLCJyZXNldCIsIlBvcHVwV2l0aEltYWdlIiwidGl0bGUiLCJfc3JjIiwiX3RpdGxlIiwiX3BvcHVwSW1nIiwiX3BvcHVwVGl0bGUiLCJQb3B1cFdpdGhDb25maXJtYXRpb24iLCJoYW5kbGVDb25maXJtIiwiX2hhbmRsZUNvbmZpcm0iLCJfY2FyZEVsIiwiY2FyZEVsIiwiRm9ybVZhbGlkYXRvciIsImNvbmZpZyIsImZvcm1FbCIsIl9mb3JtU2VsZWN0b3IiLCJmb3JtU2VsZWN0b3IiLCJfZm9ybUlucHV0c0ZpZWxkU2V0IiwiZm9ybUlucHV0c0ZpZWxkU2V0IiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ0blNlbGVjdG9yIiwic3VibWl0QnRuU2VsZWN0b3IiLCJfaW5hY3RpdmVCdG5DbGFzcyIsImluYWN0aXZlQnRuQ2xhc3MiLCJfaW5wdXRFcnJDbGFzcyIsImlucHV0RXJyQ2xhc3MiLCJfaW5wdXRFcnJBY3RpdmVDbGFzcyIsImlucHV0RXJyQWN0aXZlQ2xhc3MiLCJfZm9ybUVsIiwiX3Nob3dJbnB1dEVyciIsImlucHV0RWwiLCJlcnJFbCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0IiwiaW5wdXRMc3QiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsIkFycmF5IiwiZnJvbSIsImJ0bkVsIiwiZGlzYWJsZWQiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbGVmb3JtIiwiaW5wdXROYW1lIiwiZWxlbWVudHMiLCJwcm9maWxlTmFtZSIsImlucHV0QWJvdXRNZSIsInByb2ZpbGVBYm91dE1lIiwicGxhY2VGb3JtIiwicGxhY2Vmb3JtIiwicHJvZmlsZUVkaXRCdG4iLCJvcGVOZXdDYXJkUG9wdXBCdG4iLCJpbml0Q2FyZHMiLCJvcHRpb25zIiwiX2NhbGwiLCJjYXJkSWQiLCJfb3B0aW9ucyIsImFjdGlvbiIsIm1ldGhvZCIsImZldGNoIiwiYmFzZVVybCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZWRpdFByb2ZpbGUiLCJhYm91dCIsImNyZWF0ZU5ld0NhcmQiLCJlZGl0UHJvZmlsZUF2YXRhciIsInVybCIsImF2YXRhciIsImluaXQiLCJhbGwiLCJnZXRVc2VyRGF0YSIsImdldEluaXRpYWxDYXJkcyIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVFcnJvciIsImVyciIsImVycm9yRWwiLCJkaXNwbGF5IiwiY2FyZHMiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwic2V0VXNlckF2YXRhciIsImNhcmQiLCJwdXNoIiwiY2FyZExpc3QiLCJyZW5kZXJlciIsImNhdGNoIiwiY29udGFpbmVyU2VsZWN0b3IiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJhcHBlbmQiLCJpdGVtIiwiYWRkR2FsbGVyeUNhcmRJdGVtIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJhdmF0YXJTZWxlY3RvciIsImhhbmRsZUVkaXRBdmF0YXIiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXIiLCJfaGFuZGxlRWRpdEF2YXRhciIsImdldFVzZXJJbmZvIiwicmVuZGVyTG9hZGluZyIsImF2YXRhckltYWdlTGluayIsImZpbmFsbHkiLCJjYXJkRWxlbWVudCIsImhhbmRsZURlbGV0ZSIsIm5ld0NhcmRQb3B1cCIsInBsYWNlSW1hZ2VMaW5rIiwicGxhY2VOYW1lIiwiY29uc29sZSIsImxvZyIsImNvbnN0YW50cyIsIm5ld0NhcmRWYWxpZGF0b3IiLCJpdGVtSWQiLCJwcm9maWxlUG9wdXAiLCJwcm9maWxlVmFsaWRhdG9yIiwiaXNMb2FkaW5nIiwiYnRuU2VsZWN0b3IiXSwic291cmNlUm9vdCI6IiJ9