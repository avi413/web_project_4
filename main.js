!function(){"use strict";class e{constructor(e,t,i,s,r){var n,l;l=()=>{const e=this._element.querySelector(".gallery__like-btn"),t=this._element.querySelector(".gllery__like-count");e.classList.contains("gallery__like-btn_active")?(this._deleteLike(this._element.id),t.textContent--):(this._addLike(this._element.id),t.textContent++),this._element.querySelector(".gallery__like-btn").classList.toggle("gallery__like-btn_active")},(n="_handleLikeBtn")in this?Object.defineProperty(this,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):this[n]=l,this._text=e.name,this._img=e.link,this._id=e._id,this._likes=e.likes,this._Cardowner=e.owner,this._cardSelector=t,this._handleCardClick=i,this._handleTrashClick=s,this._addLike=r.addLike,this._deleteLike=r.deleteLike,this._deleteCard=r.deleteCard}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}generateCard(){this._element=this._getTemplate();const e=this._element.querySelector(".gallery__item-img"),t=this._element.querySelector(".gallery__item-name"),i=document.querySelector(".profile__name").id;return e.src=this._img,e.alt=this._text,t.textContent=this._text,this._element.id=this._id,this._initLike(i),this._deleteIconVisibility(i),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._Cardowner._id&&(this._element.querySelector(".gallery__item-trash-btn").style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._element.querySelector(".gallery__like-btn").classList.add("gallery__like-btn_active");const t=this._element.querySelector(".gllery__like-count");void 0!==this._likes?t.textContent=this._likes.length:t.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._element.querySelector(".gallery__like-btn").addEventListener("click",this._handleLikeBtn),this._element.querySelector(".gallery__item-trash-btn").addEventListener("click",(()=>{this._handleTrashClick(this._id,this._element)})),this._element.querySelector(".gallery__item-img").addEventListener("click",this._handleCardClick)}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{constructor(e){t(this,"_handleEscClose",(e=>{"Escape"===e.key&&document.querySelector(".popup_opened")&&this.close()})),t(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class s extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return this._formElemet.querySelectorAll(".popup__input").forEach((t=>{e[t.name]=[t.value]})),e}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class r extends i{constructor(e,t){let{src:i,title:s}=e;super(t),this._src=i,this._title=s}open(){super.open(),this._popupImg=this._popup.querySelector(".popup__img"),this._popupTitle=this._popup.querySelector(".popup__img-title"),this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title)}}class n extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._popup.id,this._cardEl),this.close()},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e,t){super.open(),this._popup.id=e,this._cardEl=t}close(){super.close(),this._formElemet.reset(),this.removeEventListeners()}}class l{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=document.querySelector(t)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this._hasInvalidInput(e)?(t.classList.add(this._inactiveBtnClass),t.disabled=!0):(t.classList.remove(this._inactiveBtnClass),t.disabled=!1)}_setEventListeners(){const e=Array.from(this._formEl.querySelectorAll(this._inputSelector)),t=this._formEl.querySelector(this._submitBtnSelector);this.toggleButtonState(e,t),e.forEach((i=>{i.addEventListener("input",(()=>{this._checkInputValidity(i),this.toggleButtonState(e,t)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const o={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},a=document.forms.profileform,_=a.elements.profileName,c=a.elements.profileAboutMe,u=document.forms.placeform;function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const h=document.querySelector("button.profile__edit-btn"),d=document.querySelector("button.profile__add-btn"),m=document.querySelector(".profile__name"),v=(document.querySelector(".profile__about-me"),document.querySelector(".profile__avatar"),document.querySelector(".gallery"),new Array),f=new class{constructor(e){p(this,"getInitialCards",(()=>this._call("/cards","GET"))),p(this,"getUserData",(()=>this._call("/users/me","GET"))),p(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),p(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),p(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t[0],about:i[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}editProfileAvatar(e){return this._call("/users/me/avatar ","PATCH",{avatar:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function b(e){const t=document.querySelector(".profile__error");t.textContent=e,t.style.display="block"}f.init().then((e=>{let[t,i]=e;E.setUserInfo(t),E.setUserAvatar({avatar:t.avatar,name:t.name}),i.forEach((e=>{v.push(e)})),y.renderer()})).catch((e=>{b(e)}));const y=new class{constructor(e,t){let{data:i,renderer:s}=e;this._items=i,this._renderer=s,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}renderer(){this._items.forEach((e=>{this._renderer(e)}))}}({data:v,renderer:g},".gallery__list"),E=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i),this._handleEditAvatar=s}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._nameElement.id=e._id,this._jobElement.textContent=e.about,this._setEventListeners()}setUserAvatar(e){let{avatar:t,name:i=null}=e;this._avatar.src=t,i&&(this._avatar.alt=i)}_setEventListeners(){document.querySelector(".profile__edit-avatar").addEventListener("click",this._handleEditAvatar)}}(".profile__name",".profile__about-me",".profile__avatar",(()=>{new s(".popup_type_avatar",S).open()}));function S(e){q(!1,".popup__submit-btn_place_avatar"),f.editProfileAvatar(e.avatarImageLink).finally((()=>{q(!1,".popup__submit-btn_place_avatar")})),E.setUserAvatar({avatar:e.avatarImageLink})}function g(t){const i=new e(t,"#gallery-item-template",(()=>{new r({src:t.link,title:t.name},".popup_type_img").open()}),(()=>{new n(".popup_type_delete",C).open(t._id,i)}),f).generateCard();y.addItem(i)}const L=new s(".popup_type_new-card",(function(e){q(!0,".popup__submit-btn_place_new-card"),g({link:e.placeImageLink,name:e.placeName,owner:{_id:m.id}}),f.createNewCard(e.placeImageLink,e.placeName).then((e=>{console.log(e)})).catch((e=>{b(e)})).finally((()=>{q(!1,".popup__submit-btn_place_new-card")})),u.reset(),L.close(),w.toggleButtonState()}));function C(e,t){f.deleteCard(e).then((()=>{t.remove(),t=null})).catch((e=>{console.log(e)}))}d.addEventListener("click",(()=>L.open()));const k=new s(".popup_type_profile",(function(e){q(!0,".popup__submit-btn_place_profile"),E.setUserInfo({name:e.profileName,about:e.profileAboutMe}),f.editProfile({name:e.profileName,about:e.profileAboutMe}).catch((e=>{console.log(e)})).finally((()=>{q(!1,".popup__submit-btn_place_profile")})),I.toggleButtonState()}));function q(e,t){document.querySelector(t).textContent=e?"...Saving":"Save"}h.addEventListener("click",(()=>{const{name:e,about:t}=E.getUserInfo();_.value=e,c.value=t,k.open()}));const w=new l(o,".popup__form_type_new-card");w.enableValidation(),new l(o,".popup__form_type_avatar").enableValidation();const I=new l(o,".popup__form_type_profile");I.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE9BQU1YLElBQ0xzQyxRQUFRQyxJQUFJdkMsTUF5QmhCakMsRUFBbUJ2RixpQkFBaUIsU0FBUyxJQUFNMkosRUFBYWhKLFNBS2hFLE1BQU13SixFQUFlLElBQUluSixFQUN2Qix1QkFPRixTQUFrQ0ksR0FDaENrSSxHQUFjLEVBQU0sb0NBQ3BCMUIsRUFBU0MsWUFBWSxDQUFDakssS0FBTXdELEVBQU82RCxZQUFhNEIsTUFBT3pGLEVBQU8rRCxpQkFDOURySSxFQUFJOEosWUFBWSxDQUFDaEosS0FBTXdELEVBQU82RCxZQUFhNEIsTUFBT3pGLEVBQU8rRCxpQkFDeERnRCxPQUFRWCxJQUNQc0MsUUFBUUMsSUFBSXZDLE1BRWJnQyxTQUFRLEtBQ1BGLEdBQWMsRUFBTyx1Q0FFdkJjLEVBQWlCOUYsdUJBZ0JuQixTQUFTZ0YsRUFBY2UsRUFBV0MsR0FDbEIxTCxTQUFTMUIsY0FBY29OLEdBRTdCOU0sWUFETDZNLEVBQ21CLFlBR0EsT0FoQnhCL0UsRUFBZXRGLGlCQUFpQixTQUFTLEtBQ3ZDLE1BQU0sS0FBQ3BDLEVBQUQsTUFBT2lKLEdBQVVlLEVBQVN5QixjQUNoQ1csRUFBQUEsTUFBNkJwTSxFQUM3Qm9NLEVBQUFBLE1BQWdDbkQsRUFDaENzRCxFQUFheEosVUFtQmYsTUFBTXNKLEVBQW1CLElBQUl2SCxFQUFjc0gsRUFBaUIsOEJBQzVEQyxFQUFpQnRGLG1CQUVXLElBQUlqQyxFQUFjc0gsRUFBaUIsNEJBQzNDckYsbUJBRXBCLE1BQU15RixFQUFtQixJQUFJMUgsRUFBY3NILEVBQWlCLDZCQUM1REksRUFBaUJ6RixtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3IoIGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVUcmFzaENsaWNrLCBhcGkpIHtcclxuICAgICAgdGhpcy5fdGV4dCAgICAgICAgICAgICAgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHRoaXMuX2ltZyAgICAgICAgICAgICAgPSBkYXRhLmxpbms7XHJcbiAgICAgIHRoaXMuX2lkICAgICAgICAgICAgICAgID0gZGF0YS5faWQ7XHJcbiAgICAgIHRoaXMuX2xpa2VzICAgICAgICAgICAgID0gZGF0YS5saWtlcztcclxuICAgICAgdGhpcy5fQ2FyZG93bmVyICAgICAgICAgPSBkYXRhLm93bmVyO1xyXG4gICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgICAgICA9IGNhcmRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrICAgPSBoYW5kbGVDYXJkQ2xpY2s7XHJcbiAgICAgIHRoaXMuX2hhbmRsZVRyYXNoQ2xpY2sgID0gaGFuZGxlVHJhc2hDbGljaztcclxuICAgICAgdGhpcy5fYWRkTGlrZSAgICAgICAgICAgPSBhcGkuYWRkTGlrZTtcclxuICAgICAgdGhpcy5fZGVsZXRlTGlrZSAgICAgICAgPSBhcGkuZGVsZXRlTGlrZTtcclxuICAgICAgdGhpcy5fZGVsZXRlQ2FyZCAgICAgICAgPSBhcGkuZGVsZXRlQ2FyZDtcclxuICAgIH1cclxuICBcclxuICAgIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgICAuY29udGVudFxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW1cIilcclxuICAgICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gIFxyXG4gICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xyXG4gICAgICBjb25zdCBnYWxsZXJ5SXRlbUltZyA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLWltZ1wiKTtcclxuICAgICAgY29uc3QgZ2FsbGVyeUl0ZW1OYW1lID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0tbmFtZVwiKTtcclxuICAgICAgY29uc3QgbXlJZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKS5pZDtcclxuXHJcbiAgICAgIGdhbGxlcnlJdGVtSW1nLnNyYyA9IHRoaXMuX2ltZztcclxuICAgICAgZ2FsbGVyeUl0ZW1JbWcuYWx0ID0gdGhpcy5fdGV4dDtcclxuICAgICAgZ2FsbGVyeUl0ZW1OYW1lLnRleHRDb250ZW50ID0gdGhpcy5fdGV4dDtcclxuIFxyXG4gICAgICB0aGlzLl9lbGVtZW50LmlkID0gdGhpcy5faWQ7XHJcbiAgICAgIHRoaXMuX2luaXRMaWtlKG15SWQpO1xyXG4gICAgICB0aGlzLiBfZGVsZXRlSWNvblZpc2liaWxpdHkobXlJZCk7XHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2RlbGV0ZUljb25WaXNpYmlsaXR5KHVzZXJJZCl7XHJcbiAgICAgIGlmKHVzZXJJZCAhPSAgdGhpcy5fQ2FyZG93bmVyLl9pZCkge1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLXRyYXNoLWJ0blwiKS5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9pbml0TGlrZSh1c2VySWQpe1xyXG4gICAgICBpZih0aGlzLl91c2VyRXhpc3RzKHVzZXJJZCkpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIikuY2xhc3NMaXN0LmFkZCgnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJyk7IFxyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGdhbGxlcnlsaWtlQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2xsZXJ5X19saWtlLWNvdW50XCIpO1xyXG4gICAgICBpZih0eXBlb2YgdGhpcy5fbGlrZXMgIT09IFwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCAgPSAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3VzZXJFeGlzdHMoaWQpIHtcclxuICAgICAgaWYodHlwZW9mIHRoaXMuX2xpa2VzICE9PSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZShmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICByZXR1cm4gdXNlci5faWQgPT09IGlkO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcblxyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICB0aGlzLl9oYW5kbGVMaWtlQnRuKTtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0tdHJhc2gtYnRuXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCgpID0+e3RoaXMuX2hhbmRsZVRyYXNoQ2xpY2sodGhpcy5faWQsIHRoaXMuX2VsZW1lbnQpfSk7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLWltZ1wiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlQ2FyZENsaWNrKTtcclxuICAgIH1cclxuICBcclxuICAgIF9oYW5kbGVMaWtlQnRuID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBsaWtlQnRuID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2UtYnRuXCIpO1xyXG4gICAgICBjb25zdCBnYWxsZXJ5bGlrZUNvdW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdsbGVyeV9fbGlrZS1jb3VudFwiKTtcclxuICAgICAgaWYobGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpKXtcclxuICAgICAgICB0aGlzLl9kZWxldGVMaWtlKHRoaXMuX2VsZW1lbnQuaWQpO1xyXG4gICAgICAgIGdhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgLS07XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fYWRkTGlrZSh0aGlzLl9lbGVtZW50LmlkKTtcclxuICAgICAgICBnYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ICsrO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlLWJ0blwiKS5jbGFzc0xpc3QudG9nZ2xlKCdnYWxsZXJ5X19saWtlLWJ0bl9hY3RpdmUnKTtcclxuXHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgIH1cclxuICAgICAgIC8qXHJcbiAgICBfaGFuZGxlRGVsZXRlR2FsbGVyeUNhcmRJdGVtID0gKCkgPT4ge1xyXG4gICAgIFxyXG5cclxuICAgICAgdGhpcy5fZGVsZXRlQ2FyZCh0aGlzLl9lbGVtZW50LmlkKVxyXG4gICAgICAudGhlbigoKSA9PntcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBhbGVydChlcnIpO1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgX2hhbmRsZURlbGV0ZSA9ICgpID0+IHtcclxuICAgICAgdGhpcy5fZGVsZXRlQ2FyZCh0aGlzLl9lbGVtZW50LmlkKVxyXG4gICAgICAudGhlbigoKSA9PntcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBhbGVydChlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgICAgICovXHJcbiAgfSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciApIHtcclxuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIC8qKiBwb3B1cHMgY2xvc2UgY2xpY2sgcmVtb3ZlIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKCkge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgLyoqIHBvcHVwcyBvcGVuIGV2ZW50cyAqL1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PntcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgICAgICBpZihwb3B1cCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsICB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVDbGlja0Nsb3NlUG9wdXAgPSAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKSB8fFxyXG4gICAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZVwiKSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCApIHtcclxuICAgICAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgID0gICBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0ICAgICAgICA9ICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXRzQXJyID0gdGhpcy5fZm9ybUVsZW1ldC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcclxuICAgICAgICAgICAgaW5wdXRzQXJyLmZvckVhY2goaW5wdXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBbaW5wdXQudmFsdWVdO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogVGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgbWV0aG9kIG9mIHRoZSBQb3B1cFdpdGhGb3JtIGNsYXNzXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIF9oYW5kbGVTdWJtaXQgPShldnQpID0+e1xyXG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9ICB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KGlucHV0cyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgY2xvc2UoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgY2xvc2UoKSBwYXJlbnQgbWV0aG9kIFxyXG4gICAgICAgICAgICAgKiBpbiBvcmRlciB0byByZXNldCB0aGUgZm9ybSBvbmNlIHRoZSBwb3B1cCBpcyBjbG9zZWQuXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcblxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwe1xyXG4gICAgY29uc3RydWN0b3IgKCB7c3JjICx0aXRsZSB9ICxwb3B1cFNlbGVjdG9yICkge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX3NyYyAgID0gc3JjO1xyXG4gICAgICAgIHRoaXMuX3RpdGxlID0gdGl0bGU7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWdcIik7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltZy10aXRsZVwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcuc3JjID0gIHRoaXMuX3NyYztcclxuICAgICAgICB0aGlzLl9wb3B1cEltZy5hbHQgPSAgdGhpcy5fdGl0bGU7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZS50ZXh0Q29udGVudCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm1hdGlvbiAgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IgKCBwb3B1cFNlbGVjdG9yLCBoYW5kbGVDb25maXJtICkge1xyXG4gICAgICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlQ29uZmlybSAgICAgPSAgIGhhbmRsZUNvbmZpcm07XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQgICAgICAgID0gICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSXQgbW9kaWZpZXMgdGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgcGFyZW50IG1ldGhvZC4gXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAgdGhpcy5faGFuZGxlU3VibWl0KTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZW1vdmVFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBfaGFuZGxlU3VibWl0ID0oZXZ0KSA9PntcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDb25maXJtKHRoaXMuX3BvcHVwLmlkLCB0aGlzLl9jYXJkRWwpO1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvcGVuKGlkLCBjYXJkRWwpIHtcclxuICAgICAgICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cC5pZCA9aWQ7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhcmRFbCA9IGNhcmRFbFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2xvc2UoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgY2xvc2UoKSBwYXJlbnQgbWV0aG9kIFxyXG4gICAgICAgICAgICAgKiBpbiBvcmRlciB0byByZXNldCB0aGUgZm9ybSBvbmNlIHRoZSBwb3B1cCBpcyBjbG9zZWQuXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcblxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvciggY29uZmlnLCBmb3JtRWwgKXtcclxuICAgICAgdGhpcy5fZm9ybVNlbGVjdG9yICAgICAgICAgPSBjb25maWcuZm9ybVNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9mb3JtSW5wdXRzRmllbGRTZXQgICA9IGNvbmZpZy5mb3JtSW5wdXRzRmllbGRTZXQ7XHJcbiAgICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgICAgICAgID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0blNlbGVjdG9yICAgID0gY29uZmlnLnN1Ym1pdEJ0blNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzICAgICA9IGNvbmZpZy5pbmFjdGl2ZUJ0bkNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckNsYXNzICAgICAgICA9IGNvbmZpZy5pbnB1dEVyckNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzICA9IGNvbmZpZy5pbnB1dEVyckFjdGl2ZUNsYXNzO1xyXG4gICAgICB0aGlzLl9mb3JtRWwgICAgICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybUVsKTtcclxuICAgIH1cclxuXHJcbiAgICBfc2hvd0lucHV0RXJyIChpbnB1dEVsKSB7XHJcbiAgICAgIGNvbnN0IGVyckVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcbiAgICAgIFxyXG4gICAgICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJDbGFzcyk7XHJcbiAgICAgIGVyckVsLnRleHRDb250ZW50ID0gaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgICAgZXJyRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGlkZUlucHV0RXJyb3IgKGlucHV0RWwpIHtcclxuICAgICAgY29uc3QgZXJyRWwgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuXHJcbiAgICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVyckNsYXNzKTtcclxuICAgICAgZXJyRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzKTtcclxuICAgICAgZXJyRWwudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkgKGlucHV0RWwpIHtcclxuICAgICAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyKGlucHV0RWwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2hhc0ludmFsaWRJbnB1dCAoaW5wdXRMc3QpIHtcclxuICAgICAgcmV0dXJuIGlucHV0THN0LnNvbWUoKGlucHV0RWwpID0+ICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVCdXR0b25TdGF0ZSAoKSB7XHJcbiAgICAgIGNvbnN0IGlucHV0THN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSk7XHJcbiAgICAgIGNvbnN0IGJ0bkVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnRuU2VsZWN0b3IpO1xyXG4gICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0THN0KSkge1xyXG4gICAgICAgIGJ0bkVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdG5DbGFzcyk7XHJcbiAgICAgICAgYnRuRWwuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGJ0bkVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdG5DbGFzcyk7XHJcbiAgICAgICAgYnRuRWwuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICAgIGNvbnN0IGlucHV0THN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSk7XHJcbiAgICAgIGNvbnN0IGJ0bkVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnRuU2VsZWN0b3IpO1xyXG4gICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0THN0LCBidG5FbCk7XHJcbiAgICAgIGlucHV0THN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7ICAgXHJcbiAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0THN0LCBidG5FbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVuYWJsZVZhbGlkYXRpb24gKCkge1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICB0aGlzLl9mb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiBldnQucHJldmVudERlZmF1bHQoKSk7XHJcbiAgICB9XHJcblxyXG4gIH0iLCJleHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gICAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxyXG4gICAgZm9ybUlucHV0c0ZpZWxkU2V0OiBcIi5wb3B1cF9fZm9ybS1zZXRcIixcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnRuU2VsZWN0b3I6IFwiLnBvcHVwX19zdWJtaXQtYnRuXCIsXHJcbiAgICBpbmFjdGl2ZUJ0bkNsYXNzOiBcImJ1dHRvbl9pbmFjdGl2ZVwiLFxyXG4gICAgaW5wdXRFcnJDbGFzczogXCJwb3B1cF9faW5wdXQtdGV4dF90eXBlX2Vycm9yXCIsXHJcbiAgICBpbnB1dEVyckFjdGl2ZUNsYXNzOiBcInBvcHVwX19pbnB1dC10ZXh0LWVycm9yX2FjdGl2ZVwiXHJcbiAgfVxyXG5cclxuXHJcbi8qKiBwcm9maWxlIHBvcHVwIGVsZW1lbnRzICovXHJcbmNvbnN0IHByb2ZpbGVGb3JtICAgICAgICAgICAgICAgICAgPSBkb2N1bWVudC5mb3Jtcy5wcm9maWxlZm9ybTtcclxuZXhwb3J0IGNvbnN0IGlucHV0TmFtZSAgICAgICAgICAgICA9IHByb2ZpbGVGb3JtLmVsZW1lbnRzLnByb2ZpbGVOYW1lO1xyXG5leHBvcnQgY29uc3QgaW5wdXRBYm91dE1lICAgICAgICAgID0gcHJvZmlsZUZvcm0uZWxlbWVudHMucHJvZmlsZUFib3V0TWU7XHJcbmV4cG9ydCBjb25zdCBwbGFjZUZvcm0gICAgICAgICAgICAgPSBkb2N1bWVudC5mb3Jtcy5wbGFjZWZvcm07XHJcblxyXG5leHBvcnQgY29uc3QgZ2FsbGVyeUxpc3RTZWxlY3RvciAgPSBcIi5nYWxsZXJ5X19saXN0XCI7XHJcblxyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSAgXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCJcclxuLyoqIG1haW4gYnV0dG9ucyAqL1xyXG5jb25zdCBwcm9maWxlRWRpdEJ0biAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBvcGVOZXdDYXJkUG9wdXBCdG4gICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnByb2ZpbGVfX2FkZC1idG5cIik7XHJcblxyXG4vKiogcHJvZmlsZSBkYXRhIGVsZW1lbnRzICovXHJcbmNvbnN0IHByb2ZpbGVOYW1lICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZUFib3V0TWUgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hYm91dC1tZVwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhciAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbi8qKiBnYWxsZXJ5IGNvbnRhaW5lciAqL1xyXG5jb25zdCBjb250YWluZXIgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlcIik7XHJcblxyXG5cclxuY29uc3QgaW5pdENhcmRzID0gbmV3IEFycmF5KCk7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjliNjIxZjBmLTVkZmUtNDNmMS05NWZkLWU5Y2MxODhiY2MzNVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIGluaXRpYWFsIHVzZXIgaW5mbyBhbmQgZ2FsbGVyeSBDYXJkcyBmcm9tXHJcbiAqL1xyXG5hcGkuaW5pdCgpXHJcbi50aGVuKChbdXNlcixjYXJkc10pID0+IHtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyKTtcclxuICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHthdmF0YXI6IHVzZXIuYXZhdGFyLG5hbWU6IHVzZXIubmFtZX0pO1xyXG4gIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtpbml0Q2FyZHMucHVzaChjYXJkKTt9KVxyXG4gIGNhcmRMaXN0LnJlbmRlcmVyKCk7XHJcbn0pXHJcbi5jYXRjaCAoKGVycikgPT4ge1xyXG4gIGhhbmRsZUVycm9yKGVycik7XHJcbn0pXHJcblxyXG4vKipcclxuICogc2V0IEVycm9yIGRlc2NyaXB0aW9uIG9uIHRvcCBvZiB0aGUgcGFnZVxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyKSB7XHJcbiAgY29uc3QgZXJyb3JFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZXJyb3JcIik7XHJcbiAgZXJyb3JFbC50ZXh0Q29udGVudCA9IGVycjtcclxuICBlcnJvckVsLnN0eWxlLmRpc3BsYXkgID0gXCJibG9ja1wiO1xyXG59XHJcblxyXG5jb25zdCBjYXJkTGlzdCAgPSBuZXcgU2VjdGlvbih7ZGF0YTogaW5pdENhcmRzLCByZW5kZXJlcjogYWRkR2FsbGVyeUNhcmRJdGVtfSwgY29uc3RhbnRzLmdhbGxlcnlMaXN0U2VsZWN0b3IpO1xyXG5jb25zdCB1c2VySW5mbyAgPSBuZXcgVXNlckluZm8oXCIucHJvZmlsZV9fbmFtZVwiLCBcIi5wcm9maWxlX19hYm91dC1tZVwiLCBcIi5wcm9maWxlX19hdmF0YXJcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IEVkaXRBdmF0YXJQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfYXZhdGFyXCIsIGhhbmRsZUVkaXRBdmF0YXIpO1xyXG4gIEVkaXRBdmF0YXJQb3B1cC5vcGVuKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIGhhbmRsZSBlZGl0IHBvZmlsZSBhdmF0YXIgaW1hZ2VcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZUVkaXRBdmF0YXIgKGlucHV0cykge1xyXG4gIHJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX2F2YXRhclwiKTtcclxuICBhcGkuZWRpdFByb2ZpbGVBdmF0YXIoaW5wdXRzLmF2YXRhckltYWdlTGluaylcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX2F2YXRhclwiKTtcclxuICB9KVxyXG4gIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoe2F2YXRhcjogaW5wdXRzLmF2YXRhckltYWdlTGlua30pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgbmV3IGNhcmQgaXRlbSB0byBnYWxsZXJ5XHJcbiAqL1xyXG5mdW5jdGlvbiAgYWRkR2FsbGVyeUNhcmRJdGVtIChpdGVtKSB7XHJcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGl0ZW0sIFxyXG4gICAgXCIjZ2FsbGVyeS1pdGVtLXRlbXBsYXRlXCIsXHJcbiAgICAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKHtzcmMgOiBpdGVtLmxpbmsgLCB0aXRsZTogaXRlbS5uYW1lfSwgXCIucG9wdXBfdHlwZV9pbWdcIik7XHJcbiAgICAgIHBvcHVwLm9wZW4oKTtcclxuICAgIH0sXHJcbiAgICAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBvcHVwQ29uZmlybSA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXCIucG9wdXBfdHlwZV9kZWxldGVcIiwgaGFuZGxlRGVsZXRlKTtcclxuICAgICAgcG9wdXBDb25maXJtLm9wZW4oaXRlbS5faWQsIGNhcmRFbGVtZW50KTtcclxuICAgIH0sYXBpKTtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgY2FyZExpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgcG9wdXAgd2l0aCBmb3JtIHRvIGFkZCBuZXcgY2FyZCBpdGVtIHRvIGdhbGxlcnlcclxuICovXHJcbmNvbnN0IG5ld0NhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtIChcclxuICBcIi5wb3B1cF90eXBlX25ldy1jYXJkXCIsXHJcbiAgaGFuZGxlQ3JlYXRlTmV3Q2FyZFxyXG4pO1xyXG5cclxuLyoqXHJcbiAqIGRlbGV0ZSBjYXJkIGl0ZW0gZnJvbSBnYWxsZXJ5XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGUoaXRlbUlkLCBjYXJkKSB7XHJcbiAgYXBpLmRlbGV0ZUNhcmQoaXRlbUlkKVxyXG4gIC50aGVuKCgpID0+e1xyXG4gICAgY2FyZC5yZW1vdmUoKTtcclxuICAgIGNhcmQgPSBudWxsO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgbmV3IGNhcmQgaXRlbSB0byBnYWxsZXJ5XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVDcmVhdGVOZXdDYXJkIChpbnB1dHMpIHtcclxuICByZW5kZXJMb2FkaW5nKHRydWUsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX25ldy1jYXJkXCIpO1xyXG4gIGFkZEdhbGxlcnlDYXJkSXRlbSh7bGluazogaW5wdXRzLnBsYWNlSW1hZ2VMaW5rLCBuYW1lOiBpbnB1dHMucGxhY2VOYW1lLCBvd25lcjoge19pZDogcHJvZmlsZU5hbWUuaWR9fSk7XHJcbiAgYXBpLmNyZWF0ZU5ld0NhcmQoaW5wdXRzLnBsYWNlSW1hZ2VMaW5rLGlucHV0cy5wbGFjZU5hbWUpXHJcbiAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhKVxyXG4gIH0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBoYW5kbGVFcnJvcihlcnIpO1xyXG4gIH0pXHJcbiAgLmZpbmFsbHkoKCkgPT57XHJcbiAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9uZXctY2FyZFwiKTtcclxuICB9KVxyXG4gIGNvbnN0YW50cy5wbGFjZUZvcm0ucmVzZXQoKTtcclxuICBuZXdDYXJkUG9wdXAuY2xvc2UoKTtcclxuICBuZXdDYXJkVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbn1cclxuXHJcbm9wZU5ld0NhcmRQb3B1cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gbmV3Q2FyZFBvcHVwLm9wZW4oKSk7XHJcblxyXG4vKipcclxuICogYWRkIHBvcHVwIHdpdGggZm9ybSB0byBlZGl0IG1haW4gdXNlciBpbmZvXHJcbiAqL1xyXG5jb25zdCBwcm9maWxlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSAoXHJcbiAgXCIucG9wdXBfdHlwZV9wcm9maWxlXCIsXHJcbiAgIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0XHJcbik7XHJcblxyXG4vKipcclxuICogZWRpdCB1c2VyIHByb2ZpbGUgZGF0YVxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQgKGlucHV0cykge1xyXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfcHJvZmlsZVwiKTtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyh7bmFtZTogaW5wdXRzLnByb2ZpbGVOYW1lLCBhYm91dDogaW5wdXRzLnByb2ZpbGVBYm91dE1lfSlcclxuICBhcGkuZWRpdFByb2ZpbGUoe25hbWU6IGlucHV0cy5wcm9maWxlTmFtZSwgYWJvdXQ6IGlucHV0cy5wcm9maWxlQWJvdXRNZX0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcbiAgLmZpbmFsbHkoKCkgPT57XHJcbiAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG4gIH0pXHJcbiAgcHJvZmlsZVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG59XHJcblxyXG4vKipcclxuICogYWRkIGV2ZW50IGxpc3RlbmVyIHRvIGVkaXQgdXNlciBwcm9maWxlIGluZm9cclxuICovXHJcbnByb2ZpbGVFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3Qge25hbWUsIGFib3V0IH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIGNvbnN0YW50cy5pbnB1dE5hbWUudmFsdWUgID0gbmFtZTtcclxuICBjb25zdGFudHMuaW5wdXRBYm91dE1lLnZhbHVlICA9IGFib3V0O1xyXG4gIHByb2ZpbGVQb3B1cC5vcGVuKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIGNoYW5nZSBidXR0b24gdGV4dCB0byAuLnNhdmluZyB1bnRpbCBwcm9jZXNzIGVuZHNcclxuICovXHJcbmZ1bmN0aW9uIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nLCBidG5TZWxlY3Rvcikge1xyXG4gIGNvbnN0IGJ0bkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihidG5TZWxlY3Rvcik7XHJcbiAgaWYoaXNMb2FkaW5nKSB7XHJcbiAgICBidG5FbC50ZXh0Q29udGVudCA9IFwiLi4uU2F2aW5nXCI7IFxyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCJTYXZlXCI7IFxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZCBmb3JtIHZhbGlkYXRpb24gZm9yIGFsbCBmb3Jtc1xyXG4gKi9cclxuY29uc3QgbmV3Q2FyZFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbnN0YW50cy5jb25maWcsXCIucG9wdXBfX2Zvcm1fdHlwZV9uZXctY2FyZFwiKTtcclxubmV3Q2FyZFZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5jb25zdCBlZGl0QXZhdGFyVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLmNvbmZpZyxcIi5wb3B1cF9fZm9ybV90eXBlX2F2YXRhclwiKTtcclxuZWRpdEF2YXRhclZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5jb25zdCBwcm9maWxlVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLmNvbmZpZyxcIi5wb3B1cF9fZm9ybV90eXBlX3Byb2ZpbGVcIik7XHJcbnByb2ZpbGVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgfVxyXG4gIFxyXG4gICAgX2NhbGwoYWN0aW9uLCBtZXRob2QsIGRhdGEpIHtcclxuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCArIGFjdGlvbiwge1xyXG4gICAgICAgIG1ldGhvZDogbWV0aG9kLFxyXG4gICAgICAgIGhlYWRlcnM6ICB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYocmVzLm9rKSB7XHJcbiAgICAgICAgICByZXR1cm4gIHJlcy5qc29uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRJbml0aWFsQ2FyZHMgPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL2NhcmRzXCIsJ0dFVCcpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZ2V0VXNlckRhdGEgPSAoKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lXCIsJ0dFVCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBlZGl0UHJvZmlsZSh7bmFtZSwgYWJvdXR9KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lXCIsJ1BBVENIJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBhYm91dDogYWJvdXRbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTmV3Q2FyZCAobGluaywgbmFtZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdQT1NUJyx7XHJcbiAgICAgICAgbmFtZTogbmFtZVswXSxcclxuICAgICAgICBsaW5rOiBsaW5rWzBdXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZExpa2UgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwnUFVUJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdERUxFVEUnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVDYXJkID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRQcm9maWxlQXZhdGFyKHVybCl7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKFwiL3VzZXJzL21lL2F2YXRhciBcIiwnUEFUQ0gnLHtcclxuICAgICAgICBhdmF0YXIgOiB1cmxbMF1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJEYXRhKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIFxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKCB7IGRhdGEsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zICAgICAgID0gZGF0YSxcclxuICAgICAgICB0aGlzLl9yZW5kZXJlciAgICA9IHJlbmRlcmVyO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLmFwcGVuZChlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHJlbmRlcmVyKCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIFVzZXJJbmZvIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciByZW5kZXJpbmcgXHJcbiAgICAgKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXNlciBvbiB0aGUgcGFnZS4gVGhpcyBjbGFzcyBzaG91bGQ6XHJcbiAgICAgKiAtVGFrZSBhbiBvYmplY3Qgd2l0aCB0aGUgc2VsZWN0b3JzIG9mIHR3byBlbGVtZW50cyBpbnRvIHRoZSBjb25zdHJ1Y3RvcjogXHJcbiAgICAgKiBvbmUgY29udGFpbmluZyB0aGUgdXNlcidzIG5hbWUsIGFuZCBhbm90aGVyIGNvbnRhaW5pbmcgdGhlIHVzZXIncyBqb2IuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yICggbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgPSBudWxsLCBoYW5kbGVFZGl0QXZhdGFyKSB7XHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUVkaXRBdmF0YXIgPSBoYW5kbGVFZGl0QXZhdGFyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJJbmZvKCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHJldHVybnMgYW4gb2JqZWN0IHdpdGggaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIuIFxyXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgaGFuZHkgZm9yIFxyXG4gICAgICAgICAqIGNhc2VzIHdoZW4gaXQncyBuZWNlc3NhcnkgdG8gZGlzcGxheSB0aGUgdXNlciBkYXRhIGluIHRoZSBvcGVuIGZvcm0uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgICAgICAgIGFib3V0OiB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFVzZXJJbmZvKGRhdGEpe1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHRha2VzIG5ldyB1c2VyIGRhdGEgYW5kIGFkZHMgaXQgb24gdGhlIHBhZ2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgICA9IGRhdGEubmFtZTtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC5pZCAgICAgICAgICAgID0gZGF0YS5faWQ7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudCAgICA9IGRhdGEuYWJvdXQ7XHJcbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICB9XHJcbiAgICBzZXRVc2VyQXZhdGFyKHthdmF0YXIsIG5hbWUgPSBudWxsfSkge1xyXG4gICAgICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgICAgICAgaWYobmFtZSl7XHJcbiAgICAgICAgICAgIHRoaXMuX2F2YXRhci5hbHQgPSBuYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWF2YXRhclwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgIHRoaXMuX2hhbmRsZUVkaXRBdmF0YXIpO1xyXG4gICAgICB9XHJcbn0iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZVRyYXNoQ2xpY2siLCJhcGkiLCJsaWtlQnRuIiwidGhpcyIsIl9lbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImdhbGxlcnlsaWtlQ291bnQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsIl9kZWxldGVMaWtlIiwiaWQiLCJ0ZXh0Q29udGVudCIsIl9hZGRMaWtlIiwidG9nZ2xlIiwiX3RleHQiLCJuYW1lIiwiX2ltZyIsImxpbmsiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9DYXJkb3duZXIiLCJvd25lciIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZVRyYXNoQ2xpY2siLCJhZGRMaWtlIiwiZGVsZXRlTGlrZSIsIl9kZWxldGVDYXJkIiwiZGVsZXRlQ2FyZCIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImdlbmVyYXRlQ2FyZCIsImdhbGxlcnlJdGVtSW1nIiwiZ2FsbGVyeUl0ZW1OYW1lIiwibXlJZCIsInNyYyIsImFsdCIsIl9pbml0TGlrZSIsIl9kZWxldGVJY29uVmlzaWJpbGl0eSIsIl9zZXRFdmVudExpc3RlbmVycyIsInVzZXJJZCIsInN0eWxlIiwidmlzaWJpbGl0eSIsIl91c2VyRXhpc3RzIiwiYWRkIiwibGVuZ3RoIiwic29tZSIsInVzZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2VCdG4iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJldnQiLCJrZXkiLCJjbG9zZSIsInRhcmdldCIsIl9wb3B1cCIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXJzIiwib3BlbiIsInNldEV2ZW50TGlzdGVuZXJzIiwiX2hhbmRsZUVzY0Nsb3NlIiwiX2hhbmRsZUNsaWNrQ2xvc2VQb3B1cCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwicHJldmVudERlZmF1bHQiLCJpbnB1dHMiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9mb3JtRWxlbWV0IiwiaW5wdXRWYWx1ZXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0IiwidmFsdWUiLCJfaGFuZGxlU3VibWl0IiwicmVzZXQiLCJQb3B1cFdpdGhJbWFnZSIsInRpdGxlIiwiX3NyYyIsIl90aXRsZSIsIl9wb3B1cEltZyIsIl9wb3B1cFRpdGxlIiwiUG9wdXBXaXRoQ29uZmlybWF0aW9uIiwiaGFuZGxlQ29uZmlybSIsIl9oYW5kbGVDb25maXJtIiwiX2NhcmRFbCIsImNhcmRFbCIsIkZvcm1WYWxpZGF0b3IiLCJjb25maWciLCJmb3JtRWwiLCJfZm9ybVNlbGVjdG9yIiwiZm9ybVNlbGVjdG9yIiwiX2Zvcm1JbnB1dHNGaWVsZFNldCIsImZvcm1JbnB1dHNGaWVsZFNldCIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdG5TZWxlY3RvciIsInN1Ym1pdEJ0blNlbGVjdG9yIiwiX2luYWN0aXZlQnRuQ2xhc3MiLCJpbmFjdGl2ZUJ0bkNsYXNzIiwiX2lucHV0RXJyQ2xhc3MiLCJpbnB1dEVyckNsYXNzIiwiX2lucHV0RXJyQWN0aXZlQ2xhc3MiLCJpbnB1dEVyckFjdGl2ZUNsYXNzIiwiX2Zvcm1FbCIsIl9zaG93SW5wdXRFcnIiLCJpbnB1dEVsIiwiZXJyRWwiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0THN0IiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJBcnJheSIsImZyb20iLCJidG5FbCIsImRpc2FibGVkIiwiZW5hYmxlVmFsaWRhdGlvbiIsInByb2ZpbGVGb3JtIiwiZm9ybXMiLCJwcm9maWxlZm9ybSIsImlucHV0TmFtZSIsImVsZW1lbnRzIiwicHJvZmlsZU5hbWUiLCJpbnB1dEFib3V0TWUiLCJwcm9maWxlQWJvdXRNZSIsInBsYWNlRm9ybSIsInBsYWNlZm9ybSIsInByb2ZpbGVFZGl0QnRuIiwib3BlTmV3Q2FyZFBvcHVwQnRuIiwiaW5pdENhcmRzIiwib3B0aW9ucyIsIl9jYWxsIiwiY2FyZElkIiwiX29wdGlvbnMiLCJhY3Rpb24iLCJtZXRob2QiLCJmZXRjaCIsImJhc2VVcmwiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImVkaXRQcm9maWxlIiwiYWJvdXQiLCJjcmVhdGVOZXdDYXJkIiwiZWRpdFByb2ZpbGVBdmF0YXIiLCJ1cmwiLCJhdmF0YXIiLCJpbml0IiwiYWxsIiwiZ2V0VXNlckRhdGEiLCJnZXRJbml0aWFsQ2FyZHMiLCJhdXRob3JpemF0aW9uIiwiaGFuZGxlRXJyb3IiLCJlcnIiLCJlcnJvckVsIiwiZGlzcGxheSIsImNhcmRzIiwidXNlckluZm8iLCJzZXRVc2VySW5mbyIsInNldFVzZXJBdmF0YXIiLCJjYXJkIiwicHVzaCIsImNhcmRMaXN0IiwicmVuZGVyZXIiLCJjYXRjaCIsImNvbnRhaW5lclNlbGVjdG9yIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwiYXBwZW5kIiwiaXRlbSIsImFkZEdhbGxlcnlDYXJkSXRlbSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJoYW5kbGVFZGl0QXZhdGFyIiwiX25hbWVFbGVtZW50IiwiX2pvYkVsZW1lbnQiLCJfYXZhdGFyIiwiX2hhbmRsZUVkaXRBdmF0YXIiLCJnZXRVc2VySW5mbyIsInJlbmRlckxvYWRpbmciLCJhdmF0YXJJbWFnZUxpbmsiLCJmaW5hbGx5IiwiY2FyZEVsZW1lbnQiLCJoYW5kbGVEZWxldGUiLCJuZXdDYXJkUG9wdXAiLCJwbGFjZUltYWdlTGluayIsInBsYWNlTmFtZSIsImNvbnNvbGUiLCJsb2ciLCJjb25zdGFudHMiLCJuZXdDYXJkVmFsaWRhdG9yIiwiaXRlbUlkIiwicHJvZmlsZVBvcHVwIiwicHJvZmlsZVZhbGlkYXRvciIsImlzTG9hZGluZyIsImJ0blNlbGVjdG9yIl0sInNvdXJjZVJvb3QiOiIifQ==