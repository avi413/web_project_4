!function(){"use strict";class e{constructor(e,t,i,s,n,r){this._text=e.name,this._img=e.link,this._id=e._id,this._likes=e.likes,this._Cardowner=e.owner,this._cardSelector=t,this._handleCardClick=i,this._handleTrashClick=s,this._addLike=r.addLike,this._deleteLike=r.deleteLike,this._deleteCard=r.deleteCard,this._handleLike=n,this._element=document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0),this._itemImgEl=this._element.querySelector(".gallery__item-img"),this._itemNameEl=this._element.querySelector(".gallery__item-name"),this.profileEl=document.querySelector(".profile__name"),this._itemTrashBtn=this._element.querySelector(".gallery__item-trash-btn"),this._itemLikeBtn=this._element.querySelector(".gallery__like-btn"),this._gallerylikeCount=this._element.querySelector(".gllery__like-count")}getId(){return this._id}generateCard(){return this._itemImgEl.src=this._img,this._itemNameEl.alt=this._text,this._itemNameEl.textContent=this._text,this._element.id=this._id,this._initLike(this.profileEl.id),this._deleteIconVisibility(this.profileEl.id),this._setEventListeners(),this._element}_deleteIconVisibility(e){e!=this._Cardowner._id&&(this._itemTrashBtn.style.visibility="hidden")}_initLike(e){this._userExists(e)&&this._itemLikeBtn.classList.add("gallery__like-btn_active"),void 0!==this._likes?this._gallerylikeCount.textContent=this._likes.length:this._gallerylikeCount.textContent=0}_userExists(e){return void 0!==this._likes&&this._likes.some((function(t){return t._id===e}))}_setEventListeners(){this._itemLikeBtn.addEventListener("click",(()=>{this._handleLike(this)})),this._itemTrashBtn.addEventListener("click",(()=>{this._handleTrashClick(this)})),this._itemImgEl.addEventListener("click",this._handleCardClick)}updateLikes(){return this._itemLikeBtn.classList.contains("gallery__like-btn_active")?this._deleteLike(this._element.id):this._addLike(this._element.id)}setLikes(e){this._gallerylikeCount.textContent=e.likes.length,this._itemLikeBtn.classList.toggle("gallery__like-btn_active")}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{constructor(e){t(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),t(this,"_handleClickClosePopup",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close"))&&this.close()})),this._popup=document.querySelector(e)}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClickClosePopup)}removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClickClosePopup)}}class s extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleFormSubmit=t,this._formElemet=this._popup.querySelector(".popup__form"),this._inputsArr=this._formElemet.querySelectorAll(".popup__input"),this._inputValues={}}_getInputValues(){return this._inputsArr.forEach((e=>{this._inputValues[e.name]=[e.value]})),this._inputValues}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._formElemet.removeEventListener("submit",this._handleSubmit)}renderLoading(e,t){document.querySelector(t).textContent=e?"...Saving":"Save"}close(){super.close(),this._formElemet.reset()}}class n{constructor(e,t){this._formSelector=e.formSelector,this._formInputsFieldSet=e.formInputsFieldSet,this._inputSelector=e.inputSelector,this._submitBtnSelector=e.submitBtnSelector,this._inactiveBtnClass=e.inactiveBtnClass,this._inputErrClass=e.inputErrClass,this._inputErrActiveClass=e.inputErrActiveClass,this._formEl=t,this._inputLst=Array.from(this._formEl.querySelectorAll(this._inputSelector)),this._btnEl=this._formEl.querySelector(this._submitBtnSelector)}_showInputErr(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrClass),t.textContent=e.validationMessage,t.classList.add(this._inputErrActiveClass)}_hideInputError(e){const t=this._formEl.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrClass),t.classList.remove(this._inputErrActiveClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputErr(e)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}toggleButtonState(){this._hasInvalidInput(this._inputLst)?(this._btnEl.classList.add(this._inactiveBtnClass),this._btnEl.disabled=!0):(this._btnEl.classList.remove(this._inactiveBtnClass),this._btnEl.disabled=!1)}_setEventListeners(){this.toggleButtonState(this._inputLst,this._btnEl),this._inputLst.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState(this._inputLst,this._btnEl)}))}))}enableValidation(){this._setEventListeners(),this._formEl.addEventListener("submit",(e=>e.preventDefault()))}}const r=document.forms.profileform,l=r.elements.profileName,o=r.elements.profileAboutMe;function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}document.forms.placeform;const _=document.querySelector("button.profile__edit-btn"),c=document.querySelector("button.profile__add-btn"),u=document.querySelector(".profile__edit-avatar"),h=document.querySelector(".profile__error"),p=new class extends i{constructor(e,t,i){super(i),this._popupImg=this._popup.querySelector(e),this._popupTitle=this._popup.querySelector(t)}open(e,t){this._src=e,this._title=t,this._popupImg.src=this._src,this._popupImg.alt=this._title,this._popupTitle.textContent="Photo of ".concat(this._title),super.open()}}(".popup__img",".popup__img-title",".popup_type_img"),d=new class extends i{constructor(e,t){var i,s;super(e),s=e=>{e.preventDefault(),this._handleConfirm(this._cardEl)},(i="_handleSubmit")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this._handleConfirm=t,this._formElemet=this._popup.querySelector(".popup__form")}setEventListeners(){super.setEventListeners(),this._formElemet.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._formElemet.removeEventListener("submit",this._handleSubmit)}open(e){super.open(),this._cardEl=e}}(".popup_type_delete",(function(e){g.deleteCard(e._id).then((()=>{e._element.remove(),e._element=null,d.close()})).catch((e=>{console.log(e)}))})),m=new s(".popup_type_avatar",(function(e){m.renderLoading(!0,".popup__submit-btn_place_avatar"),g.editProfileAvatar(e.avatarImageLink).then((()=>{b.setUserAvatar({avatar:e.avatarImageLink}),m.close(),L.avatarform.toggleButtonState()})).catch((e=>{C(e)})).finally((()=>{m.renderLoading(!1,".popup__submit-btn_place_avatar")}))})),v=new s(".popup_type_new-card",(function(e){v.renderLoading(!0,".popup__submit-btn_place_new-card"),g.createNewCard(e.placeImageLink,e.placeName).then((e=>{y(e),v.close(),L.placeform.toggleButtonState()})).catch((e=>{C(e)})).finally((()=>{v.renderLoading(!1,".popup__submit-btn_place_new-card")}))})),f=new s(".popup_type_profile",(function(e){f.renderLoading(!0,".popup__submit-btn_place_profile"),g.editProfile({name:e.profileName,about:e.profileAboutMe}).then((()=>{b.setUserInfo({name:e.profileName,about:e.profileAboutMe}),f.close()})).catch((e=>{console.log(e)})).finally((()=>{f.renderLoading(!1,".popup__submit-btn_place_profile")}))})),E=new class{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}rendererItems(e){e.forEach((e=>{this._renderer(e)}))}}(y,".gallery__list"),b=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatar=document.querySelector(i)}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e){let{name:t,about:i,_id:s}=e;this._nameElement.textContent=t,this._nameElement.id=s,this._jobElement.textContent=i}setUserAvatar(e){let{avatar:t,name:i=null}=e;this._avatar.src=t,i&&(this._avatar.alt=i)}}(".profile__name",".profile__about-me",".profile__avatar"),L={};u.addEventListener("click",(()=>{m.open()}));const g=new class{constructor(e){a(this,"getInitialCards",(()=>this._call("/cards","GET"))),a(this,"getUserData",(()=>this._call("/users/me","GET"))),a(this,"addLike",(e=>this._call("/cards/likes/".concat(e),"PUT"))),a(this,"deleteLike",(e=>this._call("/cards/likes/".concat(e),"DELETE"))),a(this,"deleteCard",(e=>this._call("/cards/".concat(e),"DELETE"))),this._options=e}_call(e,t,i){return fetch(this._options.baseUrl+e,{method:t,headers:this._options.headers,body:JSON.stringify(i)}).then((e=>e.ok?e.json():Promise.reject(e.status)))}editProfile(e){let{name:t,about:i}=e;return this._call("/users/me","PATCH",{name:t[0],about:i[0]})}createNewCard(e,t){return this._call("/cards","POST",{name:t[0],link:e[0]})}editProfileAvatar(e){return this._call("/users/me/avatar ","PATCH",{avatar:e[0]})}init(){return Promise.all([this.getUserData(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b621f0f-5dfe-43f1-95fd-e9cc188bcc35","Content-Type":"application/json"}});function y(t){E.addItem(function(t){const i=new e(t,"#gallery-item-template",(()=>{p.open(t.link,t.name)}),(()=>{d.open(i)}),k,g);return i.generateCard()}(t))}function k(e){e.updateLikes().then((t=>{e.setLikes(t)})).catch((e=>{console.log(e)}))}function C(e){h.textContent=e,h.style.display="block"}var S;g.init().then((e=>{let[t,i]=e;b.setUserInfo(t),b.setUserAvatar({avatar:t.avatar,name:t.name}),E.rendererItems(i)})).catch((e=>{C(e)})),c.addEventListener("click",(()=>v.open())),_.addEventListener("click",(()=>{const{name:e,about:t}=b.getUserInfo();l.value=e,o.value=t,f.open()})),S={formSelector:".popup__form",formInputsFieldSet:".popup__form-set",inputSelector:".popup__input",submitBtnSelector:".popup__submit-btn",inactiveBtnClass:"button_inactive",inputErrClass:"popup__input-text_type_error",inputErrActiveClass:"popup__input-text-error_active"},Array.from(document.querySelectorAll(S.formSelector)).forEach((e=>{const t=new n(S,e),i=e.getAttribute("name");L[i]=t,t.enableValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNQVyxFQUFZWCxNQWdEYm5CLEVBQW1CbEYsaUJBQWlCLFNBQVMsSUFBTWtILEVBQWFwRyxTQWtFakVtRSxFQUFlakYsaUJBQWlCLFNBQVMsS0FDdkMsTUFBTSxLQUFDL0MsRUFBRCxNQUFPd0ssR0FBVWIsRUFBU2dDLGNBQ2hDakUsRUFBVTVDLE1BQVM5RSxFQUNuQjZILEVBQWEvQyxNQUFTMEYsRUFDdEJGLEVBQWF6RyxVQVlXd0IsRURsTFgsQ0FDWEcsYUFBYyxlQUNkRSxtQkFBb0IsbUJBQ3BCRSxjQUFlLGdCQUNmRSxrQkFBbUIscUJBQ25CRSxpQkFBa0Isa0JBQ2xCRSxjQUFlLCtCQUNmRSxvQkFBcUIsa0NDNEtORyxNQUFNQyxLQUFLckYsU0FBU3VELGlCQUFpQlcsRUFBT0csZUFDcERaLFNBQVMwSSxJQUNoQixNQUFNQyxFQUFZLElBQUluSSxFQUFjQyxFQUFPaUksR0FFckNFLEVBQVdGLEVBQVlHLGFBQWEsUUFHMUMzRCxFQUFlMEQsR0FBWUQsRUFDNUJBLEVBQVVqRyxzQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3IoIGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVUcmFzaENsaWNrLCBoYW5kbGVMaWtlLCBhcGkpIHtcclxuICAgICAgdGhpcy5fdGV4dCAgICAgICAgICAgICAgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHRoaXMuX2ltZyAgICAgICAgICAgICAgPSBkYXRhLmxpbms7XHJcbiAgICAgIHRoaXMuX2lkICAgICAgICAgICAgICAgID0gZGF0YS5faWQ7XHJcbiAgICAgIHRoaXMuX2xpa2VzICAgICAgICAgICAgID0gZGF0YS5saWtlcztcclxuICAgICAgdGhpcy5fQ2FyZG93bmVyICAgICAgICAgPSBkYXRhLm93bmVyO1xyXG4gICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgICAgICA9IGNhcmRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrICAgPSBoYW5kbGVDYXJkQ2xpY2s7XHJcbiAgICAgIHRoaXMuX2hhbmRsZVRyYXNoQ2xpY2sgID0gaGFuZGxlVHJhc2hDbGljaztcclxuICAgICAgdGhpcy5fYWRkTGlrZSAgICAgICAgICAgPSBhcGkuYWRkTGlrZTtcclxuICAgICAgdGhpcy5fZGVsZXRlTGlrZSAgICAgICAgPSBhcGkuZGVsZXRlTGlrZTtcclxuICAgICAgdGhpcy5fZGVsZXRlQ2FyZCAgICAgICAgPSBhcGkuZGVsZXRlQ2FyZDtcclxuICAgICAgdGhpcy5faGFuZGxlTGlrZSAgICAgICAgPSBoYW5kbGVMaWtlO1xyXG4gICAgICB0aGlzLl9lbGVtZW50ICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbVwiKS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgIHRoaXMuX2l0ZW1JbWdFbCAgICAgICAgID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW0taW1nXCIpO1xyXG4gICAgICB0aGlzLl9pdGVtTmFtZUVsICAgICAgICA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLW5hbWVcIik7XHJcbiAgICAgIHRoaXMucHJvZmlsZUVsICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG4gICAgICB0aGlzLl9pdGVtVHJhc2hCdG4gICAgICA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtLXRyYXNoLWJ0blwiKTtcclxuICAgICAgdGhpcy5faXRlbUxpa2VCdG4gICAgICAgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fbGlrZS1idG5cIik7XHJcbiAgICAgIHRoaXMuX2dhbGxlcnlsaWtlQ291bnQgID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdsbGVyeV9fbGlrZS1jb3VudFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRJZCgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2lkO1xyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgICAgdGhpcy5faXRlbUltZ0VsLnNyYyA9IHRoaXMuX2ltZztcclxuICAgICAgdGhpcy5faXRlbU5hbWVFbC5hbHQgPSB0aGlzLl90ZXh0O1xyXG4gICAgICB0aGlzLl9pdGVtTmFtZUVsLnRleHRDb250ZW50ID0gdGhpcy5fdGV4dDtcclxuIFxyXG4gICAgICB0aGlzLl9lbGVtZW50LmlkID0gdGhpcy5faWQ7XHJcbiAgICAgIHRoaXMuX2luaXRMaWtlKHRoaXMucHJvZmlsZUVsLmlkKTtcclxuICAgICAgdGhpcy4gX2RlbGV0ZUljb25WaXNpYmlsaXR5KHRoaXMucHJvZmlsZUVsLmlkKTtcclxuICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfZGVsZXRlSWNvblZpc2liaWxpdHkodXNlcklkKXtcclxuICAgICAgaWYodXNlcklkICE9ICB0aGlzLl9DYXJkb3duZXIuX2lkKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbVRyYXNoQnRuLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2luaXRMaWtlKHVzZXJJZCl7XHJcbiAgICAgIGlmKHRoaXMuX3VzZXJFeGlzdHModXNlcklkKSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1MaWtlQnRuLmNsYXNzTGlzdC5hZGQoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpOyBcclxuICAgICAgfVxyXG4gICAgICBpZih0eXBlb2YgdGhpcy5fbGlrZXMgIT09IFwidW5kZWZpbmVkXCIpe1xyXG4gICAgICAgIHRoaXMuX2dhbGxlcnlsaWtlQ291bnQudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fZ2FsbGVyeWxpa2VDb3VudC50ZXh0Q29udGVudCAgPSAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3VzZXJFeGlzdHMoaWQpIHtcclxuICAgICAgaWYodHlwZW9mIHRoaXMuX2xpa2VzICE9PSBcInVuZGVmaW5lZFwiKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZShmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICByZXR1cm4gdXNlci5faWQgPT09IGlkO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgIHRoaXMuX2l0ZW1MaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCgpID0+ICB7dGhpcy5faGFuZGxlTGlrZSh0aGlzKX0pO1xyXG4gICAgICB0aGlzLl9pdGVtVHJhc2hCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCkgPT57dGhpcy5faGFuZGxlVHJhc2hDbGljayh0aGlzKX0pO1xyXG4gICAgICB0aGlzLl9pdGVtSW1nRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNhcmRDbGljayk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIERlY2lkZSB3aGV0aGVyIHRvIGRlbGV0ZSBvciBhZGQgYSBMaWtlIGRlcGVuZGluZyBvbiBhbiBleGlzdGluZyBzaXR1YXRpb25cclxuICAgICAqL1xyXG4gICAgdXBkYXRlTGlrZXMoKSB7XHJcbiAgICAgIGlmKHRoaXMuX2l0ZW1MaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucygnZ2FsbGVyeV9fbGlrZS1idG5fYWN0aXZlJykpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kZWxldGVMaWtlKHRoaXMuX2VsZW1lbnQuaWQpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hZGRMaWtlKHRoaXMuX2VsZW1lbnQuaWQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEZWFsaW5nIHdpdGggdGhlIHN1Y2Nlc3Mgb2YgdXBkYXRpbmcgTGlrZSBvbiB0aGUgc2VydmVyICgudGhlbilcclxuICAgICAqL1xyXG4gICAgc2V0TGlrZXMoZGF0YSkge1xyXG4gICAgICB0aGlzLl9nYWxsZXJ5bGlrZUNvdW50LnRleHRDb250ZW50ID0gZGF0YS5saWtlcy5sZW5ndGg7XHJcbiAgICAgIHRoaXMuX2l0ZW1MaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoJ2dhbGxlcnlfX2xpa2UtYnRuX2FjdGl2ZScpO1xyXG4gICAgfVxyXG4gIH0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgICBjb25zdHJ1Y3RvciAoIHBvcHVwU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgfVxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICAvKiogcG9wdXBzIGNsb3NlIGNsaWNrIHJlbW92ZSBldmVudHMgKi9cclxuICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICAgIC8qKiBwb3B1cHMgb3BlbiBldmVudHMgKi9cclxuICAgICAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hhbmRsZUVzY0Nsb3NlID0gKGV2dCkgPT57XHJcbiAgICAgICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsICB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAgdGhpcy5faGFuZGxlQ2xpY2tDbG9zZVBvcHVwKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGFuZGxlQ2xpY2tDbG9zZVBvcHVwID0gKGV2dCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuZWRcIikgfHxcclxuICAgICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9fY2xvc2VcIikgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG5cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtICBleHRlbmRzIFBvcHVwIHtcclxuICAgICAgICBjb25zdHJ1Y3RvciAoIHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgKSB7XHJcbiAgICAgICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ICA9IGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQgICAgICAgID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICAgICAgdGhpcy5faW5wdXRzQXJyICAgICAgICAgPSB0aGlzLl9mb3JtRWxlbWV0LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnB1dFZhbHVlcyAgICAgICA9IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnB1dHNBcnIuZm9yRWFjaChpbnB1dCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dFZhbHVlcyBbaW5wdXQubmFtZV0gPSBbaW5wdXQudmFsdWVdO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRWYWx1ZXMgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJdCBtb2RpZmllcyB0aGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSBwYXJlbnQgbWV0aG9kLiBcclxuICAgICAgICAgICAgICogVGhlIHNldEV2ZW50TGlzdGVuZXJzKCkgbWV0aG9kIG9mIHRoZSBQb3B1cFdpdGhGb3JtIGNsYXNzXHJcbiAgICAgICAgICAgICAqICBoYXMgdG8gYWRkIHRoZSBzdWJtaXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZm9ybSBhbmQgdGhlIGNsaWNrIFxyXG4gICAgICAgICAgICAgKiBldmVudCBsaXN0ZW5lciB0byB0aGUgY2xvc2UgaWNvbi5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICBzdXBlci5yZW1vdmVFdmVudExpc3RlbmVycygpXHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgX2hhbmRsZVN1Ym1pdCA9KGV2dCkgPT57XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOyBcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIGNoYW5nZSBidXR0b24gdGV4dCB0byAuLnNhdmluZyB1bnRpbCBwcm9jZXNzIGVuZHNcclxuICAgICAgICAgKi9cclxuICAgICAgICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgYnRuU2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgY29uc3QgYnRuRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGJ0blNlbGVjdG9yKTtcclxuICAgICAgICAgICAgaWYoaXNMb2FkaW5nKSB7XHJcbiAgICAgICAgICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCIuLi5TYXZpbmdcIjsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGJ0bkVsLnRleHRDb250ZW50ID0gXCJTYXZlXCI7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBjbG9zZSgpIHBhcmVudCBtZXRob2QgXHJcbiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBmb3JtIG9uY2UgdGhlIHBvcHVwIGlzIGNsb3NlZC5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1FbGVtZXQucmVzZXQoKTtcclxuICAgICAgICB9XHJcblxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvciggY29uZmlnLCBmb3JtRWwgKXtcclxuICAgICAgdGhpcy5fZm9ybVNlbGVjdG9yICAgICAgICAgPSBjb25maWcuZm9ybVNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9mb3JtSW5wdXRzRmllbGRTZXQgICA9IGNvbmZpZy5mb3JtSW5wdXRzRmllbGRTZXQ7XHJcbiAgICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgICAgICAgID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0blNlbGVjdG9yICAgID0gY29uZmlnLnN1Ym1pdEJ0blNlbGVjdG9yO1xyXG4gICAgICB0aGlzLl9pbmFjdGl2ZUJ0bkNsYXNzICAgICA9IGNvbmZpZy5pbmFjdGl2ZUJ0bkNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckNsYXNzICAgICAgICA9IGNvbmZpZy5pbnB1dEVyckNsYXNzO1xyXG4gICAgICB0aGlzLl9pbnB1dEVyckFjdGl2ZUNsYXNzICA9IGNvbmZpZy5pbnB1dEVyckFjdGl2ZUNsYXNzO1xyXG4gICAgICB0aGlzLl9mb3JtRWwgICAgICAgICAgICAgICA9IGZvcm1FbDtcclxuICAgICAgdGhpcy5faW5wdXRMc3QgICAgICAgICAgICAgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcclxuICAgICAgdGhpcy5fYnRuRWwgICAgICAgICAgICAgICAgPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdG5TZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgX3Nob3dJbnB1dEVyciAoaW5wdXRFbCkge1xyXG4gICAgICBjb25zdCBlcnJFbCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgICBcclxuICAgICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyQ2xhc3MpO1xyXG4gICAgICBlcnJFbC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICAgIGVyckVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yIChpbnB1dEVsKSB7XHJcbiAgICAgIGNvbnN0IGVyckVsID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcblxyXG4gICAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJDbGFzcyk7XHJcbiAgICAgIGVyckVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJBY3RpdmVDbGFzcyk7XHJcbiAgICAgIGVyckVsLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBfY2hlY2tJbnB1dFZhbGlkaXR5IChpbnB1dEVsKSB7XHJcbiAgICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICAgIHRoaXMuX3Nob3dJbnB1dEVycihpbnB1dEVsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9oYXNJbnZhbGlkSW5wdXQgKGlucHV0THN0KSB7XHJcbiAgICAgIHJldHVybiBpbnB1dExzdC5zb21lKChpbnB1dEVsKSA9PiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUgKCkge1xyXG4gICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0THN0KSkge1xyXG4gICAgICAgIHRoaXMuX2J0bkVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdG5DbGFzcyk7XHJcbiAgICAgICAgdGhpcy5fYnRuRWwuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2J0bkVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdG5DbGFzcyk7XHJcbiAgICAgICAgdGhpcy5fYnRuRWwuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRMc3QsIHRoaXMuX2J0bkVsKTtcclxuICAgICAgdGhpcy5faW5wdXRMc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHsgICBcclxuICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKTtcclxuICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRMc3QsIHRoaXMuX2J0bkVsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IGV2dC5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgIH1cclxuXHJcbiAgfSIsImNvbnN0IGNvbmZpZyA9IHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm1cIixcclxuICAgIGZvcm1JbnB1dHNGaWVsZFNldDogXCIucG9wdXBfX2Zvcm0tc2V0XCIsXHJcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcclxuICAgIHN1Ym1pdEJ0blNlbGVjdG9yOiBcIi5wb3B1cF9fc3VibWl0LWJ0blwiLFxyXG4gICAgaW5hY3RpdmVCdG5DbGFzczogXCJidXR0b25faW5hY3RpdmVcIixcclxuICAgIGlucHV0RXJyQ2xhc3M6IFwicG9wdXBfX2lucHV0LXRleHRfdHlwZV9lcnJvclwiLFxyXG4gICAgaW5wdXRFcnJBY3RpdmVDbGFzczogXCJwb3B1cF9faW5wdXQtdGV4dC1lcnJvcl9hY3RpdmVcIlxyXG4gIH1cclxuXHJcblxyXG4vKiogcHJvZmlsZSBwb3B1cCBlbGVtZW50cyAqL1xyXG5jb25zdCBwcm9maWxlRm9ybSAgICAgICAgICAgICAgICAgID0gZG9jdW1lbnQuZm9ybXMucHJvZmlsZWZvcm07XHJcbmNvbnN0IGlucHV0TmFtZSAgICAgICAgICAgICA9IHByb2ZpbGVGb3JtLmVsZW1lbnRzLnByb2ZpbGVOYW1lO1xyXG5jb25zdCBpbnB1dEFib3V0TWUgICAgICAgICAgPSBwcm9maWxlRm9ybS5lbGVtZW50cy5wcm9maWxlQWJvdXRNZTtcclxuY29uc3QgcGxhY2VGb3JtICAgICAgICAgICAgID0gZG9jdW1lbnQuZm9ybXMucGxhY2Vmb3JtO1xyXG5cclxuY29uc3QgZ2FsbGVyeUxpc3RTZWxlY3RvciAgPSBcIi5nYWxsZXJ5X19saXN0XCI7XHJcblxyXG5leHBvcnQge2NvbmZpZywgaW5wdXROYW1lLCBpbnB1dEFib3V0TWUsIHBsYWNlRm9ybSwgZ2FsbGVyeUxpc3RTZWxlY3Rvcn1cclxuXHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tICBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtYXRpb24uanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IHtjb25maWcsIGlucHV0TmFtZSwgaW5wdXRBYm91dE1lLCBnYWxsZXJ5TGlzdFNlbGVjdG9yfSAgZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5cclxuLyoqIG1haW4gYnV0dG9ucyAqL1xyXG5jb25zdCBwcm9maWxlRWRpdEJ0biAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5wcm9maWxlX19lZGl0LWJ0blwiKTtcclxuY29uc3Qgb3BlTmV3Q2FyZFBvcHVwQnRuICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24ucHJvZmlsZV9fYWRkLWJ0blwiKTtcclxuY29uc3QgYXZhdGFyRWRpdEJ0biAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1hdmF0YXJcIilcclxuXHJcbmNvbnN0IGVycm9yRWwgICAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Vycm9yXCIpO1xyXG5cclxuY29uc3QgcG9wdXBDYXJkSXRlbSAgICAgICA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF9faW1nXCIsIFwiLnBvcHVwX19pbWctdGl0bGVcIiwgXCIucG9wdXBfdHlwZV9pbWdcIik7XHJcbmNvbnN0IHBvcHVwQ29uZmlybSAgICAgICAgPSBuZXcgUG9wdXBXaXRoQ29uZmlybWF0aW9uKFwiLnBvcHVwX3R5cGVfZGVsZXRlXCIsIGhhbmRsZURlbGV0ZSk7XHJcbmNvbnN0IGVkaXRBdmF0YXJQb3B1cCAgICAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cF90eXBlX2F2YXRhclwiLCBoYW5kbGVFZGl0QXZhdGFyKTtcclxuY29uc3QgbmV3Q2FyZFBvcHVwICAgICAgICA9IG5ldyBQb3B1cFdpdGhGb3JtIChcIi5wb3B1cF90eXBlX25ldy1jYXJkXCIsIGhhbmRsZUNyZWF0ZU5ld0NhcmQpO1xyXG5jb25zdCBwcm9maWxlUG9wdXAgICAgICAgID0gbmV3IFBvcHVwV2l0aEZvcm0gKFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLCAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xyXG5jb25zdCBjYXJkTGlzdCAgICAgICAgICAgID0gbmV3IFNlY3Rpb24oYWRkR2FsbGVyeUNhcmRJdGVtLCBnYWxsZXJ5TGlzdFNlbGVjdG9yKTtcclxuY29uc3QgdXNlckluZm8gICAgICAgICAgICA9IG5ldyBVc2VySW5mbyhcIi5wcm9maWxlX19uYW1lXCIsIFwiLnByb2ZpbGVfX2Fib3V0LW1lXCIsIFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuXHJcbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XHJcblxyXG5hdmF0YXJFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAgKCkgPT4ge2VkaXRBdmF0YXJQb3B1cC5vcGVuKCl9KTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiOWI2MjFmMGYtNWRmZS00M2YxLTk1ZmQtZTljYzE4OGJjYzM1XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogaW5pdGlhYWwgdXNlciBpbmZvIGFuZCBnYWxsZXJ5IENhcmRzIGZyb21cclxuICovXHJcbmFwaS5pbml0KClcclxuLnRoZW4oKFt1c2VyLGNhcmRzXSkgPT4ge1xyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXIpO1xyXG4gIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoe2F2YXRhcjogdXNlci5hdmF0YXIsbmFtZTogdXNlci5uYW1lfSk7XHJcbiAgY2FyZExpc3QucmVuZGVyZXJJdGVtcyhjYXJkcyk7XHJcbn0pXHJcbi5jYXRjaCAoKGVycikgPT4ge1xyXG4gIGhhbmRsZUVycm9yKGVycik7XHJcbn0pXHJcblxyXG5cclxuXHJcblxyXG4vKipcclxuICogaGFuZGxlIGVkaXQgcG9maWxlIGF2YXRhciBpbWFnZVxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEF2YXRhciAoaW5wdXRzKSB7XHJcbiAgZWRpdEF2YXRhclBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfYXZhdGFyXCIpO1xyXG4gIGFwaS5lZGl0UHJvZmlsZUF2YXRhcihpbnB1dHMuYXZhdGFySW1hZ2VMaW5rKVxyXG4gIC50aGVuICgoKSA9PiB7XHJcbiAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHthdmF0YXI6IGlucHV0cy5hdmF0YXJJbWFnZUxpbmt9KVxyXG4gICAgZWRpdEF2YXRhclBvcHVwLmNsb3NlKCk7XHJcbiAgICBmb3JtVmFsaWRhdG9yc1tcImF2YXRhcmZvcm1cIl0udG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9KVxyXG4gIC5jYXRjaCAoKGVycikgPT4ge1xyXG4gICAgaGFuZGxlRXJyb3IoZXJyKTtcclxuICB9KVxyXG4gIC5maW5hbGx5KCgpID0+e1xyXG4gICAgZWRpdEF2YXRhclBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UsIFwiLnBvcHVwX19zdWJtaXQtYnRuX3BsYWNlX2F2YXRhclwiKTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogZWRpdCB1c2VyIHByb2ZpbGUgZGF0YVxyXG4gKi9cclxuIGZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0IChpbnB1dHMpIHtcclxuICBwcm9maWxlUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG5cclxuICBhcGkuZWRpdFByb2ZpbGUoe25hbWU6IGlucHV0cy5wcm9maWxlTmFtZSwgYWJvdXQ6IGlucHV0cy5wcm9maWxlQWJvdXRNZX0pXHJcbiAgLnRoZW4gKCgpID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtuYW1lOiBpbnB1dHMucHJvZmlsZU5hbWUsIGFib3V0OiBpbnB1dHMucHJvZmlsZUFib3V0TWV9KVxyXG4gICAgcHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgICAoKSA9PiBmb3JtVmFsaWRhdG9yc1tcInByb2ZpbGVmb3JtXCJdLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2ggKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSlcclxuICAuZmluYWxseSgoKSA9PntcclxuICAgIHByb2ZpbGVQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlLCBcIi5wb3B1cF9fc3VibWl0LWJ0bl9wbGFjZV9wcm9maWxlXCIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhZGQgbmV3IGNhcmQgaXRlbSB0byBnYWxsZXJ5XHJcbiAqL1xyXG4gb3BlTmV3Q2FyZFBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBuZXdDYXJkUG9wdXAub3BlbigpKTtcclxuXHJcbiBmdW5jdGlvbiBjcmVhdGVDYXJkIChpdGVtKSB7XHJcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxyXG4gICAgaXRlbSwgXHJcbiAgICBcIiNnYWxsZXJ5LWl0ZW0tdGVtcGxhdGVcIixcclxuICAgICgpID0+IHsgcG9wdXBDYXJkSXRlbS5vcGVuKGl0ZW0ubGluaywgaXRlbS5uYW1lKTsgfSxcclxuICAgICgpID0+IHsgcG9wdXBDb25maXJtLm9wZW4oY2FyZCk7IH0sXHJcbiAgICBoYW5kbGVMaWtlLFxyXG4gICAgYXBpKTtcclxuICAgIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiAgYWRkR2FsbGVyeUNhcmRJdGVtIChpdGVtKSB7XHJcbiAgY2FyZExpc3QuYWRkSXRlbShjcmVhdGVDYXJkKGl0ZW0pKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ3JlYXRlTmV3Q2FyZCAoaW5wdXRzKSB7XHJcbiAgbmV3Q2FyZFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfbmV3LWNhcmRcIik7XHJcblxyXG4gIGFwaS5jcmVhdGVOZXdDYXJkKGlucHV0cy5wbGFjZUltYWdlTGluayxpbnB1dHMucGxhY2VOYW1lKVxyXG4gIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgYWRkR2FsbGVyeUNhcmRJdGVtIChkYXRhKVxyXG4gICAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICBmb3JtVmFsaWRhdG9yc1tcInBsYWNlZm9ybVwiXS50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH0pXHJcbiAgLmNhdGNoICgoZXJyKSA9PiB7XHJcbiAgICBoYW5kbGVFcnJvcihlcnIpO1xyXG4gIH0pXHJcbiAgLmZpbmFsbHkoKCkgPT57XHJcbiAgICBuZXdDYXJkUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSwgXCIucG9wdXBfX3N1Ym1pdC1idG5fcGxhY2VfbmV3LWNhcmRcIik7XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIGRlbGV0ZSBjYXJkIGl0ZW0gZnJvbSBnYWxsZXJ5XHJcbiAqL1xyXG4gZnVuY3Rpb24gaGFuZGxlRGVsZXRlKGNhcmQpIHtcclxuICBhcGkuZGVsZXRlQ2FyZChjYXJkLl9pZClcclxuICAudGhlbigoKSA9PntcclxuICAgIGNhcmQuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICBjYXJkLl9lbGVtZW50ID0gbnVsbDtcclxuICAgIHBvcHVwQ29uZmlybS5jbG9zZSgpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBoYW5kbGUgY2FyZCBsaWtlcyB1cGRhdGVcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZUxpa2UoY2FyZCkge1xyXG4gIGNhcmQudXBkYXRlTGlrZXMoKVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY2FyZC5zZXRMaWtlcyhkYXRhKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSkgICAgIFxyXG4gICBcclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZCBldmVudCBsaXN0ZW5lciB0byBlZGl0IHVzZXIgcHJvZmlsZSBpbmZvXHJcbiAqL1xyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IHtuYW1lLCBhYm91dCB9ID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBpbnB1dE5hbWUudmFsdWUgID0gbmFtZTtcclxuICBpbnB1dEFib3V0TWUudmFsdWUgID0gYWJvdXQ7XHJcbiAgcHJvZmlsZVBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG4vKipcclxuICogc2V0IEVycm9yIGRlc2NyaXB0aW9uIG9uIHRvcCBvZiB0aGUgcGFnZVxyXG4gKi9cclxuIGZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycikge1xyXG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBlcnI7XHJcbiAgZXJyb3JFbC5zdHlsZS5kaXNwbGF5ICA9IFwiYmxvY2tcIjtcclxufVxyXG5cclxuXHJcbmNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpXHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZyxmb3JtRWxlbWVudClcclxuICAgIC8vZ2V0IHRoZSBuYW1lIG9mIHRoZSBmb3JtXHJcbiAgICBjb25zdCBmb3JtTmFtZSA9IGZvcm1FbGVtZW50LmdldEF0dHJpYnV0ZSgnbmFtZScpXHJcblxyXG4gICAvL3N0b3JlIGEgdmFsaWRhdG9yIGJ5IHRoZSBgbmFtZWAgb2YgdGhlIGZvcm1cclxuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1OYW1lXSA9IHZhbGlkYXRvcjtcclxuICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oY29uZmlnKTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cHtcclxuICAgIGNvbnN0cnVjdG9yICggaW1nU2VsZWN0b3IsIHRpdGxlU2VsZWN0b3IgLHBvcHVwU2VsZWN0b3IgKSB7XHJcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKGltZ1NlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3Rvcih0aXRsZVNlbGVjdG9yKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgb3BlbihzcmMsIHRpdGxlICkge1xyXG4gICAgICAgIHRoaXMuX3NyYyAgID0gc3JjO1xyXG4gICAgICAgIHRoaXMuX3RpdGxlID0gdGl0bGU7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWcuc3JjID0gIHRoaXMuX3NyYztcclxuICAgICAgICB0aGlzLl9wb3B1cEltZy5hbHQgPSAgdGhpcy5fdGl0bGU7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZS50ZXh0Q29udGVudCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yICggcG9wdXBTZWxlY3RvciwgaGFuZGxlQ29uZmlybSApIHtcclxuICAgICAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNvbmZpcm0gICAgID0gICBoYW5kbGVDb25maXJtO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0ICAgICAgICA9ICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEl0IG1vZGlmaWVzIHRoZSBzZXRFdmVudExpc3RlbmVycygpIHBhcmVudCBtZXRob2QuIFxyXG4gICAgICAgICAgICAgKiAgaGFzIHRvIGFkZCB0aGUgc3VibWl0IGV2ZW50IGhhbmRsZXIgdG8gdGhlIGZvcm0gYW5kIHRoZSBjbGljayBcclxuICAgICAgICAgICAgICogZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGNsb3NlIGljb24uXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWV0LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgIHN1cGVyLnJlbW92ZUV2ZW50TGlzdGVuZXJzKClcclxuICAgICAgICAgICAgdGhpcy5fZm9ybUVsZW1ldC5yZW1vdmVFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7IFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBfaGFuZGxlU3VibWl0ID0oZXZ0KSA9PntcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDb25maXJtKHRoaXMuX2NhcmRFbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvcGVuKGNhcmRFbCkge1xyXG4gICAgICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhcmRFbCA9IGNhcmRFbDtcclxuICAgICAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKCByZW5kZXJlciAsIGNvbnRhaW5lclNlbGVjdG9yICkge1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyICAgID0gcmVuZGVyZXI7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHJlbmRlcmVySXRlbXMoY2FyZHMpIHtcclxuICAgICAgICBjYXJkcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBVc2VySW5mbyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgcmVuZGVyaW5nIFxyXG4gICAgICogaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgb24gdGhlIHBhZ2UuIFRoaXMgY2xhc3Mgc2hvdWxkOlxyXG4gICAgICogLVRha2UgYW4gb2JqZWN0IHdpdGggdGhlIHNlbGVjdG9ycyBvZiB0d28gZWxlbWVudHMgaW50byB0aGUgY29uc3RydWN0b3I6IFxyXG4gICAgICogb25lIGNvbnRhaW5pbmcgdGhlIHVzZXIncyBuYW1lLCBhbmQgYW5vdGhlciBjb250YWluaW5nIHRoZSB1c2VyJ3Mgam9iLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvciAoIG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuX25hbWVFbGVtZW50ICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5fam9iRWxlbWVudCAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2F2YXRhciAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyLiBcclxuICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIGhhbmR5IGZvciBcclxuICAgICAgICAgKiBjYXNlcyB3aGVuIGl0J3MgbmVjZXNzYXJ5IHRvIGRpc3BsYXkgdGhlIHVzZXIgZGF0YSBpbiB0aGUgb3BlbiBmb3JtLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICAgICAgICBhYm91dDogdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyh7IG5hbWUsIGFib3V0LCBfaWQgfSl7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogdGFrZXMgbmV3IHVzZXIgZGF0YSBhbmQgYWRkcyBpdCBvbiB0aGUgcGFnZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCAgID0gbmFtZTtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC5pZCAgICAgICAgICAgID0gX2lkO1xyXG4gICAgICAgIHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQgICAgPSBhYm91dDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VyQXZhdGFyKHthdmF0YXIsIG5hbWUgPSBudWxsfSkge1xyXG4gICAgICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgICAgICAgaWYobmFtZSl7XHJcbiAgICAgICAgICAgIHRoaXMuX2F2YXRhci5hbHQgPSBuYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XHJcbiAgICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xyXG5cclxuICAgIH1cclxuICBcclxuICAgIF9jYWxsKGFjdGlvbiwgbWV0aG9kLCBkYXRhKSB7XHJcbiAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwgKyBhY3Rpb24sIHtcclxuICAgICAgICBtZXRob2Q6IG1ldGhvZCxcclxuICAgICAgICBoZWFkZXJzOiAgdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGlmKHJlcy5vaykge1xyXG4gICAgICAgICAgcmV0dXJuICByZXMuanNvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1cyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi9jYXJkc1wiLCdHRVQnKTtcclxuICAgIH1cclxuICBcclxuICAgIGdldFVzZXJEYXRhID0gKCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi91c2Vycy9tZVwiLCdHRVQnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZWRpdFByb2ZpbGUoe25hbWUsIGFib3V0fSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChcIi91c2Vycy9tZVwiLCdQQVRDSCcse1xyXG4gICAgICAgIG5hbWU6IG5hbWVbMF0sXHJcbiAgICAgICAgYWJvdXQ6IGFib3V0WzBdXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZU5ld0NhcmQgKGxpbmssIG5hbWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvY2FyZHNcIiwnUE9TVCcse1xyXG4gICAgICAgIG5hbWU6IG5hbWVbMF0sXHJcbiAgICAgICAgbGluazogbGlua1swXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgYWRkTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoYC9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCdQVVQnKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVMaWtlID0gKGNhcmRJZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2FsbChgL2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsJ0RFTEVURScpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQgPSAoY2FyZElkKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYWxsKGAvY2FyZHMvJHtjYXJkSWR9YCwnREVMRVRFJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZWRpdFByb2ZpbGVBdmF0YXIodXJsKXtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbGwoXCIvdXNlcnMvbWUvYXZhdGFyIFwiLCdQQVRDSCcse1xyXG4gICAgICAgIGF2YXRhciA6IHVybFswXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckRhdGEoKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgXHJcbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlVHJhc2hDbGljayIsImhhbmRsZUxpa2UiLCJhcGkiLCJ0aGlzIiwiX3RleHQiLCJuYW1lIiwiX2ltZyIsImxpbmsiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9DYXJkb3duZXIiLCJvd25lciIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZVRyYXNoQ2xpY2siLCJfYWRkTGlrZSIsImFkZExpa2UiLCJfZGVsZXRlTGlrZSIsImRlbGV0ZUxpa2UiLCJfZGVsZXRlQ2FyZCIsImRlbGV0ZUNhcmQiLCJfaGFuZGxlTGlrZSIsIl9lbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9pdGVtSW1nRWwiLCJfaXRlbU5hbWVFbCIsInByb2ZpbGVFbCIsIl9pdGVtVHJhc2hCdG4iLCJfaXRlbUxpa2VCdG4iLCJfZ2FsbGVyeWxpa2VDb3VudCIsImdldElkIiwiZ2VuZXJhdGVDYXJkIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJpZCIsIl9pbml0TGlrZSIsIl9kZWxldGVJY29uVmlzaWJpbGl0eSIsIl9zZXRFdmVudExpc3RlbmVycyIsInVzZXJJZCIsInN0eWxlIiwidmlzaWJpbGl0eSIsIl91c2VyRXhpc3RzIiwiY2xhc3NMaXN0IiwiYWRkIiwibGVuZ3RoIiwic29tZSIsInVzZXIiLCJhZGRFdmVudExpc3RlbmVyIiwidXBkYXRlTGlrZXMiLCJjb250YWlucyIsInNldExpa2VzIiwidG9nZ2xlIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiZXZ0Iiwia2V5IiwiY2xvc2UiLCJ0YXJnZXQiLCJfcG9wdXAiLCJyZW1vdmUiLCJyZW1vdmVFdmVudExpc3RlbmVycyIsIm9wZW4iLCJzZXRFdmVudExpc3RlbmVycyIsIl9oYW5kbGVFc2NDbG9zZSIsIl9oYW5kbGVDbGlja0Nsb3NlUG9wdXAiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsInByZXZlbnREZWZhdWx0IiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfZm9ybUVsZW1ldCIsIl9pbnB1dHNBcnIiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2lucHV0VmFsdWVzIiwiZm9yRWFjaCIsImlucHV0IiwidmFsdWUiLCJfaGFuZGxlU3VibWl0IiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ0blNlbGVjdG9yIiwicmVzZXQiLCJGb3JtVmFsaWRhdG9yIiwiY29uZmlnIiwiZm9ybUVsIiwiX2Zvcm1TZWxlY3RvciIsImZvcm1TZWxlY3RvciIsIl9mb3JtSW5wdXRzRmllbGRTZXQiLCJmb3JtSW5wdXRzRmllbGRTZXQiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnRuU2VsZWN0b3IiLCJzdWJtaXRCdG5TZWxlY3RvciIsIl9pbmFjdGl2ZUJ0bkNsYXNzIiwiaW5hY3RpdmVCdG5DbGFzcyIsIl9pbnB1dEVyckNsYXNzIiwiaW5wdXRFcnJDbGFzcyIsIl9pbnB1dEVyckFjdGl2ZUNsYXNzIiwiaW5wdXRFcnJBY3RpdmVDbGFzcyIsIl9mb3JtRWwiLCJfaW5wdXRMc3QiLCJBcnJheSIsImZyb20iLCJfYnRuRWwiLCJfc2hvd0lucHV0RXJyIiwiaW5wdXRFbCIsImVyckVsIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJpbnB1dExzdCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiZGlzYWJsZWQiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbGVmb3JtIiwiaW5wdXROYW1lIiwiZWxlbWVudHMiLCJwcm9maWxlTmFtZSIsImlucHV0QWJvdXRNZSIsInByb2ZpbGVBYm91dE1lIiwicGxhY2Vmb3JtIiwicHJvZmlsZUVkaXRCdG4iLCJvcGVOZXdDYXJkUG9wdXBCdG4iLCJhdmF0YXJFZGl0QnRuIiwiZXJyb3JFbCIsInBvcHVwQ2FyZEl0ZW0iLCJpbWdTZWxlY3RvciIsInRpdGxlU2VsZWN0b3IiLCJfcG9wdXBJbWciLCJfcG9wdXBUaXRsZSIsInRpdGxlIiwiX3NyYyIsIl90aXRsZSIsInBvcHVwQ29uZmlybSIsImhhbmRsZUNvbmZpcm0iLCJfaGFuZGxlQ29uZmlybSIsIl9jYXJkRWwiLCJjYXJkRWwiLCJjYXJkIiwidGhlbiIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImVkaXRBdmF0YXJQb3B1cCIsImlucHV0cyIsImVkaXRQcm9maWxlQXZhdGFyIiwiYXZhdGFySW1hZ2VMaW5rIiwidXNlckluZm8iLCJzZXRVc2VyQXZhdGFyIiwiYXZhdGFyIiwiZm9ybVZhbGlkYXRvcnMiLCJoYW5kbGVFcnJvciIsImZpbmFsbHkiLCJuZXdDYXJkUG9wdXAiLCJjcmVhdGVOZXdDYXJkIiwicGxhY2VJbWFnZUxpbmsiLCJwbGFjZU5hbWUiLCJhZGRHYWxsZXJ5Q2FyZEl0ZW0iLCJwcm9maWxlUG9wdXAiLCJlZGl0UHJvZmlsZSIsImFib3V0Iiwic2V0VXNlckluZm8iLCJjYXJkTGlzdCIsInJlbmRlcmVyIiwiY29udGFpbmVyU2VsZWN0b3IiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwicmVuZGVyZXJJdGVtcyIsImNhcmRzIiwiaXRlbSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsIm9wdGlvbnMiLCJfY2FsbCIsImNhcmRJZCIsIl9vcHRpb25zIiwiYWN0aW9uIiwibWV0aG9kIiwiZmV0Y2giLCJiYXNlVXJsIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInVybCIsImluaXQiLCJhbGwiLCJnZXRVc2VyRGF0YSIsImdldEluaXRpYWxDYXJkcyIsImF1dGhvcml6YXRpb24iLCJjcmVhdGVDYXJkIiwiZGlzcGxheSIsImZvcm1FbGVtZW50IiwidmFsaWRhdG9yIiwiZm9ybU5hbWUiLCJnZXRBdHRyaWJ1dGUiXSwic291cmNlUm9vdCI6IiJ9